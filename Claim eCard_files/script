function GetQueryStringParams(n){for(var i,u=window.location.search.substring(1),r=u.split("&"),t=0;t<r.length;t++)if(i=r[t].split("="),i[0]==n)return i[1]}var AppApiKeyManager=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon;return{init:function(){var n=this;$(document).ready(function(){n.getApiKeys()})},callAPI:function(n,t,i,r,u){n==="get"?$.get(t,i,r).error(function(n){u(n)}):$.post(t,i,r).error(function(n){u(n)})},hideAlert:function(){$("#divKeyAlert .close").off("click");$("#divKeyAlert .close").on("click",function(){$(this).parent().toggleClass("hide",!0)})},getApiKeys:function(){var n=this,t;$("#divSearchError, #divKeyAlert").toggleClass("hide",!0);t=$("#hdnKeysUrl").val();n.callAPI("get",t,null,n.onLoadResult,n.onFailure)},generateKey:function(n){var t,i,r;n.preventDefault();t=this;i=$(n.target);t.firedElem=i.prop("id");t.firedElem==="btnRegen"&&t.hideAlert();$("#divSearchError, #divKeyAlert").toggleClass("hide",!0);r=$(n.target).data("url");t.callAPI("post",r,null,$.proxy(t.onLoadResult,t),t.onFailure)},confirmDeletion:function(n){n.preventDefault();$("#divSearchError, #divKeyAlert").toggleClass("hide",!0);$("#confirmDeleteModal").modal("show")},confirmRegen:function(n){n.preventDefault();$("#divSearchError, #divKeyAlert").toggleClass("hide",!0);$("#confirmRegenModal").modal("show")},removeKey:function(n){var t,i,r;n.preventDefault();t=this;$("#divSearchError").toggleClass("hide",!0);i=$(n.target).data("url");r={Id:$("#hdnKeyId").val()};t.callAPI("post",i,r,t.onLoadResult,t.onFailure)},copyKey:function(n){n.preventDefault();$("#inpKey").select();document.execCommand("Copy")},onLoadResult:function(n){var t=this;$("#divSearchError, #divKeyAlert").toggleClass("hide",!0);$("#confirmDeleteModal").modal("hide");$("#confirmRegenModal").modal("hide");n&&n.length>0&&(t.firedElem==="btnRegen"&&$("#divKeyAlert").toggleClass("hide",!1),$("#divKeyResult").html(n))},onFailure:function(t){$("#confirmDeleteModal").modal("hide");$("#confirmRegenModal").modal("hide");n.showResponseError("divKeyError","errlist",t)}}},AppApproveECards=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon;return{init:function(){var n=this},callAPI:function(n,t,i,r,u){n==="get"?$.get(t,i,r).error(function(n){u(n)}):$.post(t,i,r).error(function(n){u(n)})},onSuccess:function(n){n&&($("#resendEmailModal").modal("hide"),$("#resendSMSModal").modal("hide"),$("#divAlert").toggleClass("hide",!1),$("#btnSearchCards").trigger({type:"click",canShowMsg:!0}))},onFail:function(t){n.showResponseError("resendError","emailErr",t)},editECard:function(n){n.preventDefault();$("#divEditError").toggleClass("hide",!0);$("#divEditAlert").toggleClass("hide",!0);var t=this,i=$(n.target.parentElement),r=i.data("url"),u={eCardGuid:i.data("eid"),isInstructorCard:i.data("isinstsrc")};t.callAPI("post",r,u,$.proxy(t.onLoadingEditCard,t),t.onFailSearch)},onLoadingEditCard:function(t){var i=this;if(t&&t.length>0&&($("#divSearch").toggleClass("hide",!0),$("#divEditCard").toggleClass("hide",!1).html(t),n.initDatePicker(!0),n.focusMessage(),$("#blockeCard").length>0)){$("#blockeCard").off("change");$("#blockeCard").on("change",i.changeStatus);$("#notes").prop("disabled",!$("#blockeCard").is(":checked"))}},getPendingRequest:function(){var t=$("#hdnUrl").val(),n=this;n.callAPI("get",t,"",n.onLoad,n.onLoadFailed)},onLoad:function(n){n&&($("#pendingList").html(n),$("#tblPendingRequest").dataTable({columnDefs:[{targets:"no-sort",orderable:!1}]}),$("#chkSelectAll").focus())},onApproveSuccess:function(n){n&&($("#pendingList").html(n),$("#tblPendingRequest").DataTable(),$("#divAlert").toggleClass("hide",!1),$("#divMessage").text(window.resources.TextApprovedRequest))},onDenySuccess:function(n){n&&($("#pendingList").html(n),$("#tblPendingRequest").DataTable(),$("#divAlert").toggleClass("hide",!1),$("#divMessage").text(window.resources.TextDenyRequest))},onLoadFailed:function(t){n.showResponseError("divError","emailErr",t)},selectAll:function(n){$("#tblPendingRequest").find("input:checkbox").each(function(){this.checked=n.checked})},approveRequest:function(t){var i=this,f=$(t.target),e=f.data("url"),u=f.data("status"),r=[];if($("#tblPendingRequest").find("tr").each(function(n){if(n!=0){var t=$(this).find("input");t.is(":checked")&&r.push(t.val())}}),r.length==0){n.showResponseError("divError","emailErr",window.resources.TextPleaseSelectOneOrMoreRecords);return}u==1?i.callAPI("post",e,{ids:r,status:u},i.onApproveSuccess,i.onLoadFailed):i.callAPI("post",e,{ids:r,status:u},i.onDenySuccess,i.onLoadFailed)},open_lookup:function(){var n=this,t;$("#tcError").html("").addClass("hide");t=$("#tcModal").data("url");n.callAPI("get",t,null,function(t){$(".modal-body").html(t);$("#tcModal").modal("show");$("#countryCode").off("click");$("#search").off("click");$("#countryCode").on("change",n.toggleState);$("#search").on("click",$.proxy(n.searchTC,n))},n.onEditCardFailed)}}},AppBlockECard=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon,t=function(){var i,t,r;return($("#blockError").html("").addClass("hide"),i=$("#uploadFile")[0].files,t=[],i.length==0?t.push(window.resources.TextFileNameRequired):(r=i[0].name.substr(i[0].name.lastIndexOf(".")+1).toLowerCase(),r!="xls"&&r!="xlsx"&&t.push(window.resources.TextFileShouldBeExcel)),$("#Comments").val()==""&&$("input[name=bType]:checked").val()==2&&t.push(window.resources.TextCommentsRequiredPleaseReview),t.length>0)?n.showResponseError("blockError","errlist",t):!0};return{init:function(){$("#divComment").hide();$("input[name=bType]:radio").on("change",function(n){var t=$(n.target);$("#EcardsActionId").val(t.val());t.val()=="2"?$("#divComment").show():$("#divComment").hide()})},moveNext:function(){var i,u,r,f,e;if(!t())return!1;for(i=new FormData,i.append("Comments",$("#Comments").val()),i.append("IsReturnEcard",$("#IsReturnEcard:checked").val()),i.append("EcardsActionId",$("input[name=bType]:checked").val()),u=$("#uploadFile")[0].files,r=0;r<u.length;r++)i.append("uploadFile",u[r]);return f=$("#btnMoveNext").data("url"),e=$("#btnMoveNext").data("view"),jQuery.ajax({url:f,type:"POST",contentType:!1,processData:!1,data:i,dataType:"html",success:function(t){if($("#confirmBlockEcards").html(t),$("#confirmBlockEcards").removeClass("hide"),$("#index").addClass("hide"),$("#assignErrorstep2").html().length>1){var i=[];return i=$("#assignErrorstep2").html().split("\n").filter(function(n){return n.length!=0}),$("#btnConfirm").prop("disabled",!0),n.showResponseError("assignErrorstep2","errlist",i)}},error:function(t){$("#success").html("");n.showResponseError("blockError","errlist",t);$("#uploadFile").val("");n.focusMessage()}}),!1},movePrevious:function(n){return $(n).toggleClass("hide",!1),$("#index").toggleClass("hide",!1),$("#confirmBlockEcards").toggleClass("hide",!0),!1},validateStudentSelection:function(){var t=[],i=$("input:checked").length;return(i<1&&t.push(window.resources.TextPleaseSelectAtLeastOneUnblocked),n.showResponseError("assignErrorstep2","errlist",t),t.length===0)?!0:!1},Submit:function(t){var r=this,i;if(r.validateStudentSelection()){i="assignErrorstep2";$("#btnConfirm").submit();var u=$("#btnConfirm").data("url"),e=$(t).data("url"),f=$("#frmConfirm").serializeArray();return jQuery.post(u,f,function(n){$("#completeBlockEcards").html(n);$("#completeBlockEcards").removeClass("hide");$("#confirmBlockEcards").addClass("hide");$("#index").addClass("hide")}).fail(function(t){n.showResponseError(i,"errlist",t)}).always(function(){}),!1}}}},AppEcardClosureReport=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon,t=function(){$("#assignError").html("");$("#assignError").addClass("hide");var t=[],i=$("#ddlTC option:selected").val(),r=$("#TcId").val(),u=$("#ddlReportType option:selected").val();return i<=0&&!r&&(t[t.length]=window.resources.TextAtleastOneValue),i>0&&r!=""&&(t[t.length]=window.resources.TextTcORTcId),u==0&&(t[t.length]=window.resources.TextReportTypeRequired),n.showResponseError("assignError","errlist",t)};return{init:function(){var n=this;$("input[type=radio][name=rdbTcStatus]").on("change",function(t){var i=$(t.target);filterBy=i.val();n.getTrainingcenters(filterBy)})},getTrainingcenters:function(t){var i=$("#activeTCUrl").data("url"),r={isTcActive:t=="1"};jQuery.get(i,r,function(n){var t=[];t.push($("<option/>",{value:"",text:window.resources.SelectTrainingCenter}));n&&n.length>0?($.each(n,function(n,i){t.push($("<option/>",{value:i.Id,text:i.Name}))}),$("#ddlTC").empty().append(t),$("#ddlTC").val("")):$("#ddlTC").empty().append(t)}).error(function(t){$("#ddlTC").empty();n.showResponseError("reportError","errlist",t)})},btnClick_search_inventory:function(){if(!t())return!1;var r=$("#ddlTC option:selected").val(),u=$("#TcId").val(),i=$("#ddlReportType option:selected").val(),e=this,f=$("#inventoryUrl").data("url");return jQuery.ajax({url:f,type:"GET",dataType:"html",data:{TrainingCeneterId:r,TcId:u,reportType:i},success:function(t){var r,u;$("#partial").html(t);r=$("#example").DataTable({pageLength:25,order:[[1,"asc"]]});r.context.length>0&&(u=new $.fn.dataTable.Buttons(r,{buttons:[{extend:"excelHtml5",title:i=="1"?n.getFileName("Purchase-Report"):n.getFileName("Closure Inventory Report")}]}),$("#expotbutton").prepend(u.container()).find("a.dt-button").addClass("btn btn-primary").text(window.resources.TextDownload))},error:function(t){n.showResponseError("assignError","errlist",t)}}),!1},btnClick_reset_inventory:function(){$("#ddlTC").val("");$("#TcId").val("");$("#partial").html("")}}},AppCommon=function(){$.ajaxSetup({async:!0,cache:!1});String.prototype.format||(String.prototype.format=function(){var n=arguments;return this.replace(/{(\d+)}/g,function(t,i){return typeof n[i]!="undefined"?n[i]:t})});var n={"1":{video:"https://player.vimeo.com/video/237119980",title:"",description:"Assign eCards to an Instructor or eCard Location (TCC/TC Admin)"},"2":{video:"https://player.vimeo.com/video/237120024",title:"",description:"Assign eCards Directly to Students (TCC/TC Admin)"},"3":{video:"https://player.vimeo.com/video/237120061",title:"",description:"Assign eCards to Students (Instructor and eCard Location Admin) "},"4":{video:"https://player.vimeo.com/video/237659367",title:"eCard Status",description:"eCard Status (TCC/TC Admin) "},"5":{video:"https://player.vimeo.com/video/237659296",title:"eCard Status",description:"eCard Status (Instructor)"},"6":{video:"https://player.vimeo.com/video/237659325",title:"eCard Status",description:"eCard Status (eCard Admin for an eCard Location)"},"7":{video:"https://player.vimeo.com/video/237659340",title:"Reports",description:"Reports (TCC/TC Admin, eCard Location Admin and Instructor roles)"}};return{showResponseError:function(n,t,i){var r,u,f;if(!i||i.length<=0)return!0;r=$("#"+n);r.html("");u=this.ExtractError(i);f='<button type="button" class="close" aria-label="Close"><span aria-hidden="true">&times;<\/span><\/button><div class="alert-notification"><p>'+window.resources.TextError+'<\/p><div><ul id="'+t+'"><\/ul><\/div><\/div>';r.append(f);r.on("click",".close",this.hideError);return $.each(u,function(n,i){i&&$("#"+t).append("<li>"+i+"<\/li>")}),r.toggleClass("hide",!1),r.removeClass("alert-warning"),r.toggleClass("alert-danger",!0),this.focusMessage(),!1},ExtractError:function(n){var t,i,u,r;if(!n)return"";if(typeof n=="string")t=n.split("\r\n");else if($.isArray(n))t=n;else{t="";try{i=t=jQuery.parseJSON(n.responseText);i&&i.errorMessage?t=i.errorMessage.split("\r\n"):i&&i.Message&&(t=i.Message.split("\r\n"))}catch(f){console.log(f);u=new DOMParser;r=u.parseFromString(n.responseText,"text/html");r&&(t=$(r.getElementsByTagName("h2")).text());(!t||t.indexOf("502")>-1)&&(t=window.resources.TextGeneralErrorMsg);t=t.split("\r\n")}}return t},showWarning:function(n,t,i){var r,u;if(!i||i.length<=0)return!0;r=$("#"+n);r.html("");u='<button type="button" class="close" aria-label="Close"><span aria-hidden="true">&times;<\/span><\/button><div class="alert-notification"><p>'+window.resources.TextWarning+'<\/p><div><P id="'+t+'" ><\/p><\/div><\/div>';r.append(u);r.on("click",".close",this.hideError);return $("#"+t).html(i),r.toggleClass("hide",!1),r.removeClass("alert-danger"),r.toggleClass("alert-warning",!0),this.focusMessage(),!1},hideError:function(){$(this).parent().toggleClass("hide",!0)},focusArea:function(n){$("html, body").animate({scrollTop:$(n).offset().top},1e3)},focusMessage:function(){$("html, body").animate({scrollTop:$("#top-header").offset().top},1e3)},getCurrentDate:function(){return new Date},getMonthOldDate:function(){var n=new Date;return new Date(n.setMonth(n.getMonth()-1))},getFiveDaysOldDate:function(){var n=new Date;return new Date(n.setDate(n.getDate()-5))},getDateOnDays:function(n){n||(n=5);var t=new Date;return new Date(t.setDate(t.getDate()-n))},getFileName:function(n){n||(n="eCards");var t=new Date;return"{0}_{1}-{2}-{3}-{4}{5}-{6}-{7}".format(n,t.getFullYear(),t.getMonth()+1,t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds())},getDateFormatError:function(n){return window.resources.TextErrorInvalidDate.replace("{0}","MM/DD/YYYY").replace("{1}",n)},isValidDate:function(){var n=Array.prototype.slice.call(arguments),t;if(!n)return!1;if($.type(n)==="array"){for(window.gdateformat||(window.gdateformat="mm/dd/yy"),t=0;t<n.length;t++)try{$.datepicker.parseDate(window.gdateformat,n[t])}catch(i){return!1}return!0}return!1},initDatePicker:function(n){if($.datepicker&&$(".datepicker").length){var t="en-US";window.gdateformat="mm/dd/yy";$.datepicker.regional[t].closeText=window.resources.Close;$.datepicker.setDefaults($.datepicker.regional[t]);$(".datepicker").each(function(){var i=$(this),r=$("#"+i.attr("id")),u=i.data("date-format"),f=i.data("mindate");r.datepicker($.extend({minDate:f?f:null,buttonText:window.resources.TextCalendarView,dateFormat:u?u:window.gdateformat}));n&&(r.datepicker("option",{showOn:"button",buttonImage:"//static.heart.org/ahaecc/images/calendar.png",buttonImageOnly:!1,closeText:$.datepicker.regional[t].closeText,dayNamesShort:$.datepicker.regional[t].dayNamesShort,showButtonPanel:!0,onClose:removeAria}),dayTripper())})}},getHelpLinks:function(t){return n[t]}}},AppDisteCardStatus=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon,t=function(t){$("#assignError").html("");$("#assignError").addClass("hide");var f=$("#eCardStatusForm").find('select[id="CourseId"]').val(),r=$("#eCardStatusForm").find('input[id="StartDate"]').val(),u=$("#eCardStatusForm").find('input[id="EndDate"]').val(),i=[];return(t&&(!f||f.length<=0)&&(i[i.length]=window.resources.TextCourseRequired),r&&u||(i[i.length]=window.resources.TextTransactionsDatesRequired),(r||u)&&!n.isValidDate(r,u)&&(i[i.length]=n.getDateFormatError(window.resources.TransactionDate)),i.length>0)?(n.showResponseError("assignError","errlist",i),!1):!0};return{init:function(){var n=this;$("#CourseId").on("change",function(){var t=$("#CourseId").find(":selected").map(function(n,t){return t.value}).get().join(","),i;n.btnClick_reset_ecardRequests(!0);$("#divDistributorTC").toggleClass("hide",!0);t?(i=$("input[name=transactionBy]:checked").val(),i==="tc"&&($("#divDistributorTC").toggleClass("hide",!1),n.getTCList({courseIds:t}))):$("#divDistributorTC").toggleClass("hide",!0);$("#ddlTC").val("")});$("input[type=radio][name=transactionBy]").on("change",function(t){n.toggleOptions(t)});n.initMultiSelect()},initMultiSelect:function(){$("#CourseId").multiselect({buttonWidth:"100%",disableIfEmpty:!1,includeSelectAllOption:!0,selectAllText:window.resources.TextSelectAll,allSelectedText:window.resources.TextAllSelected,nonSelectedText:window.resources.SelectCourses,nSelectedText:" "+window.resources.TextSelectedCourses});$(".multiselect-bin").find("button").attr("aria-required","true").attr("id","multiCourse")},toggleOptions:function(n){var t=this,i=$(n.target);$("#CourseId").multiselect("deselectAll",!1).multiselect("refresh");$("#ddlTC").val("");$("#divDistributorTC").toggleClass("hide",!0)},getTCList:function(t){var i=$("#tc").data("url");jQuery.get(i,t,function(n){if(n&&n.length>0){var t=[];t.push($("<option/>",{value:"",text:window.resources.SelectTrainingCenter}));$.each(n,function(n,i){t.push($("<option/>",{value:i.TrainingCenterId,text:i.Name}))});$("#ddlTC").empty().append(t);$("#ddlTC").val("")}}).error(function(t){$("#ddlTC").empty();n.showResponseError("assignError","errlist",t)})},btnClick_search_ecardRequests:function(i){var u=this,r;return t(i)?(r=$("#fetchReq").data("url"),jQuery.ajax({url:r,type:"POST",dataType:"html",data:$("#eCardStatusForm").serialize(),success:function(t){var r,u;$("#partial").html(t);r=$("#example").DataTable({pageLength:25,order:window.area.toLowerCase()==="distributor"?[[6,"desc"]]:[[5,"desc"]],columnDefs:[{targets:[0],visible:!1}]});i?$("#spdaysView").toggleClass("hide",!0):$("#spdaysView").toggleClass("hide",!1);r.context.length>0&&(u=new $.fn.dataTable.Buttons(r,{buttons:[{extend:"excelHtml5",title:n.getFileName("Distributor eCard Status"),exportOptions:{columns:":visible"}}]}),$("#expotbutton").prepend(u.container()).find("a.dt-button").addClass("btn btn-primary").text(window.resources.TextDownload),i&&n.focusArea("#partial"))},error:function(t){n.showResponseError("assignError","errlst",t)}}),!1):!1},btnClick_reset_ecardRequests:function(t){var i=this;n.showResponseError("assignError","errlist","");$("#ddlTC").val("");$("#divDistributorTC").toggleClass("hide",!0);t||($("#CourseId").multiselect("deselectAll",!1).multiselect("refresh"),$("#StartDate").datepicker("setDate",n.getMonthOldDate()),$("#EndDate").datepicker("setDate",n.getCurrentDate()),i.btnClick_search_ecardRequests(!1));t||n.focusMessage()}}},AppECardAction=function(n){$.ajaxSetup({async:!0,cache:!1});var t=new AppCommon;return{init:function(){$("#resendModal").on("shown.bs.modal",focusResend)},focusResend:function(){var n=$(this);n.find("#studentemail").focus();n.find("#btnResendSMS").focus()},validateEmail:function(n){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/igm.test(n)},validateMobilePhone:function(n){return $.trim(n).match(/^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/im)?!0:!1},callAPI:function(n,t,i,r,u){n==="get"?$.get(t,i,r).error(function(n){u(n)}):$.post(t,i,r).error(function(n){u(n)})},action_Click:function(n){var i,t,r,u;try{n.preventDefault();i=this;$("#resendModal").on("shown.bs.modal",i.focusResend);$("#resendSMSModal").on("shown.bs.modal",i.focusResend);if($("#resendModal").modal("hide"),$("#resendSMSModal").modal("hide"),$("#resendError").toggleClass("hide",!0),$("#resendSMSError").toggleClass("hide",!0),$("#divAlert").toggleClass("hide",!0),t=$(n.target),r={ECardUId:t.data("eid"),StudentId:t.data("stuid"),EmailAddress:t.data("email"),MobilePhone:t.data("mobilephone"),FirstName:t.data("firstname"),LastName:t.data("lastname"),Url:t.data("url"),Status:t.data("status"),CourseType:t.data("coursetype")},t.data("action")=="email"){$("#resendModal").modal("show");$("#studentemail").val(r.EmailAddress);$("#btnResend").off("click");$("#lnkSaveResend").off("click");$("#btnResend").on("click",r,$.proxy(i.reSend,i))}else if(t.data("action")=="sms"){$("#resendSMSModal").modal("show");$("#btnResendSMS").off("click");$("#btnResendSMS").on("click",r,$.proxy(i.validateReSendSMS,i));$("#studentphone").val(r.MobilePhone)}u={ECardUId:t.data("eid"),StudentId:t.data("stuid"),EmailAddress:t.data("email"),CanSaveEmail:!0,Url:t.data("url")};$("#lnkSaveResend").on("click",u,$.proxy(i.reSend,i));r.CourseType==4&&$("#lnkSaveResend").remove()}catch(f){}},validateReSendSMS:function(n){var i,f;n.preventDefault();var r=this,u=n.data,e=$(n.target);if($("#resendSMSError").toggleClass("hide",!0),i=[],u.MobilePhone||(i[i.length]=window.resources.TextMobileNumberRequired),i.length>0)return t.showResponseError("resendSMSError","emailErr",i);f=u.Url;r.callAPI("post",f,u,r.onSuccessResend,r.onFailResend)},reSend:function(n){var u,i,r,f;if(n.preventDefault(),u=this,i=n.data,i.EmailAddress=$("#studentemail").val(),$("#resendError").toggleClass("hide",!0),r=[],i.EmailAddress||(r[r.length]=window.resources.TextEmailRequired),i.EmailAddress&&!u.validateEmail(i.EmailAddress)&&(r[r.length]=window.resources.TextInvalidEmail),r.length>0)return t.showResponseError("resendError","emailErr",r);f=i.Url;u.callAPI("post",f,i,u.onSuccessResend,u.onFailResend)},onSuccessResend:function(t){if(t){$("#resendModal").modal("hide");var i=$("#hdnTransId").val();n.getECards(i,!0)}},onFailResend:function(n){t.showResponseError("resendError","emailErr",n)},editECard:function(n){n.preventDefault();$("#divEditError").toggleClass("hide",!0);$("#divEditAlert, #divAlert").toggleClass("hide",!0);var t=this,i=$(n.target.parentElement),r=i.data("url"),u={eCardGuid:i.data("eid"),profileId:$("#profileId option:selected").val()};t.callAPI("post",r,u,$.proxy(t.onLoadingEditCard,t),t.onFailLoadingEditECard)},onLoadingEditCard:function(n){n&&n.length>0&&($("#divStudentECards").toggleClass("hide",!0),$("#divEditCard").toggleClass("hide",!1).html(n),t.initDatePicker(!0),t.focusMessage())},onFailLoadingEditECard:function(n){t.showResponseError("divStuTransError","stuErr",n)},validateEdit:function(){var f=this,n=[],e=window.searchCardModel.FirstName=$("#fname").val(),o=window.searchCardModel.LastName=$("#lname").val(),i=window.searchCardModel.Email=$("#emailaddress").val(),r,u;return window.searchCardModel.Phone=$("#phone").val(),window.searchCardModel.ECardUId=$("#hdnEUId").val(),r=window.searchCardModel.CourseDate=$("#courseDate").val(),window.searchCardModel.HasModules=$("input[id^=courseModule]").length>0,window.searchCardModel.ModuleIds=$("input[id^=courseModule]:checked").map(function(){return this.value}).get().join(","),u=window.searchCardModel.InstructorId=$("#newInstructor option:selected").val(),window.searchCardModel.StartDate="",window.searchCardModel.EndDate="",window.searchCardModel.IssueDate="",e||(n[n.length]=window.resources.TextFirstNameRequired),o||(n[n.length]=window.resources.TextLastNameRequired),i?f.validateEmail(i)||(n[n.length]=window.resources.TextInvalidEmail):n[n.length]=window.resources.TextEmailRequired,r||(n[n.length]=window.resources.TextCourseDateRequired),i!=$("#hdnPreviuosEmail").val()&&(i.toLowerCase()==$("#hdnLoggedInUserEmail").val().toLowerCase()&&(n[n.length]=window.resources.TextInvalidStudentEmailLoggedInMsg),i.toLowerCase()==$("#newInstructor option:selected").data("instremail").toLowerCase()&&(n[n.length]=window.resources.TextInvalidStudentEmailMsg)),u||(n[n.length]=window.resources.TextInstructorRequired),t.showResponseError("divEditError","editErr",n)},saveInfo:function(n){n.preventDefault();$("#divEditError, #divEditAlert").toggleClass("hide",!0);var t=this,i=$(n.target),r=i.data("url");if(!t.validateEdit())return!1;t.callAPI("post",r,window.searchCardModel,t.onSuccessSave,t.onEditCardFailed)},onSuccessSave:function(n){n&&($("#divEditAlert").toggleClass("hide",!1),t.focusMessage())},onEditCardFailed:function(n){t.showResponseError("divEditError","editErr",n)},loadStudents:function(t){t.preventDefault();$("#divStudentECards").toggleClass("hide",!1);$("#divEditCard").html("").toggleClass("hide",!0);var i=$("#hdnTransId").val();n.getECards(i)}}},AppReclaim=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon,i=function(){$("#reClaimErr").html("");$("#reClaimErr").addClass("hide");var t=[],f=$("#courseId option:selected").val(),r=$("#fromSource option:selected").val(),e=$("#ddlTC option:selected").val(),o=$("#ddlSite option:selected").val(),s=$("#RoleId option:selected").val(),i=$("#qty").val(),u=parseInt($("#divAvailQty").text());return(!f||f<=0)&&(t[t.length]=window.resources.TextCourseRequired),(!e||e<=0)&&(t[t.length]=window.resources.TextTrainingCenterRequired),(s==RoleType.TSC.value||s==RoleType.TSAdmin.value)&&(!o||o<=0)&&(t[t.length]=window.resources.TextTrainingSiteRequired),(!r||r<=0)&&(t[t.length]=window.resources.TextInstructorRequired),u<=0&&(t[t.length]=window.resources.TextInstructorLowInventory),r>0&&(i&&i!="0"?(!jQuery.isNumeric(i)||Math.floor(i)!=i||parseInt(i)<=0)&&(t[t.length]=window.resources.TextReclaimQtyPositive):t[t.length]=window.resources.TextReclaimQuantityRequired),u>0&&parseInt(i)>u&&(t[t.length]=window.resources.TextReclaimExceedsQty),n.showResponseError("reClaimErr","errlist",t)},t=function(){$("#confirmReclaim").hide();$("#fromType").toggleClass("hide",!0);$("#ddlSource").toggleClass("hide",!0);$("#divBox").toggleClass("hide",!0);$("#lnkConfirm").toggleClass("hide",!0);$("#ddlEcardLocation").toggleClass("hide",!0)};return{init:function(){var n=this;t();$("#RoleId").on("change",function(t){var i=$(t.target).val(),r;i>0?($("#divTC").toggleClass("hide",!1),$("#assignError, #divBox, #divTC,#divSite, #divLoc, #divAssignTo, #divSubmit").toggleClass("hide",!0),r=$(t.target).data("url"),n.getReclaimTargets(r,{selectedRoleId:i},n.loadTrainingcenters)):($("#divTC").toggleClass("hide",!0),$("#divSite").toggleClass("hide",!0),$("#divCourse").toggleClass("hide",!0),$("#ddlSource").toggleClass("hide",!0),$("#divBox").toggleClass("hide",!0),$("#lnkConfirm").toggleClass("hide",!0))});if($("#ddlTC").length)$("#ddlTC").on("change",function(t){var u=$(t.target).data("courseurl"),f=$(t.target).data("siteurl"),i=$(t.target).val(),r=$("#RoleId").val();i>0?r==RoleType.TSC.value||r==RoleType.TSAdmin.value?n.getReclaimTargets(f,{tcId:i,roleId:r},n.loadSites):n.getReclaimTargets(u,{orgId:i,orgType:"tc"},n.loadCourses):($("#divCourse").toggleClass("hide",!0),$("#ddlSource").toggleClass("hide",!0),$("#divBox").toggleClass("hide",!0),$("#lnkConfirm").toggleClass("hide",!0))});$("#ddlSite").on("change",function(t){var r=$(t.target).data("courseurl"),i=$(t.target).val();i>0?n.getReclaimTargets(r,{orgId:i,orgType:"ts"},n.loadCourses):($("#divCourse").toggleClass("hide",!0),$("#ddlSource").toggleClass("hide",!0),$("#divBox").toggleClass("hide",!0),$("#lnkConfirm").toggleClass("hide",!0))});$("#courseId").on("change",function(i){var f,e,u,o,r;t();n.clearErrorMsg();f=$(i.target).val();f>0?(e=$(i.target).data("url"),r=$("#RoleId option:selected").val(),r==RoleType.TCC.value||r==RoleType.TCAdmin.value?u=$("#ddlTC option:selected").val():(u=$("#ddlTC option:selected").val(),o=$("#ddlSite option:selected").val()),r=$("#RoleId option:selected").val(),n.loadTargets(e,{courseId:$("#courseId option:selected").val(),tcId:u,roleId:r,tsId:o},window.resources.TextSelectInstructor)):($("#ddlSource").toggleClass("hide",!0),$("#divBox").toggleClass("hide",!0),$("#lnkConfirm").toggleClass("hide",!0))});if($("#fromType").length){function i(n){var t=$("#lblFromSource"),i=t.find("span");t.html(n);t.append(i)}$("input[type=radio][name=reclaimType]").on("change",function(r){n.clearErrorMsg();t();$("#fromType").toggleClass("hide",!1);var f=$(r.target),o=f.data("url"),e=null,u;f.val()==="fromIns"?(e={courseId:$("#courseId option:selected").val()},i(window.resources.TextInstructor),u=window.resources.TextSelectInstructor):(i(window.resources.TexteCardLocation),u=window.resources.TextSelecteCardLocation);$("#ddlSource").toggleClass("hide",!1);n.loadTargets(o,e,u)})}if($("#ddlEcardLocation").length)$("#locationList").on("change",function(t){var i=$(t.target).data("url"),r=$(t.target).val(),u=$("#ddlTC option:selected").val();r>0?n.loadTargets(i,{courseId:$("#courseId option:selected").val(),tcId:u},window.resources.TextSelectInstructor):($("#ddlSource").toggleClass("hide",!0),$("#divBox").toggleClass("hide",!0),$("#lnkConfirm").toggleClass("hide",!0))});$("#fromSource").on("change",function(t){var i=$(t.target).data("url");$(t.target).val()>0?(n.getAvailableQuantity(i,$(t.target).val()),$("#qty").val(0)):$("#divBox").toggleClass("hide",!0)})},loadLocations:function(n){if(n&&n.length>0){var t=[];t.push($("<option/>",{value:"",text:window.resources.TextSelecteCardLocation}));$.each(n,function(n,i){t.push($("<option/>",{value:i.Id,text:i.Name}))});$("#ddlSource").toggleClass("hide",!0);$("#ddlEcardLocation").toggleClass("hide",!1);$("#divBox").toggleClass("hide",!0);$("#lnkConfirm").toggleClass("hide",!0);$("#locationList").empty().append(t);$("#locationList").val("")}},loadTrainingcenters:function(n){if(n&&n.length>0){var t=[];t.push($("<option/>",{value:"",text:window.resources.SelectTrainingCenter}));$.each(n,function(n,i){t.push($("<option/>",{value:i.TrainingCenterId,text:i.Name}))});$("#ddlSource").toggleClass("hide",!0);$("#divCourse").toggleClass("hide",!0);$("#divBox").toggleClass("hide",!0);$("#lnkConfirm").toggleClass("hide",!0);$("#divTC").toggleClass("hide",!1);$("#ddlTC").empty().append(t);$("#ddlTC").val("")}},loadSites:function(n){if(n&&n.length>0){var t=[];t.push($("<option/>",{value:"",text:window.resources.TextSelectTrainingSite}));$.each(n,function(n,i){t.push($("<option/>",{value:i.Id,text:i.Name}))});$("#ddlSource").toggleClass("hide",!0);$("#divCourse").toggleClass("hide",!0);$("#divBox").toggleClass("hide",!0);$("#lnkConfirm").toggleClass("hide",!0);$("#divSite").toggleClass("hide",!1);$("#ddlSite").empty().append(t).val("")}},loadCourses:function(n){if(n&&n.length>0){var t=[];t.push($("<option/>",{value:"",text:window.resources.SelectCourse}));$.each(n,function(n,i){t.push($("<option/>",{value:i.CourseId,text:i.Name}))});$("#ddlSource").toggleClass("hide",!0);$("#ddlEcardLocation").toggleClass("hide",!0);$("#divBox").toggleClass("hide",!0);$("#lnkConfirm").toggleClass("hide",!0);$("#divCourse").toggleClass("hide",!1);$("#courseId").empty().append(t);$("#courseId").val("")}},getReclaimTargets:function(t,i,r){jQuery.get(t,i?i:null,r).error(function(t){n.showResponseError("reClaimErr","errlist",t);$("#ddlSource").toggleClass("hide",!1);$("#fromSource").empty();$("#divBox").toggleClass("hide",!0);$("#lnkConfirm").toggleClass("hide",!0)})},loadTargets:function(t,i,r){var u=[];u.push($("<option/>",{value:"",text:r}));jQuery.get(t,i,function(t){if(t&&t.length>0)$.each(t,function(n,t){u.push($("<option/>",{value:t.Id,text:t.Name}))});else{var i=[];i[i.length]=window.resources.TextNoInstructorsFound;n.showResponseError("reClaimErr","errlist",i)}$("#ddlSource").toggleClass("hide",!1);$("#divBox").toggleClass("hide",!0);$("#lnkConfirm").toggleClass("hide",!0);$("#fromSource").empty().append(u);$("#fromSource").val("")}).error(function(t){n.showResponseError("reClaimErr","errlist",t);$("#ddlSource").toggleClass("hide",!1);$("#fromSource").empty().append(u);$("#divBox").toggleClass("hide",!0);$("#lnkConfirm").toggleClass("hide",!0)})},getAvailableQuantity:function(t,i){var u,r,f,e;$("#divBox").toggleClass("hide",!0);u=$("#courseId option:selected").val();r=$("#RoleId option:selected").val();f=r==RoleType.TCC.value||r==RoleType.TCAdmin.value?$("#ddlTC option:selected").val():$("#ddlSite option:selected").val();e={courseId:u,sourceId:i,orgId:f};jQuery.get(t,e,function(n){n&&($("#divBox").toggleClass("hide",!1),$("#divAvailQty").text(n),$("#lnkConfirm").toggleClass("hide",!1))}).error(function(t){n.showResponseError("reClaimErr","errlist",t)})},clearErrorMsg:function(){$("#reClaimErr").html("");$("#reClaimErr").toggleClass("hide",!0)},buildRequest:function(){window.eLocAssignmentViewModel.LocationId=$("#locationList option:selected").val();$("#hdnInstrName").val($("#fromSource option:selected").text());window.eLocAssignmentViewModel.RoleId=$("#RoleId option:selected").val();window.eLocAssignmentViewModel.InstructorId=$("#fromSource option:selected").val();window.eLocAssignmentViewModel.InstructorName=$("#fromSource option:selected").text();window.eLocAssignmentViewModel.TCId=$("#ddlTC option:selected").val();window.eLocAssignmentViewModel.TCName=$("#ddlTC option:selected").text();window.eLocAssignmentViewModel.TSId=$("#ddlSite option:selected").val();window.eLocAssignmentViewModel.TSName=$("#ddlSite option:selected").val();window.eLocAssignmentViewModel.CourseName=$("#courseId option:selected").text();window.eLocAssignmentViewModel.CourseId=$("#courseId option:selected").val();window.eLocAssignmentViewModel.AssignedQty=$("#qty").val();window.eLocAssignmentViewModel.AvailableQty=$("#divAvailQty").text();window.eLocAssignmentViewModel.IsInstructorReclaim=!0;window.eLocAssignmentViewModel.ReclaimSourceId=$("#fromSource option:selected").val()},loadReclaimMain:function(){return $("#confirmReclaim").hide(),$("#reclaimMain").show(),$("#confirmReclaim").html(""),!1},loadConfirmReclaim:function(){var t=!1,r;return($("#ddlTC").length&&(t=i(),t&&this.buildRequest()),!t)?!1:(r=$("#lnkConfirm").data("url"),jQuery.post(r,$("#ddlTC").length>0?window.eLocAssignmentViewModel:window.tcAssignmentViewModel,function(n){n&&($("#confirmReclaim").show(),$("#reclaimMain").hide(),$("#confirmReclaim").html(n),$("#divSourceName").html($("#hdnInstrName").val()))}).error(function(t){n.showResponseError("reClaimErr","errlist",t)}),!1)},loadCompleteReclaim:function(){var t,r,u;return($("#lnkComplete").prop("disabled",!0),t=!1,$("#ddlTC").length&&(t=i(),t&&this.buildRequest()),!t)?($("#lnkComplete").prop("disabled",!1),!1):(r=$("#lnkComplete").data("url"),u=this,$("#hdnAvailQty").val($("#divConfirmAvailQty").text()),jQuery.post(r,$("#ddlTC").length>0?window.eLocAssignmentViewModel:window.tcAssignmentViewModel,function(n){n&&($("#confirmReclaim").show(),$("#reclaimMain").hide(),$("#confirmReclaim").html(n),$("#divSourceName").html($("#hdnInstrName").val()),$("#counter").text($("#hdnAvailQty").val()),u.fnCounter())}).error(function(t){n.showResponseError("reClaimConfirmErr","errlist1",t)}).always(function(){$("#lnkComplete").prop("disabled",!1)}),!1)},fnCounter:function(){$({countNum:$("#hdnAvailQty").val()}).delay(1e3).animate({countNum:$("#divCompAvailQty").text()},{duration:1500,easing:"linear",step:function(){$("#counter").text(Math.floor(this.countNum))},complete:function(){$("#counter").text(this.countNum);$("#counter").addClass("animated fadeOut");$("#counter").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$("#counter").delay(100).animate({height:0},500)})}})}}},AppEcardRequest=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon,i=function(){$("#search_error").html("");$("#search_error").addClass("hide");var u=$("#eCardRequestsForm").find('select[id="SelectedCourseId"]').val(),i=$("#eCardRequestsForm").find('input[id="StartDate"]').val(),r=$("#eCardRequestsForm").find('input[id="EndDate"]').val(),t=[];return((""===u||u<=0)&&(t[t.length]=window.resources.TextCourseRequired),i&&r||(t[t.length]=window.resources.TextAssignmentDateRequired),(i||r)&&!n.isValidDate(i,r)&&(t[t.length]=n.getDateFormatError(window.resources.DateOfAssignment)),t.length>0)?n.showResponseError("search_error","errlist",t):!0},r=function(){var o;$("#assignError").html("");$("#assignError").addClass("hide");var t=[],f=$("#CourseId option:selected").val(),r=$("#DistributorId option:selected").val(),e=$("#tcIdNum").val().trim(),i=$("#qty").val(),u=$("#availQty").val();return((!f||f.length<=0)&&(t[t.length]=window.resources.TextCourseRequired),(!r||r<=0)&&(t[t.length]=window.resources.TextDistributorRequired),$("input[name=EntityId]").val()=="1"&&(e||(t[t.length]=window.resources.TextTrainingCenterRequired),(r||r>0)&&((""===u||u<=0)&&(t[t.length]=window.resources.TextDistributorLowInventory),u>0&&parseInt(i)>u&&(t[t.length]=window.resources.TextRequestQtyExceeded))),(!jQuery.isNumeric(i)||Math.floor(i)!=i||parseInt(i)<=0)&&(t[t.length]=window.resources.TextAssignQtyRequired),t.length<=0&&$("input[name=EntityId]").val()=="1"&&($.ajaxSetup({async:!1,cache:!1}),o=$("#btnValidate").data("url"),jQuery.get(o,{courseId:f,tcIdNumber:e},function(n){n&&n.Name?($("#chosenTCId").val(n.TrainingCenterId),$("#hdnTCName").val(n.Name)):t[t.length]=window.resources.TextTCCourseNotAligned}).error(function(i){var r=n.ExtractError(i);$.each(r,function(n,i){i&&(t[t.length]=i)})}).always(function(){$.ajaxSetup({async:!0,cache:!1})})),t.length>0)?n.showResponseError("assignError","errlist",t):!0},t=function(t,i){if($("input[name=EntityId]").val()=="1"){var r=$("#DistributorId").data("url");jQuery.get(r,{courseId:$("#CourseId option:selected").val(),distbId:t},i).error(function(t){$("#confirmError").is(":visible")?n.showResponseError("confirmError","err1",t):n.showResponseError("assignError","err1",t)})}},u=function(t,i){var r=$("#CourseId").data("url");jQuery.get(r,{courseId:$("#CourseId option:selected").val(),isInternational:t},i).error(function(t){$("#confirmError").is(":visible")?n.showResponseError("confirmError","err1",t):n.showResponseError("assignError","err1",t)})},f=function(){window.assignViewModel.EntityId=$("input[name=EntityId]").val();window.assignViewModel.DistributorId=$("#DistributorId option:selected").val();window.assignViewModel.CourseId=$("#CourseId option:selected").val();window.assignViewModel.TCId=null;window.assignViewModel.EntityId=="1"&&(window.assignViewModel.TCId=$("#chosenTCId").val());window.assignViewModel.AssignedQuantity=$("#qty").val();window.assignViewModel.AvailableQuantity=$("#availQty").val()};return{init:function(){var i=this,n;$(document).ready(function(){$("#assignModel").on("shown.bs.modal",i.focusResend)});n=$("#CourseId option:selected").val();(""===n||n=="0")&&$("#DistributorId").prop("disabled",!0);$("input[name=EntityId]").val()=="2"&&($("#tcLookup").hide(),$("#distQty").hide(),$("#boxContent").toggleClass("boxed-content",!1));$("#CourseId").on("change",function(n){var i=$(n.target),t;$("input[name=EntityId]").val()=="1"&&$("#DistributorId").val("");$("#DistributorId").prop("disabled",!i.val());$("#availQty").val(0);$("#txtAvailQty").text(0);t=$("#CourseId :selected").data("coursetype");u(t,function(n){var t=$("#DistributorId");t.empty();t.append($("<option/>",{value:0,text:"Select a Distributor"}));$.each(n,function(n,i){t.append($("<option/>",{value:i.UserId,text:i.DisplayName}))})})});$("#DistributorId").on("change",function(n){if($("input[name=EntityId]").val()=="1"){var i=$(n.target).val();i?t(i,function(n){n&&($("#txtAvailQty").text(n),$("#availQty").val(n))}):($("#txtAvailQty").text(0),$("#availQty").val(0))}});$("#assignType input[name=aType]:radio").on("change",function(n){var t=$(n.target);$("#EntityId").val(t.val());t.val()=="1"?($("#tcLookup").show(),$("#distQty").show(),$("#boxContent").toggleClass("boxed-content",!0),$("#DistributorId").val(""),$("#availQty").val(0),$("#txtAvailQty").text(0)):($("#tcLookup").hide(),$("#chosenTCId").val(0),$("#tcIdNum").val(""),$("#distQty").hide(),$("#boxContent").toggleClass("boxed-content",!1));$("#DistributorId").prop("selectedIndex",0)})},focusResend:function(){var n=$(this);n.find("#btnClose").focus()},initMultiSelect:function(){$("#SelectedCourseId").multiselect({buttonWidth:"100%",disableIfEmpty:!1,includeSelectAllOption:!0,selectAllText:window.resources.TextSelectAll,allSelectedText:window.resources.TextAllSelected,nonSelectedText:window.resources.SelectCourses,nSelectedText:" "+window.resources.TextSelectedCourses})},btnClick_search_ecardRequests:function(){if(!i())return!1;var t=$("#eCardRequestsForm").find('select[id="SelectedCourseId"]').find(":selected").map(function(n,t){return t.value}).get().join(","),r=$("#eCardRequestsForm").find('input[id="StartDate"]').val(),u=$("#eCardRequestsForm").find('input[id="EndDate"]').val(),f={CourseIds:t,StartDate:r,EndDate:u},e=$("#fetchReq").data("url");return $.post(e,f,function(t){$("#partial").html(t);$("#example").DataTable({pageLength:25,order:[[4,"desc"]]});n.focusArea("#partial")}).error(function(t){n.showResponseError("search_error","err",t)}),!1},confirmAssignment:function(){return r()?($("#assignCards").toggleClass("hide",!0),$("#confirmAssignCards").toggleClass("hide",!1),$("#confirmLogo").toggleClass("hide",!1),$("#completeLogo").toggleClass("hide",!0),$("#confirmButtons").toggleClass("hide",!1),$("#completeButton").toggleClass("hide",!0),$("#boxTitle").html(window.resources.TextAssignECardsConfirmTitle),this.loadAssertion(),!1):!1},goBackToAssignment:function(){return $("#assignCards").toggleClass("hide",!1),$("#confirmAssignCards").toggleClass("hide",!0),!1},loadAssertion:function(){$("#tdCourse").html($("#CourseId option:selected").text());$("#tdTC").html($("#hdnTCName").val());$("#tdDistb").html($("#DistributorId option:selected").text());$("#tdAvailQty").html($("#availQty").val());$("#tdQty").html($("#qty").val());$("#EntityId").val()=="1"?($("#trDistb").show(),$("#trTC").show()):($("#trDistb").hide(),$("#trTC").hide())},completeAssignment:function(){var r=this,i;return f(),i=$("#btnComplete").data("url"),$.post(i,assignViewModel,function(){$("#assignCards").toggleClass("hide",!0);$("#confirmLogo").toggleClass("hide",!0);$("#completeLogo").toggleClass("hide",!1);$("#confirmButtons").toggleClass("hide",!0);$("#completeButton").toggleClass("hide",!1);$("#boxTitle").html(window.resources.TextAssignECardsCompleteTitle);r.loadAssertion();t($("#DistributorId option:selected").val(),function(n){n&&($("#tdAvailQty").html(n),$("#trDistb").find("td:first").text(window.resources.TextNewAvailableQuantity),$("#tdQty").html($("#qty").val()))})}).error(function(t){n.showResponseError("confirmError","err1",t)}),!1},toggleState:function(n){var t=$(n.target).val();t=="USA"||t=="CAN"?$("#stateDiv").show():$("#stateDiv").hide()},open_lookup:function(){var t=this,i;$("#tcError").html("").addClass("hide");i=$("#assignModel").data("url");jQuery.ajax({url:i,type:"GET",dataType:"html",success:function(n){$("#assignModelBody").html(n);$("#assignModel").modal("show");$("#countryCode").off("click");$("#search").off("click");$("#countryCode").on("change",t.toggleState);$("#search").on("click",$.proxy(t.searchTC,t))},error:function(t){n.showResponseError("assignError","err",t)}})},searchTC:function(n){var r,t,i;if(n.preventDefault(),r=this,$("#tcError").html("").addClass("hide"),t=$("#countryCode").val(),!t)return $("#tcError").html(window.resources.TextCountryRequired).removeClass("hide"),!1;if(i=$("#stateCode").val(),(t=="USA"||t=="CAN")&&!i)return $("#tcError").html(window.resources.TextStateRequired).removeClass("hide"),!1;var u=$("#city").val(),f=$("#tcId").val(),e=$("#hdnLookUpUrl").val();return $.get(e,{countryCode:t,stateCode:i,city:u,tcNumber:f},function(n){$("#tcNamesTableContainer").html(n);$("a[id^=lnkPick]").off("click");$("a[id^=lnkPick]").on("click",r.pickTC)}).error(function(n){$("#tcError").html(n).removeClass("hide")}),!1},pickTC:function(n){n.preventDefault();var t=$(n.target),i=t.data("tcid"),r=t.data("tcname"),u=t.data("tc-number");$("#chosenTCId").val(i);$("#tcIdNum").val(u);$("#chosenTCName, #hdnTCName").val(r);$("#assignModel").modal("hide")}}},AppEcardTransStatus=function(){$.ajaxSetup({async:!0,cache:!1});var t=!0,i=!1,n=new AppCommon,r=function(){$("#statusErr").html("");$("#statusErr").toggleClass("hide",!0);var t=[],f=$("#profileId option:selected").val(),e=$("#courseId option:selected").val(),o=$("#ddlSource option:selected").val(),i=$("input[name=transBy]:checked").val(),r=$("#eCardStatusForm").find('input[id="StartDate"]').val(),u=$("#eCardStatusForm").find('input[id="EndDate"]').val(),s=$("#ddlTC option:selected").val(),h=$("#ddlTS").val();return(!s||s<=0)&&(t[t.length]=window.resources.TextTrainingCenterRequired),r&&u||(t[t.length]=window.resources.TextTransactionsDatesRequired),(r||u)&&!n.isValidDate(r,u)&&(t[t.length]=n.getDateFormatError(window.resources.TransactionDate)),f!=RoleType.TSC.value&&f!=RoleType.TSAdmin.value||h||(t[t.length]=window.resources.TextSelectTrainingSite),(i==="fromTs"||i==="fromDist"||i==="fromIns")&&((!e||e.length<=0)&&(t[t.length]=window.resources.TextCourseRequired),(!o||o<=0)&&(i==="fromIns"&&(t[t.length]=window.resources.TextInstructorRequired),i==="fromTs"&&(t[t.length]=window.resources.TextTrainingSiteRequiredPleaseReview),i==="fromDist"&&(t[t.length]=window.resources.TextDistributorRequired))),n.showResponseError("statusErr","errlist",t)};return{init:function(){var n=this;$("#divOptions").toggleClass("hide",!0);$("#lnkAdvanced").toggleClass("hide",!0);$("input[type=radio][name=transBy]").on("change",function(t){n.toggleOptions(t)});$("input[type=radio][name=instType]").on("change",function(t){n.toggleInstrStatus(t)});$("#lnkAdvanced").on("click",n.showHideOptions);$("#profileId").on("change",function(){var t=JSON.parse($("#algnTCWithRole").val()),i=$("#profileId option:selected").val(),n=[];n.push($("<option/>",{value:"",text:window.resources.SelectTrainingCenter}));$.each(t,function(t,r){r.RoleId==i&&n.push($("<option/>",{value:r.EntityId,text:r.EntityName,"data-isprintonly":r.IsPrintOnly}))});$("#ddlTC").empty().append(n).val("");$("#collapseSearch").toggleClass("hide",!0);$("#collapseExample").toggleClass("hide",!0);$("#divResults").toggleClass("hide",!0);$("#divSite").toggleClass("hide",!0)});$("#ddlTC").on("change",function(){var u=$("#ddlTC").data("url"),r={},i=$("#ddlTC option:selected").val(),t=$("#profileId option:selected").val();if(t!=""&&i!=""){if($("#spanTsAstrkRequire").toggleClass("hide",!0),t==RoleType.TSC.value||t==RoleType.TSAdmin.value){if($("#spanTsAstrkRequire").toggleClass("hide",!1),i>0){var r={tcId:i,roleId:t},u=$("#ddlTC").data("tsurl"),f=window.resources.TextSelectTrainingSite;n.renderSource(u,r,"#ddlTS",f,n);$("#divSite").toggleClass("hide",!1)}return}$("#divSite").toggleClass("hide",!0);t==RoleType.Instructor.value&&i>0&&(n.renderSource($("#ddlTC").data("tsurl"),{tcId:i,roleId:t},"#ddlTS",window.resources.TextSelectTrainingSite,n),$("#divSite").toggleClass("hide",!1));$("#radPrintDiv").toggleClass("hide",!$("#ddlTC").find(":selected").data("isprintonly"));$("#radeCard").prop("checked",!0);$("#collapseSearch").toggleClass("hide",!1);$("#collapseExample").toggleClass("hide",!1);r={orgId:i,orgType:"tc",roleId:t};$("#courseId").empty().val("");n.renderSource(u,r,"#courseId",window.resources.SelectCourse,n);$("#divChildCourse").toggleClass("hide",!0);$("#divOptions").toggleClass("hide",!0);$("#divResults").toggleClass("hide",!0);$("#lnkAdvanced").toggleClass("hide",!0)}});$("#ddlTS").on("change",function(){var u=$("#ddlTS").data("url"),t={},i=$("#ddlTS option:selected").val(),r=$("#profileId option:selected").val();r!=""&&i!=""&&($("#collapseSearch").toggleClass("hide",!1),$("#collapseExample").toggleClass("hide",!1),t={orgId:i,orgType:"ts",roleId:r},$("#courseId").empty().val(""),n.renderSource(u,t,"#courseId","Select Course",n),$("#ddlTC").find(":selected").data("isprintonly")?$("#radPrintDiv").toggleClass("hide",!1):$("#radPrintDiv").toggleClass("hide",!0),$("#divChildCourse").toggleClass("hide",!0),$("#divOptions").toggleClass("hide",!0),$("#divResults").toggleClass("hide",!0),$("#divSource, #divTransactionType").toggleClass("hide",!1),$("#lnkAdvanced").toggleClass("hide",!0),$("input:radio").attr("checked",!1),$("#radeCard").prop("checked",!0))});$("#radioSite, #radioDist","#radioSite").toggleClass("hide",!0);$("#courseId").on("change",$.proxy(n.changeCourse,n));$(".datepicker").on("change",function(){i=!0});$(document).ready(function(){setTimeout(function(){$("#profileId").trigger("change")},500)});n.initMultiSelect()},initMultiSelect:function(){$("#courseId").multiselect({buttonWidth:"100%",disableIfEmpty:!1,includeSelectAllOption:!0,selectAllText:window.resources.TextSelectAll,allSelectedText:window.resources.TextAllSelected,nonSelectedText:window.resources.SelectCourses,nSelectedText:" "+window.resources.TextSelectedCourses});$("#ddlChildCourse").multiselect({buttonWidth:"100%",disableIfEmpty:!1,includeSelectAllOption:!0,selectAllText:window.resources.TextSelectAll,allSelectedText:window.resources.TextAllSelected,nonSelectedText:window.resources.SelectCourses,nSelectedText:" "+window.resources.TextSelectedCourses})},toggleInstrStatus:function(n){var t=this,u=$(n.target);t.clearErrorMsg();var f=u.val(),e=$("#courseId").find(":selected").map(function(n,t){return t.value}).get().join(","),i=window.resources.TextSelectInstructor,o=$("input[id=inst]:radio").data("url"),s={courseIds:e,isActive:f==="act"?!0:!1},r=[];r.push($("<option/>",{value:"",text:i}));$("#ddlSource").empty().append(r).val("");t.renderSource(o,s,"#ddlSource",i)},toggleOptions:function(t){var o=this,s,e,r,u,l;o.clearErrorMsg();var i=$(t.target),f=$("#courseId").find(":selected").map(function(n,t){return t.value}).get().join(","),v=$("#profileId option:selected").val();if(!f||f==="0")return i.prop("checked",!1),n.showResponseError("statusErr","errlist",window.resources.TextCourseRequired);s=i.data("url");$("#divInstType").toggleClass("hide",i.val()!=="fromIns");$("input[id=radActive]:radio").prop("checked",i.val()==="fromIns");var h=$("#ddlTC option:selected").val(),a=$("#ddlTS option:selected").val(),c=$("#profileId option:selected").val();i.val()==="fromTs"?(r=window.resources.TextTrainingSite,e={tcId:h,roleId:c},u=window.resources.TextSelectTrainingSite):i.val()==="fromDist"?(r=window.resources.TextDistributor,u=window.resources.TextSelectDistributor):i.val()==="fromIns"&&(r=window.resources.TextInstructor,u=window.resources.TextSelectInstructor,l=$("input[name=instType]:checked").val(),e={courseIds:f,isActive:l==="act"?!0:!1,tcId:h,tsId:a,roleId:c});$("#lblSource").text(r).append("<span class='required'> * <\/span>");$("#divSource, #divTransactionType").toggleClass("hide",!1);$("#ddlTransType").val("");$("#ddlSource").empty().val("");o.renderSource(s,e,"#ddlSource",u)},renderSource:function(t,i,r,u){var f=[];r!="#courseId"&&f.push($("<option/>",{value:"",text:u}));jQuery.get(t,i?i:null,function(n){n&&n.length>0&&$.each(n,function(n,t){f.push($("<option/>",{value:t.Id,"data-isparent":t.HasChild,text:t.Name}))});r=="#courseId"?$("#courseId").empty().append(f).multiselect("rebuild").val(""):$(r).empty().append(f).val("")}).error(function(t){$(r).empty().append(f).val("");n.showResponseError("statusErr","errlist",t)})},showHideOptions:function(n){t=!t;var i=$(n.target).find("span.caret");return setTimeout(function(){$("#divOptions").toggleClass("hide",t);var i=$("#hdnIsUserIntlAlgn").val(),n=$("#profileId option:selected").val();(n==RoleType.TSC.value||n==RoleType.TSAdmin.value)&&i==1&&($("#radSource").hide(),$("#divTransactionType").toggleClass("hide",!1),$("#divSource").toggleClass("hide",!0));n==RoleType.TSC.value||n==RoleType.TSAdmin.value?($("#radSource").toggleClass("hide",!1),$("#radioInst").show(),$("#radioSite").hide(),$("#radioDist").hide(),$("#divTransactionType").toggleClass("hide",!1),$("#divSource").toggleClass("hide",!0)):n==RoleType.Instructor.value?($("#radSource").toggleClass("hide",!0),$("#divTransactionType").toggleClass("hide",!1)):($("#radSource").toggleClass("hide",!1),$("#divTransactionType").toggleClass("hide",!1),$("#radioInst").show(),$("#radioSite").show(),$("#radioDist").show())},100),i.toggleClass("rotate",!t),!1},changeCourse:function(t){var u=this,e=$("#courseId").find(":selected").map(function(n,t){return t.value}).get().join(","),o=$(t.target).data("url"),s=$(t.target).data("vamurl"),h=$("#profileId option:selected").val()==window.RoleType.Instructor.value,c=$("#courseId").find(":selected").map(function(n,t){return $(t).data("isparent")}).get().join(","),f=$("#hdnIsUserIntlAlgn").val(),r;c=="true"?($("#divChildCourse").toggleClass("hide",!1),f==1?jQuery.get(o,{courseId:e},$.proxy(u.loadChildCourse,u)).error(function(t){n.showResponseError("statusErr","errlist",t)}):jQuery.get(s,{courseId:e,isInstructor:h},$.proxy(u.loadVAMCourse,u)).error(function(t){n.showResponseError("statusErr","errlist",t)})):$("#divChildCourse").toggleClass("hide",!0);i=!0;u.clearErrorMsg();u.clearSearchOptions(!0);e&&($("#lnkAdvanced").toggleClass("hide",!1),r=$("#profileId option:selected").val(),(r==RoleType.TCC.value||r==RoleType.TCAdmin.value)&&f==1&&$("#radioSite, #radioDist").toggleClass("hide",!1),(r==RoleType.TCC.value||r==RoleType.TCAdmin.value)&&f==0&&$("#radioInst,#radioSite, #radioDist").toggleClass("hide",!1),(r==RoleType.TSC.value||r==RoleType.TSAdmin.value)&&f==1&&$("#radioInst").toggleClass("hide",!0),(r==RoleType.TSC.value||r==RoleType.TSAdmin.value)&&f==0&&$("#radioInst").toggleClass("hide",!1))},clearErrorMsg:function(){$("#statusErr").html("");$("#statusErr").toggleClass("hide",!0)},clearSearchOptions:function(r){return this.clearErrorMsg(),$("#ddlSource").empty().val(""),t=!0,$("#lnkAdvanced").find("span.caret").toggleClass("rotate",!1),$("#lnkAdvanced").toggleClass("hide",!0),$("#ddlTransType").val(""),$("#divOptions").toggleClass("hide",!0),$("input[type=radio][name=transBy]").prop("checked",!1),$("input[type=radio][name=instType]").prop("checked",!1),$("#divTransactionType").toggleClass("hide",!0),$("#divSource").toggleClass("hide",!0),$("#divInstType").toggleClass("hide",!0),r||($("#courseId").multiselect("deselectAll",!1).multiselect("refresh"),$("#StartDate").datepicker("setDate",n.getMonthOldDate()),$("#EndDate").datepicker("setDate",n.getCurrentDate()),i=!1,this.searchTransactions(!0)),r||n.focusMessage(),!1},buildSearchRequest:function(){var f,i,r;window.eCardStatusViewModel={};window.eCardStatusViewModel.InstructorId=undefined;window.eCardStatusViewModel.TrainingSiteId=undefined;window.eCardStatusViewModel.DistributorId=undefined;window.eCardStatusViewModel.TrainingCenterId=undefined;window.eCardStatusViewModel.VAMCourseId=undefined;window.eCardStatusViewModel.TransactionType=undefined;window.eCardStatusViewModel.IsPrintOnly=!1;var e=$("#StartDate").val(),o=$("#EndDate").val(),s=$("input[name=printOnly]:checked").val();s=="fromPrintOnly"&&(window.eCardStatusViewModel.IsPrintOnly=!0);window.eCardStatusViewModel.CourseId=$("#courseId").find(":selected").map(function(n,t){return t.value}).get().join(",");window.eCardStatusViewModel.StartDate=e;window.eCardStatusViewModel.EndDate=o;var n=$("input[name=transBy]:checked").val(),u=$("#ddlSource option:selected").val(),t=$("#profileId option:selected").val();window.eCardStatusViewModel.ProfileId=t;window.eCardStatusViewModel.VAMCourseId=$("#ddlChildCourse").find(":selected").map(function(n,t){return t.value}).get().join(",");f=$("#ddlTC option:selected").val();f!=""&&(window.eCardStatusViewModel.TrainingCenterId=f);i=$("#ddlTransType option:selected").val();i!=""&&i!=undefined&&(window.eCardStatusViewModel.TransactionType=i);(t==RoleType.TSC.value||t==RoleType.TSAdmin.value||t==RoleType.Instructor.value)&&(r=$("#ddlTS option:selected").val(),r!=""&&r!=undefined&&(window.eCardStatusViewModel.TrainingSiteId=r));(n==="fromTs"||n==="fromDist"||n==="fromIns")&&(n==="fromIns"&&(window.eCardStatusViewModel.InstructorId=u),n==="fromTs"&&(window.eCardStatusViewModel.TrainingSiteId=u),n==="fromDist"&&(window.eCardStatusViewModel.DistributorId=u),window.eCardStatusViewModel.TransactionType=$("#ddlTransType option:selected").val())},searchTransactions:function(t){var u;if(!r())return!1;this.buildSearchRequest();u="Training Center eCard Status";window.eCardStatusViewModel.profileId==RoleType.TCAdmin.value&&(u="Training Site eCard Status");window.eCardStatusViewModel.profileId==RoleType.TCAdmin.value&&(u="Instructor eCard Status");var e=$("#btnSearch").data("url"),o=$("input[name=transBy]:checked").val(),f=this;return jQuery.post(e,window.eCardStatusViewModel,function(r){var e,s;if(r){$("#divResults").toggleClass("hide",!1);$("#divResults").html(r);e=$("#example").DataTable({columnDefs:[{targets:[7],visible:window.eCardStatusViewModel.CourseId.indexOf(",")<0&&!!window.eCardStatusViewModel.CourseId&&!o&&window.eCardStatusViewModel.VAMCourseId==0}]});e.context.length>0&&(s=new $.fn.dataTable.Buttons(e,{buttons:[{extend:"excelHtml5",title:n.getFileName(u),exportOptions:{columns:":visible"}}]}),$("#exportbutton").prepend(s.container()).find("a.dt-button").addClass("btn btn-primary").text(window.resources.TextDownload));$("#spdaysView").toggleClass("hide",i);$("#example").on("click",".lnkecard",$.proxy(f.loadECards,f));t||n.focusArea("#divResults")}$('[data-toggle="popover"]').popover()}).error(function(t){n.showResponseError("statusErr","errlist",t)}),!1},loadChildCourse:function(n){if(n&&n.length>0){var t=[];$.each(n,function(n,i){t.push($("<option/>",{value:i.CourseId,text:i.Name+" ("+i.Language+")"}))});$("#ddlChildCourse").empty().append(t);$("#ddlChildCourse").val("");$("#ddlChildCourse").empty().append(t).multiselect("rebuild")}},loadVAMCourse:function(n){if(n&&n.length>0){var t=[];$.each(n,function(n,i){t.push($("<option/>",{value:i.CourseId,text:i.Name}))});$("#ddlChildCourse").empty().append(t);$("#ddlChildCourse").val("");$("#ddlChildCourse").empty().append(t).multiselect("rebuild")}},loadECards:function(n){n.preventDefault();var t=this,i=$(n.target).data("transactionid");t.getECards(i)},getECards:function(t,i){var r=this,f=$("#profileId option:selected").val(),e=$("#hdnUrl").val(),u=!1,o=$("input[name=printOnly]:checked").val();o=="fromPrintOnly"&&(u=!0);r.isSuccess=!!i;jQuery.get(e,{transactionId:t,profileId:f,isRadioPrintBtnSelected:u},$.proxy(r.populateECards,r)).error(function(t){n.showResponseError("statusErr","errlist",t)})},populateECards:function(t){var u=this,i,r;t&&($("#divStudentECards").toggleClass("hide",!1),$("#divECardStatus").toggleClass("hide",!0),$("#divStudentECards").html(t),u.isSuccess&&$("#divAlert").toggleClass("hide",!1),i=$("#tblECards").DataTable(),i.context.length>0&&(r=new $.fn.dataTable.Buttons(i,{buttons:[{extend:"excelHtml5",title:n.getFileName("Student eCards")}]}),$("[data-blocked]").closest("tr").addClass("blockedInRed"),$("#exportECard").prepend(r.container()).find("a.dt-button").addClass("btn btn-primary").text(window.resources.TextDownload),r.container().css("display","inline-block"),$("#lnkGoResults").click(u.NavigateToResults),n.focusMessage()))},NavigateToResults:function(t){t.preventDefault();$("#divStudentECards, #divEditCard").html("");$("#divStudentECards, #divEditCard").toggleClass("hide",!0);$("#divECardStatus").toggleClass("hide",!1);$("#divResults").is(":visible")?n.focusArea("#divResults"):n.focusArea("#partial")}}},AppEcardUpload=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon,t=function(){var i,t,r;return($("#error").html(""),$("#error").addClass("hide"),i=$("#dataFile")[0].files,t=[],i.length==0&&(t[t.length]=window.resources.TextFileNameRequired),r=i[0].name.substr(i[0].name.lastIndexOf(".")+1).toLowerCase(),r!="xls"&&r!="xlsx"&&(t[t.length]=window.resources.TextFileShouldBeExcel),t.length>0)?n.showResponseError("error","errlist",t):!0};return{init:function(){},btnClick_upload_ecardupload:function(){var r,u,i,f;if(!t())return!1;for(r=new FormData,u=$("#dataFile")[0].files,i=0;i<u.length;i++)r.append("file",u[i]);return f=$("#upload").data("url"),jQuery.ajax({url:f,type:"POST",contentType:!1,processData:!1,data:r,dataType:"html",success:function(t){$("#partial").html(t);$("#error").addClass("hide");$("#success").addClass("hide");t==""?($("#error").html(""),$("#success").html(""),$("#success").append(window.resources.TextSuccessFileProcess),$("#dataFile").val(""),$("#success").removeClass("hide")):($("#success").html(""),n.showResponseError("error","errlist",window.resources.TextFailedFileProcess),$("#dataFile").val(""));n.focusMessage();$("#example").DataTable({pageLength:25,order:[[0,"asc"]],columnDefs:[{targets:[7],render:function(n){for(var i=n.split("|"),r="<span><ul>",t=0;t<i.length-1;t++)r+="<li style='margin-left: -1.5em'>"+i[t]+"<\/li>";return r+"<\/ul>"}}]})},error:function(t){$("#success").html("");n.showResponseError("error","errlist",t.responseJSON.errorMessage);$("#dataFile").val("");n.focusMessage()}}),!1}}},AppLocationEcardStatus=function(){$.ajaxSetup({async:!0,cache:!1});var i=!0,t="",r=!1,n=new AppCommon,u=function(i){$("#assignError").html("");$("#assignError").addClass("hide");var o=$("#eCardStatusForm").find('select[id="CourseId"]').val(),f=$("#eCardStatusForm").find('input[id="StartDate"]').val(),e=$("#eCardStatusForm").find('input[id="EndDate"]').val(),s=$("#eCardStatusForm").find('select[id="ddlTC"]').val(),h=$("#eCardStatusForm").find('select[id="ddlInstructor"]').val(),u=$("#eCardStatusForm").find('select[id="ddlLocation"]').val(),r=[];return(i&&((!o||o.length<=0)&&(r[r.length]=window.resources.TextCourseRequired),t!==""&&(""===s||s<=0?r[r.length]=window.resources.TextTrainingCenterRequired:t==="location"?(""===u||u<=0)&&(r[r.length]=window.resources.TextLocationRequired):t==="instructor"&&(""===u||u<=0?r[r.length]=window.resources.TextLocationRequired:(""===h||h<=0)&&(r[r.length]=window.resources.TextInstructorRequired)))),f&&e||(r[r.length]=window.resources.TextTransactionsDatesRequired),(f||e)&&!n.isValidDate(f,e)&&(r[r.length]=n.getDateFormatError(window.resources.TransactionDate)),r.length>0)?(n.showResponseError("assignError","errlist",r),!1):!0};return{init:function(){var i=this,r;$("#divOptions").toggleClass("hide",!0);$("#lnkAdvanced").on("click",i.showHideOptions);$("#lnkAdvanced").toggleClass("hide",!0);r=$("#profileId option:selected").val();r&&r==window.RoleType.Instructor.value&&$("#radioTc").toggleClass("hide",!1);i.initMultiSelect();$("#divECardStatus").on("change","#profileId",$.proxy(i.changeProfile,i));$("#VAMCourseId").on("change",$.proxy(i.changeVAMCourse,i));$("#CourseId").on("change",function(t){var f=$("#profileId option:selected").val()==window.RoleType.Instructor.value,r=$("#CourseId").find(":selected").map(function(n,t){return t.value}).get().join(","),e=$(t.target).data("url"),o=$("#CourseId").find(":selected").map(function(n,t){return $(t).data("isparent")}).get().join(","),u;o=="True"?($("#divVAMCourse").toggleClass("hide",!1),jQuery.get(e,{courseId:r,isInstructor:f},$.proxy(i.loadVAMCourse,i)).error(function(t){n.showResponseError("statusErr","errlist",t)})):($("#divVAMCourse").toggleClass("hide",!0),$("#VAMCourseId").multiselect("deselectAll",!1).multiselect("refresh"));i.btnClick_reset_ecardRequests(!0);u=$("#profileId option:selected").val();r?($("#lnkAdvanced").toggleClass("hide",!1),i.getTCList({courseIds:$("#CourseId").find(":selected").map(function(n,t){return t.value}).get().join(","),profileId:u})):$("#lnkAdvanced").toggleClass("hide",!0);$("#ddlLocation").val("");$("#ddlTC").val("")});$("#ddlTC").on("change",function(n){var r=$("#profileId option:selected").val(),u;if(r&&r==window.RoleType.Instructor.value&&t==="tc")return!1;u=$(n.target).val();$("#divInstructor").toggleClass("hide",!0);u?(i.getLocation({TcId:u,profileId:r}),$("#divLocation").toggleClass("hide",!1)):$("#divLocation").toggleClass("hide",!0);$("#ddlLocation").val("")});$("#ddlLocation").on("change",function(n){var u,r;t!=="location"&&(u=$(n.target).val(),u?($("input[id=radActive]:radio").prop("checked",!0),r=$("#VAMCourseId").find(":selected").map(function(n,t){return t.value}).get().join(","),r==""&&(r=$("#CourseId").find(":selected").map(function(n,t){return t.value}).get().join(",")),i.getInstructor({courseIds:r,tcId:$("#eCardStatusForm").find('select[id="ddlTC"]').val(),isActive:!0}),$("#divInstructor").toggleClass("hide",!1)):$("#divInstructor").toggleClass("hide",!0))});$("input[type=radio][name=fromType]").on("change",function(n){$("#assignError").html("").addClass("hide");var i=$(n.target);t=i.val();$("#ddlTC").val("");$("#ddlInstructor").val("");$("#ddlLocation").val("");$("#divTC").toggleClass("hide",!1);$("#divType").toggleClass("hide",!1);$("#divInstructor").toggleClass("hide",!0);$("#divLocation").toggleClass("hide",!0)});$("input[type=radio][name=instType]").on("change",function(n){i.toggleInstrStatus(n)})},initMultiSelect:function(){$("#CourseId").multiselect({buttonWidth:"100%",disableIfEmpty:!1,includeSelectAllOption:!0,selectAllText:window.resources.TextSelectAll,allSelectedText:window.resources.TextAllSelected,nonSelectedText:window.resources.SelectCourses,nSelectedText:" "+window.resources.TextSelectedCourses});$(".multiselect-bin").find("button").attr("aria-required","true").attr("id","multiCourse");$("#VAMCourseId").multiselect({buttonWidth:"100%",disableIfEmpty:!1,includeSelectAllOption:!0,selectAllText:window.resources.TextSelectAll,allSelectedText:window.resources.TextAllSelected,nonSelectedText:window.resources.SelectCourses,nSelectedText:" "+window.resources.TextSelectedCourses})},toggleInstrStatus:function(n){var r=this,u=$(n.target),i,t;$("#assignError").html("").addClass("hide");i=u.val();t=$("#VAMCourseId").find(":selected").map(function(n,t){return t.value}).get().join(",");t==""&&(t=$("#CourseId").find(":selected").map(function(n,t){return t.value}).get().join(","));r.getInstructor({courseIds:t,tcId:$("#eCardStatusForm").find('select[id="ddlTC"]').val(),isActive:i==="act"?!0:!1})},changeProfile:function(n){var t=$(n.target).val();window.location.href=$("#hdnProfileUrl").val()+"?profileId="+t},getTCList:function(t){var i=$("#eLoc").data("url");jQuery.get(i,t,function(n){var t=[];t.push($("<option/>",{value:"",text:window.resources.SelectTrainingCenter}));n&&n.length>0&&$.each(n,function(n,i){t.push($("<option/>",{value:i.TrainingCenterId,text:i.Name}))});$("#ddlTC").empty().append(t);$("#ddlTC").val("")}).error(function(t){$("#ddlTC").empty();n.showResponseError("assignError","errlist",t)})},getInstructor:function(t){var r=$("#inst").data("url"),i=[];i.push($("<option/>",{value:"",text:window.resources.SelectInstructors}));jQuery.get(r,t,function(n){n&&n.length>0&&$.each(n,function(n,t){i.push($("<option/>",{value:t.Id,text:t.Name}))});$("#ddlInstructor").empty().append(i).val("")}).error(function(t){$("#ddlInstructor").empty().append(i).val("");n.showResponseError("assignError","errlist",t)})},getLocation:function(t){var i=$("#ddlLocation").data("url");jQuery.get(i,t,function(n){var t=[];t.push($("<option/>",{value:"",text:window.resources.TextSelecteCardLocation}));n&&n.length>0&&$.each(n,function(n,i){t.push($("<option/>",{value:i.Id,text:i.Name}))});$("#ddlLocation").empty().append(t);$("#ddlLocation").val("")}).error(function(t){$("#ddlLocation").empty();n.showResponseError("assignError","errlist",t)})},showHideOptions:function(n){i=!i;var t=$(n.target).find("span.caret");return setTimeout(function(){var n=$("#profileId option:selected").val();n&&n==window.RoleType.Instructor.value&&!i&&($("#radioTc").toggleClass("hide",!1),$("#radioInst").toggleClass("hide",!0));$("#divOptions").toggleClass("hide",i)},100),t.toggleClass("rotate",!i),!1},loadVAMCourse:function(n){if(n&&n.length>0){var t=[];$.each(n,function(n,i){t.push($("<option/>",{value:i.CourseId,text:i.Name}))});$("#VAMCourseId").empty().append(t);$("#VAMCourseId").val("");$("#VAMCourseId").empty().append(t).multiselect("rebuild")}},changeVAMCourse:function(){var i=this,t=$("#eCardStatusForm").find('select[id="ddlTC"]').val(),n=$("#VAMCourseId").find(":selected").map(function(n,t){return t.value}).get().join(",");n==""&&(n=$("#CourseId").find(":selected").map(function(n,t){return t.value}).get().join(","));t!=""&&i.getInstructor({courseIds:n,tcId:t,isActive:!0})},btnClick_search_ecardRequests:function(t){var i=this,r,f;return u(t)?(r=$("#profileId option:selected").val()!=window.RoleType.Instructor.value,f=$("#fetchReq").data("url"),jQuery.ajax({url:f,type:"POST",dataType:"html",data:$("#eCardStatusForm").serialize(),success:function(u){var f,e;$("#partial").html(u);f=$("#example").DataTable({pageLength:25,order:window.area.toLowerCase()==="distributor"?[[6,"desc"]]:[[6,"desc"]],columnDefs:[{targets:[0],visible:!1}]});t?$("#spdaysView").toggleClass("hide",!0):$("#spdaysView").toggleClass("hide",!1);f.context.length>0&&(e=new $.fn.dataTable.Buttons(f,{buttons:[{extend:"excelHtml5",title:n.getFileName(r?"eCard Location eCard Status":"Instructor eCard Status"),exportOptions:{columns:":visible"}}]}),$("#expotbutton").prepend(e.container()).find("a.dt-button").addClass("btn btn-primary").text(window.resources.TextDownload),$(".lnkecard").click($.proxy(i.loadECards,i)),t&&n.focusArea("#partial"));$('[data-toggle="popover"]').popover()},error:function(t){n.showResponseError("assignError","errlst",t)}}),!1):!1},btnClick_reset_ecardRequests:function(u){var f=this;$("#assignError").html("").addClass("hide");i=!0;$("#lnkAdvanced").find("span.caret").toggleClass("rotate",!1);$("#lnkAdvanced").toggleClass("hide",!0);$("#ddlTC").empty().val("");$("#ddlInstructor").empty().val("");$("#ddlLocation").empty().val("");$("#ddlType").val("");$("input[type=radio][name=fromType]").prop("checked",!1);t="";$("#divOptions").toggleClass("hide",!0);$("#divTC").toggleClass("hide",!0);$("#divType").toggleClass("hide",!0);$("#divLocation").toggleClass("hide",!0);$("#divInstructor").toggleClass("hide",!0);u||($("#CourseId").multiselect("deselectAll",!1).multiselect("refresh"),$("#StartDate").datepicker("setDate",n.getMonthOldDate()),$("#EndDate").datepicker("setDate",n.getCurrentDate()),r=!1,f.btnClick_search_ecardRequests(!1));u||n.focusMessage()},loadECards:function(n){n.preventDefault();var t=this,i=$(n.target).data("transactionid");t.getECards(i)},getECards:function(t,i){var r=this,u=$("#profileId option:selected").val(),f=$("#hdnUrl").val();r.isSuccess=!!i;jQuery.get(f,{transactionId:t,profileId:u},$.proxy(r.populateECards,r)).error(function(t){n.showResponseError("statusErr","errlist",t)})},populateECards:function(t){var u=this,i,r;t&&($("#divStudentECards").toggleClass("hide",!1),$("#divECardStatus").toggleClass("hide",!0),$("#divStudentECards").html(t),u.isSuccess&&$("#divAlert").toggleClass("hide",!1),i=$("#tblECards").DataTable(),i.context.length>0&&(r=new $.fn.dataTable.Buttons(i,{buttons:[{extend:"excelHtml5",title:n.getFileName("Student eCards")}]}),$("[data-blocked]").closest("tr").addClass("blockedInRed"),$("#exportECard").prepend(r.container()).find("a.dt-button").addClass("btn btn-primary").text(window.resources.TextDownload),r.container().css("display","inline-block"),$("#lnkGoResults").click(u.NavigateToResults),n.focusMessage()))},NavigateToResults:function(t){t.preventDefault();$("#divStudentECards, #divEditCard").html("");$("#divStudentECards, #divEditCard").toggleClass("hide",!0);$("#divECardStatus").toggleClass("hide",!1);$("#divResults").is(":visible")?n.focusArea("#divResults"):n.focusArea("#partial")}}},AppEmailedEcards=function(){$.ajaxSetup({async:!0,cache:!1});var i=!0,u=!1,f=null,t=new AppCommon,r,n,e=function(){$("#statusErr").html("");$("#statusErr").toggleClass("hide",!0);var n=[],e=$("#ddlInventoryPool option:selected").val(),o=$("#courseId option:selected").val(),i=$("#ddlTC option:selected").val(),s=$("#ddlTS option:selected").val(),h=$("#ddlInstructor option:selected").val(),r=$("#emailEcardsForm").find('input[id="StartDate"]').val(),u=$("#emailEcardsForm").find('input[id="EndDate"]').val();return(!o||o.length<=0)&&(n[n.length]=window.resources.TextCourseRequired),r&&u||(n[n.length]=window.resources.TextAssignmentDateRequired),(r||u)&&!t.isValidDate(r,u)&&(n[n.length]=t.getDateFormatError(window.resources.DateOfAssignment)),(!i||i<=0)&&(n[n.length]=window.resources.TextTrainingCenterRequired),(e==RoleType.TSC.value||e==RoleType.TSAdmin.value)&&(!s||s<=0)&&(n[n.length]=window.resources.TextTrainingSiteRequired),f=="fromIns"&&(i&&!h||h<=0)&&(n[n.length]=window.resources.TextInstructorRequired),t.showResponseError("statusErr","errlist",n)};return{init:function(){var t=this;$("#divOptions").toggleClass("hide",!0);$("input[type=radio][name=transBy]").on("change",function(){var f,i;$("#divInstType").toggleClass("hide",n==window.RoleType.Instructor.value);$("input[id=radActive]:radio").prop("checked",n!=window.RoleType.Instructor.value);instrType=$("input[name=instType]:checked").val();var u=$("#ddlTC option:selected").val(),e=$("#ddlTS option:selected").val(),n=$("#ddlInventoryPool option:selected").val();$("input[name=transBy]:checked").val()=="fromTs"?(f={tcId:u,roleId:n},i=$("#ddlTC").data("tsurl"),t.getData(i,f,"#ddlAsoTS",window.resources.TextSelectTrainingSite),$("#divAsoTS").toggleClass("hide",!1),$("#divInstructor").toggleClass("hide",!0)):($("#divAsoTS").toggleClass("hide",!0),i=$("#divUrl").data("instructorurl"),$("#divInstructor").toggleClass("hide",!1),t.getData(i,{courseIds:r,tcId:u,tsId:e,roleId:n,isActive:n==window.RoleType.Instructor.value?!0:instrType==="act"?!0:!1},"#ddlInstructor",window.resources.TextSelectInstructor))});$("#lnkAdvanced").on("click",t.showHideOptions);$("#lnkAdvanced").toggleClass("hide",!0);$(".datepicker").on("change",function(){u=!0});$("#courseId").on("change",function(){r=$("#courseId").find(":selected").map(function(n,t){return t.value}).get().join(",");t.resetAll();t.showOptions();i=u=!0;$("#lnkAdvanced").find("span.caret").toggleClass("rotate",!1);$("#lnkAdvanced, #divOptions").toggleClass("hide",!0);r&&(t.clearErrorMsg(),$("#lnkAdvanced").toggleClass("hide",n==RoleType.Instructor.value))});$("#ddlInventoryPool").on("change",function(){var i=JSON.parse($("#algnTCWithRole").val()),t;n=$("#ddlInventoryPool option:selected").val();t=[];t.push($("<option/>",{value:"",text:window.resources.SelectTrainingCenter}));$.each(i,function(i,r){r.RoleId==n&&t.push($("<option/>",{value:r.EntityId,text:r.EntityName,"data-isprintonly":r.IsPrintOnly}))});$("#ddlTC").empty().append(t).val("");$("#divResults").toggleClass("hide",!0);$("#divSite").toggleClass("hide",!0);$("#divSearchBox").toggleClass("hide",!0)});$("#ddlTC").on("change",function(){var u,r;t.resetSearchBox();var r=$("#ddlTC").data("url"),f=$("#ddlTC").data("instrurl"),u={},i=$("#ddlTC option:selected").val();if(n=$("#ddlInventoryPool option:selected").val(),n==""||i==""){$("#divSearchBox").toggleClass("hide",!0);$("#divSite").toggleClass("hide",!0);return}if(n==RoleType.Instructor.value?$("#divInst").addClass("hide"):$("#divInst").removeClass("hide"),$("#statusErr").toggleClass("hide",!0),$("#divSearchResult").toggleClass("hide",!0),$("#ddlTS").val(""),n==RoleType.TSC.value||n==RoleType.TSAdmin.value||n==RoleType.Instructor.value){i>0&&(u={tcId:i,roleId:n},r=$("#ddlTC").data("tsurl"),$("#divSite").toggleClass("hide",!1),t.getData(r,u,"#ddlTS",window.resources.TextSelectTrainingSite),$("#divSite").toggleClass("hide",!1),$("#spanTsAstrkRequire").toggleClass("hide",n==RoleType.Instructor.value),n==RoleType.Instructor.value?$("#divSearchBox").toggleClass("hide",!1):$("#divSearchBox").toggleClass("hide",!0));return}$("#divSite").toggleClass("hide",!0);$("#divSearchBox").toggleClass("hide",!1)});$("#ddlTS").on("change",function(i){t.resetSearchBox();var u=$(i.target),r=u.val();(r==""||r.length<0)&&(n==RoleType.TSC.value||n==RoleType.TSAdmin.value)?$("#divSearchBox").toggleClass("hide",!0):$("#divSearchBox").toggleClass("hide",!1)});$("input[type=radio][name=instType]").on("change",function(n){t.clearErrorMsg();var r=$(n.target),u=r.val(),f=$("#ddlTC option:selected").val(),e=$("#ddlTS option:selected").val(),o=$("#ddlInventoryPool option:selected").val(),s=$("#courseId").find(":selected").map(function(n,t){return t.value}).get().join(","),i=[];i.push($("<option/>",{value:"",text:window.resources.TextSelectInstructor}));$("#ddlInstructor").empty().append(i).val("");$("#divInstructor").toggleClass("hide",!1);t.getData($("#divUrl").data("instructorurl"),{courseIds:s,tcId:f,tsId:e,roleId:o,isActive:u==="act"},"#ddlInstructor",window.resources.TextSelectInstructor)});$(document).ready(function(){setTimeout(function(){$("#ddlInventoryPool").trigger("change")},500)});t.initMultiSelect()},initMultiSelect:function(){$("#courseId").multiselect({buttonWidth:"100%",disableIfEmpty:!1,includeSelectAllOption:!0,selectAllText:window.resources.TextSelectAll,allSelectedText:window.resources.TextAllSelected,nonSelectedText:window.resources.SelectCourses,nSelectedText:" "+window.resources.TextSelectedCourses});$(".multiselect-bin").find("button").attr("aria-required","true").attr("id","multiCourse")},toggleOptions:function(i){var e=this,u,o;if(e.clearErrorMsg(),u=$(i.target),f=u.val(),!r)return u.closest(".checked").removeClass("checked"),u.removeAttr("checked"),t.showResponseError("statusErr","errlist",window.resources.TextCourseRequired);$("#divTC").toggleClass("hide",!1);$("#divInstructor, #divLocation").toggleClass("hide",!0);$("#ddlTC, #ddlLocation, #ddlInstructor").val("");n=$("#ddlInventoryPool option:selected").val();o=$("#divUrl").data("tcurl");e.getData(o,{courseIds:r,roleId:n},"#ddlTC",window.resources.SelectTrainingCenter);$("#divTC").toggleClass("hide",!1);$("#ddlTC").val("")},resetSearchBox:function(){var n=this;$("#courseId").multiselect("deselectAll",!1).multiselect("refresh");$("#divResults").html("");$("#lnkAdvanced, #divOptions").toggleClass("hide",!0)},resetAll:function(){$("input[type=radio][name=transBy]").prop("checked",!1);$("input[type=radio][name=instType]").prop("checked",!1);f="";$("#divAsoTS").toggleClass("hide",!0);$("#ddlAsoTS").val("");$("#divInstructor").toggleClass("hide",!0);$("#ddlInstructor").val("")},getData:function(n,i,r,u){var f=[];f.push($("<option/>",{value:"",text:u}));jQuery.get(n,i,function(n){n&&n.length>0&&$.each(n,function(n,t){f.push($("<option/>",{value:t.Id,text:t.Name}))});$(r).empty().append(f).val("")}).error(function(n){$(r).empty().append(f).val("");t.showResponseError("statusErr","errlist",n)})},showOptions:function(){n=$("#ddlInventoryPool option:selected").val();$("#rdoTc").toggleClass("hide",!0);$("#rdoLocation").toggleClass("hide",!0);$("#rdoInstructor").toggleClass("hide",!0);(n==RoleType.TCC.value||n==RoleType.TCAdmin.value)&&($("#rdoTs").toggleClass("hide",!1),$("#rdoInstructor").toggleClass("hide",!1));(n==RoleType.TSC.value||n==RoleType.TSAdmin.value)&&$("#rdoInstructor").toggleClass("hide",!1);n==RoleType.Instructor.value&&$("#divOptions").toggleClass("hide",!0)},showHideOptions:function(n){if(!r)return t.showResponseError("statusErr","errlist",window.resources.TextCourseRequired);i=!i;var u=$(n.target).find("span.caret");return setTimeout(function(){$("#divOptions").toggleClass("hide",i)},100),u.toggleClass("rotate",!i),!1},clearErrorMsg:function(){$("#statusErr").html("");$("#statusErr").toggleClass("hide",!0)},clearSearchOptions:function(n){return this.clearErrorMsg(),f=null,$("#ddlTC,#ddlTS, #ddlAsoTS, #ddlInstructor").val(""),$("#divOptions, #divAsoTS, #divInstructor, #lnkAdvanced").toggleClass("hide",!0),$("input[type=radio][name=transBy]").prop("checked",!1),$("input[type=radio][name=instType]").prop("checked",!1),i=!0,$("#lnkAdvanced").find("span.caret").toggleClass("rotate",!1),n||($("#courseId").multiselect("deselectAll",!1).multiselect("refresh"),$("#StartDate").datepicker("setDate",t.getFiveDaysOldDate()),$("#EndDate").datepicker("setDate",t.getCurrentDate()),u=!1,this.searchTransactions(!1)),t.focusMessage(),!1},buildSearchRequest:function(){window.emailedEcards.LocationId=window.emailedEcards.InstructorId=window.emailedEcards.TrainingCenterId=null;window.emailedEcards.CourseId=$("#courseId").find(":selected").map(function(n,t){return t.value}).get().join(",");window.emailedEcards.StartDate=$("#emailEcardsForm").find('input[id="StartDate"]').val();window.emailedEcards.EndDate=$("#emailEcardsForm").find('input[id="EndDate"]').val();window.emailedEcards.TrainingCenterId=$("#ddlTC option:selected").val();window.emailedEcards.TSId=n==RoleType.TCC.value||n==RoleType.TCAdmin.value?$("#ddlAsoTS option:selected").val():$("#ddlTS option:selected").val();window.emailedEcards.SelectedInventoryPool=$("#ddlInventoryPool option:selected").val();window.emailedEcards.InstructorId=$("#ddlInstructor option:selected").val()},searchTransactions:function(i){if(i&&!e())return!1;this.buildSearchRequest();var f=$("#btnSearch").data("url"),r=this;return jQuery.post(f,window.emailedEcards,function(f){var e,o;if(f){$("#divResults").toggleClass("hide",!1);$("#divResults").html(f);e=$("#example").DataTable({columnDefs:n==window.RoleType.Instructor.value?[{targets:[3],visible:!1}]:[]});e.context.length>0&&(o=new $.fn.dataTable.Buttons(e,{buttons:[{extend:"excelHtml5",title:t.getFileName("Issued eCards"),exportOptions:{columns:n==window.RoleType.Instructor.value?[0,1,2,4,5]:[0,1,2,3,4,5]}}]}),$("#exportbutton").prepend(o.container()).find("a.dt-button").addClass("btn btn-primary").text(window.resources.TextDownload));$("#spdaysView").toggleClass("hide",u);$("#example").on("click",".lnkecard",$.proxy(r.loadECards,r));$('[data-toggle="popover"]').popover();i&&t.focusArea("#divResults")}}).error(function(n){t.showResponseError("statusErr","errlist",n)}),!1},loadECards:function(n){n.preventDefault();var i=this,r=$(n.target).data("transactionid"),u=$("#divUrl").data("studentlist");jQuery.get(u,{transactionId:r},$.proxy(i.populateECards,i)).error(function(n){t.showResponseError("statusErr","errlist",n)})},populateECards:function(n){var u=this,i,r;n&&($("#divStudentECards").toggleClass("hide",!1),$("#divECardStatus").toggleClass("hide",!0),$("#divStudentECards").html(n),i=$("#tblECards").DataTable(),i.context.length>0&&(r=new $.fn.dataTable.Buttons(i,{buttons:[{extend:"excelHtml5",title:t.getFileName("Student eCards")}]}),$("#exportECard").prepend(r.container()).find("a.dt-button").addClass("btn btn-primary").text(window.resources.TextDownload),r.container().css("display","inline-block"),$("#lnkGoResults").click(u.NavigateToResults),t.focusArea("#divStudentECards")))},NavigateToResults:function(n){n.preventDefault();$("#divStudentECards").html("");$("#divStudentECards").toggleClass("hide",!0);$("#divECardStatus").toggleClass("hide",!1);t.focusArea("#divResults")}}},AppExpiringEcards=function(){$.ajaxSetup({async:!0,cache:!1});var i=new AppCommon,t,n,r=function(){$("#reportError").html("");$("#reportError").addClass("hide");var r=$("#ddlTC option:selected").val(),f=$("#ddlLocation option:selected").val(),u=$("#ddlTS option:selected").val(),t=[];return(r===""&&(t[t.length]=window.resources.TextTrainingCenterRequired),(n==RoleType.TSC.value||n==RoleType.TSAdmin.value)&&u===""&&(t[t.length]=window.resources.TextTrainingSiteRequired),t.length>0)?(i.showResponseError("reportError","errlist",t),!1):!0};return{init:function(){var i=this;$("#divReport input[name=reportType]:radio").on("change",function(r){var u=$(r.target),f=u.data("url");t=u.val();n=$("#hdnUserRole").val();i.hideAll();t=="summary"&&(n==RoleType.TCC.value||n==RoleType.TCAdmin.value||n==RoleType.TSC.value||n==RoleType.TSAdmin.value?($("#divTrainingCenter").toggleClass("hide",!1),$("#divSubmit").toggleClass("hide",!1)):($("#partial").toggleClass("hide",!1),i.getReport(f,t)));t=="detail"&&((n==RoleType.TCC.value||n==RoleType.TCAdmin.value||n==RoleType.TSC.value||n==RoleType.TSAdmin.value)&&($("#divTrainingCenter").toggleClass("hide",!1),$("#divSubmit").toggleClass("hide",!1)),(n==RoleType.SuperUser.value||n==RoleType.ECCAdmin.value||n==RoleType.CSR.value)&&($("#divTrainingCenter").toggleClass("hide",!1),$("#divSubmit").toggleClass("hide",!1)));$("#ddlTC").val("");$("#ddlTS").val("")});$("input[id=summary]:radio").prop("checked",!0);$("#ddlTC").on("change",function(t){var f=$(t.target),r=f.val(),u;r>0&&(n==RoleType.TSC.value||n==RoleType.TSAdmin.value?(u=$("#hdnUserRole").val(),i.getSites({TcId:r,roleId:u}),$("#divTrainingSite").toggleClass("hide",!1)):$("#divTrainingSite").toggleClass("hide",!0))});$(document).ready(function(){var n=$("#divUrl").data("summary");$("input[id=summary]:radio").trigger("change");$("#ddlReports option:contains(Students with Expiring eCards)").attr("selected",!0)})},hideAll:function(){$("#divTrainingCenter").toggleClass("hide",!0);$("#divLocation").toggleClass("hide",!0);$("#divTrainingSite").toggleClass("hide",!0);$("#partial").toggleClass("hide",!0);$("#divSubmit").toggleClass("hide",!0)},getReport:function(n,t,r){var u=this;return jQuery.ajax({url:n,type:"GET",data:r,dataType:"html",success:function(n){var r,u;$("#partial").html(n);$("#partial").toggleClass("hide",!1);r=$("#example").DataTable({pageLength:25,order:t=="summary"?[[0,"desc"]]:[[5,"desc"]]});r.context.length>0&&(u=new $.fn.dataTable.Buttons(r,{buttons:[{extend:"excelHtml5",title:i.getFileName("Expiring eCards")}]}),t=="detail"&&$("#expotbutton").prepend(u.container()).find("a.dt-button").addClass("btn btn-primary").text(window.resources.TextDownload))},error:function(n){i.showResponseError("search_error","errlst",n)}}),!1},getSites:function(n){var t=$("#ddlTC").data("tsurl");jQuery.get(t,n,function(n){if(n&&n.length>0){var t=[];t.push($("<option/>",{value:"",text:window.resources.TextSelectTrainingSite}));$.each(n,function(n,i){t.push($("<option/>",{value:i.Id,text:i.Name}))});$("#ddlTS").empty().append(t);$("#ddlTS").val("")}}).error(function(n){$("#ddlTS").empty();i.showResponseError("assignError","errlist",n)})},getLocation:function(n){var t=$("#ddlTC").data("url");jQuery.get(t,n,function(n){if(n&&n.length>0){var t=[];t.push($("<option/>",{value:"",text:window.resources.TextSelecteCardLocation}));$.each(n,function(n,i){t.push($("<option/>",{value:i.Id,text:i.Name}))});$("#ddlLocation").empty().append(t);$("#ddlLocation").val("")}}).error(function(n){$("#ddlLocation").empty();i.showResponseError("assignError","errlist",n)})},btnSubmit_Click:function(){var i=this,n,u=$("#ddlTC option:selected").val(),f=$("#ddlLocation option:selected").val(),e=$("#ddlTS option:selected").val(),o={TcId:u,LocationId:f,TsId:e};t=="summary"&&(n=$("#divUrl").data("summary"));t=="detail"&&(n=$("#divUrl").data("detail"));r()&&i.getReport(n,t,o)}}},AppInstrCandidateAssignment=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon,r={init:function(){var n=$('a[data-toggle="collapse"]');n.on("click",function(){n.delay(1e3).hasClass("collapsed")?r.hide(n):r.show(n)})},hide:function(n){n.children(".text").text("Hide Info");n.children(".fa").hasClass("fa-caret-up")?n.children(".fa").removeClass("fa-caret-up").addClass("fa-caret-down"):""},show:function(n){n.children(".text").text("Show Info");n.children(".fa").hasClass("fa-caret-down")?n.children(".fa").removeClass("fa-caret-down").addClass("fa-caret-up"):""}},t=$("#hdnAslsInstrIntlProdNum").val(),i=$("#hdnAslsInstrDomsticProdNum").val(),l=$("#divServiceUrl").data("tc_url"),s=$("#divServiceUrl").data("ts_url"),u=$("#divServiceUrl").data("course_url"),f=$("#divServiceUrl").data("instructor_url"),h=$("#divServiceUrl").data("quantity_url"),e=$("#CourseId option:selected").val(),o,c=function(){var c,i;$("#assignError").html("");$("#assignError").addClass("hide");var t=[],r=$("#CourseId option:selected").val(),u=$("#RoleId option:selected").val(),f=$("#ddlTC option:selected").val(),e=$("#ddlTS option:selected").val(),s=$("#ddlInstructor option:selected").val(),h=parseInt($("#availQty").text());return o=$("#radBulkUpload").is(":checked"),c=$("#dataFile")[0].files,i=$("#RoleId option:selected").val(),(!r||r<=0)&&(t[t.length]=window.resources.TextCourseRequired),(!u||u<=0)&&(t[t.length]=window.resources.TextInventoryPoolRequired),(!f||f<=0)&&(t[t.length]=window.resources.TextTrainingCenterRequired),(i==RoleType.TSC.value||i==RoleType.TSAdmin.value)&&(!e||e<=0)&&(t[t.length]=window.resources.TextTrainingSiteRequired),(!s||s<=0)&&(o||(t[t.length]=window.resources.TextInstrCandidateRequired)),(!h||h<=0)&&((i==RoleType.TCC.value||i==RoleType.TCAdmin.value)&&(t[t.length]=window.resources.TextNoInventoryForTC),(i==RoleType.TSC.value||i==RoleType.TSAdmin.value)&&(t[t.length]=window.resources.TextNoInventoryForTS)),n.showResponseError("assignError","errlist",t)};return{init:function(){var n=this;e>0?($("#divInventoryPool").toggleClass("hide",!1),$("#divAssignType").toggleClass("hide",!1)):($("#divInventoryPool").toggleClass("hide",!0),$("#divAssignType").toggleClass("hide",!0));$("#RoleId").on("change",function(t){var i=$(t.target).val(),r;i>0?(n.resetAll(),$("#divTC").toggleClass("hide",!0),$("#divTS").toggleClass("hide",!0),$("#divCourse").toggleClass("hide",!0),$("#divAssignType").toggleClass("hide",!0),$("#divFrom").toggleClass("hide",!0),$("#divTC").toggleClass("hide",!1),r=$(t.target).data("url"),n.getData(r,{selectedRoleId:i},"#ddlTC","#divTC1",window.resources.SelectTrainingCenter)):($("#assignError").toggleClass("hide",!0),$("#divTC").toggleClass("hide",!0),$("#divTS").toggleClass("hide",!0),$("#divFrom").toggleClass("hide",!0),$("#divAssignType").toggleClass("hide",!0),$("#divBox").toggleClass("hide",!0),$("#divSubmit").toggleClass("hide",!0))});$("#radRegular").on("change",function(n){var t=$(n.target);$("#divInstType").toggleClass("hide",!1);$("#divInstructor").toggleClass("hide",!1);$("#divUpload").toggleClass("hide",!0);$("#divSubmit").toggleClass("hide",!1);$("#dataFile").val("");$("#divInstType").toggleClass("hide",!1);$("#radActive").trigger("click")});$("#radBulkUpload").on("change",function(n){var t=$(n.target);$("#divInstType").toggleClass("hide",!0);$("#divInstructor").toggleClass("hide",!0);$("#divUpload").toggleClass("hide",!1);$("#divSubmit").toggleClass("hide",!1);$("#divInstType").toggleClass("hide",!0)});$("#CourseId").on("change",function(r){var h,e,l;$("#assignError").toggleClass("hide",!0);var c=$(r.target).val(),o=$("#ddlTC").val(),s=0,u=$("#RoleId").val();(u==12500027||u==12500026)&&(s=$("#ddlTS option:selected").val());h=$("#hdnHasIntlAlignment").val();e=$("#CourseId option:selected").data("productnumber");o>0?(e==t&&h==1?($("#divAssignType").toggleClass("hide",!0),$("#divInstType").toggleClass("hide",!0)):e==i&&h==0?($("#divAssignType").toggleClass("hide",!0),$("#divInstType").toggleClass("hide",!1),$("#divUpload").toggleClass("hide",!0)):($("#divAssignType").toggleClass("hide",!1),$("#divInstType").toggleClass("hide",!1)),$("#divInstructor").toggleClass("hide",!1),$("input[id=radRegular]:radio").prop("checked",!0),$("#radRegular").trigger("click"),$("input[id=radActive]:radio").prop("checked",!0),$("#radActive").trigger("click"),$("input[id=radActive]:radio").prop("checked",!0),l=$("input[name=instType]:checked").val(),n.getAvailableQty(c,u,o,s),n.getData(f,{tcId:o,tsId:s,courseId:c,productNumber:e,roleId:u,isActive:l==="act"?!0:!1},"#ddlInstructor","#divInstructor",window.resources.SelectInstructor)):($("#divInstructor").toggleClass("hide",!0),$("#divInstType").toggleClass("hide",!0),$("#divBox").toggleClass("hide",!0),$("#divSubmit").toggleClass("hide",!0),$("#divAssignType").toggleClass("hide",!0),$("#dataFile").val(""),$("#divUpload").toggleClass("hide",!0))});$("#ddlTC").on("change",function(t){$("#assignError").toggleClass("hide",!0);var i=$("#RoleId option:selected").val(),r=$(t.target).val();$("#ddlSite").val("");r>0?(n.resetAll(),$("#divTC").toggleClass("hide",!1),$("#divTS").toggleClass("hide",!0),$("#divCourse").toggleClass("hide",!0),i==RoleType.TCC.value||i==RoleType.TCAdmin.value?n.getData(u,{orgId:r,orgType:"tc"},"#CourseId","#divCourse",window.resources.SelectCourse):(i==RoleType.TSC.value||i==RoleType.TSAdmin.value)&&($("#divInstructor").toggleClass("hide",!0),$("#divBox").toggleClass("hide",!0),$("#divSubmit").toggleClass("hide",!0),n.getData(s,{tcId:r,roleId:i},"#ddlTS","#divTS",window.resources.TextSelectTrainingSite))):($("#divTS").toggleClass("hide",!0),$("#divFrom").toggleClass("hide",!0),$("#divCourse").toggleClass("hide",!0),$("#divBox").toggleClass("hide",!0),$("#divSubmit").toggleClass("hide",!0),$("#divInstructor").toggleClass("hide",!0),$("#divAssignType").toggleClass("hide",!0),$("#divInstType").toggleClass("hide",!0))});$("#ddlTS").on("change",function(t){var i=$(t.target).val(),r;$("#assignError").toggleClass("hide",!0);r=$("#ddlTC option:selected").val();i>0?(n.resetAll(),$("#divCourse").toggleClass("hide",!0),n.getData(u,{orgId:i,orgType:"ts"},"#CourseId","#divCourse",window.resources.SelectCourse)):($("#divInstructor").toggleClass("hide",!0),$("#divBox").toggleClass("hide",!0),$("#divSubmit").toggleClass("hide",!0),$("#divCourse").toggleClass("hide",!0),$("#divAssignType").toggleClass("hide",!0),$("#divInstType").toggleClass("hide",!0))});$("input[type=radio][name=instType]").on("change",function(t){var e,r;$("#assignError").toggleClass("hide",!0);var o=$(t.target),s=o.val(),h=$("#ddlTC option:selected").val(),u=0,c=$("#CourseId option:selected").val(),i=$("#RoleId option:selected").val();(i==12500027||i==12500026)&&(u=$("#ddlTS option:selected").val());e=$("#CourseId option:selected").data("productnumber");r=[];r.push($("<option/>",{value:"",text:window.resources.SelectInstructor}));$("#ddlInstructor").empty().append(r).val("");n.getData(f,{tcId:h,tsId:u,courseId:c,productNumber:e,roleId:i,isActive:s==="act"},"#ddlInstructor","#divInstructor",window.resources.SelectInstructor)});$("#ddlInstructor").on("change",function(){$("#divSubmit").toggleClass("hide",!1)});$("#ddlInventoryPool").change()},hideAlert:function(){$("#divk12 .close").off("click");$("#divk12 .close").on("click",function(){$(this).parent().toggleClass("hide",!0)})},initMultiSelect:function(){$(".bootstrapmultiselect").multiselect({buttonWidth:"100%",disableIfEmpty:!1,includeSelectAllOption:!0,selectAllText:window.resources.TextSelectAll,allSelectedText:window.resources.TextAllSelected,nonSelectedText:window.resources.SelectInstructors,nSelectedText:" "+window.resources.TextSelectedInstructors})},resetAll:function(){$("#assignError").toggleClass("hide",!0);$("#divBox").toggleClass("hide",!0);$("#divInstructor").toggleClass("hide",!0);$("#divSubmit").toggleClass("hide",!0);$("#divInstType").toggleClass("hide",!0);$("#dataFile").val("");$("#divUpload").toggleClass("hide",!0)},getData:function(t,i,r,u,f){jQuery.get(t,i,function(n){var i=[];i.push($("<option/>",{value:"",text:f}));n&&n.length>0&&$.each(n,function(n,r){t.toLocaleLowerCase().indexOf("getcourse")!=-1?i.push($("<option/>",{value:r.Id,text:r.Name,"data-productnumber":r.ProductNumber,"data-module":r.HasModule,"data-subcourse":r.HasSubCourse})):t.toLocaleLowerCase().indexOf("getinstructors")!=-1?i.push($("<option/>",{value:r.Id,text:r.Name,"data-instremail":r.email})):i.push($("<option/>",{value:r.Id,text:r.Name}))});$(r).empty().append(i).val("");$(r).toggleClass("hide",!1);$(u).toggleClass("hide",!1);e=$("#CourseId option:selected").val()}).error(function(t){var i=[];i.push($("<option/>",{value:"",text:f}));$(r).empty().append(i).val("");n.showResponseError("assignError","errlist",t)})},getAvailableQty:function(t,i,r,u){$("#divBox").toggleClass("hide",!0);jQuery.get(h,{courseId:t,fromRole:i,tcId:r,tsId:u},function(n){n&&($("#divBox").toggleClass("hide",!1),$("#availQty").text(n))}).error(function(t){n.showResponseError("assignError","errlist",t)})},validateEmail:function(n){return $.trim(n).match(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/igm)?!0:!1},validateMobilePhone:function(n){return $.trim(n).match(/^((\+[1-9]{1,4}[ \-]*)|(\([0-9]{2,3}\)[ \-]*)|([0-9]{2,4})[ \-]*)*?[0-9]{3,4}?[ \-]*[0-9]{3,4}?$/)?!0:!1},validateStudent:function(){var g=this,u,f,e,o,s,p,w,b,h,c,k,l,t=[],a,y,r;if(isMobileNumberExist=!1,$("#tblStudent").find("tr").each(function(n){var t,a,i;if(n!=0){if(t=$(this).find("input"),a=$(this).find("select"),$(t[1]).toggleClass("errorhighlight",!1),$(t[2]).toggleClass("errorhighlight",!1),$(t[3]).toggleClass("errorhighlight",!1),$(t[4]).toggleClass("errorhighlight",!1),$(t[5]).toggleClass("errorhighlight",!1),$(t[6]).toggleClass("errorhighlight",!1),$(a[0]).toggleClass("errorhighlight",!1),t[1].value.trim()||($(t[1]).toggleClass("errorhighlight",!0),u=window.resources.TextFacultyInstructorIdRequired),t[2].value=="")$(t[2]).toggleClass("errorhighlight",!0),e=window.resources.TextIssueDateRequired;else{var y=new Date,v=new Date(t[2].value),r=new Date;r=new Date(r.setMonth(r.getMonth()-6));(v>y||v<r)&&($(t[2]).toggleClass("errorhighlight",!0),c=v>y?window.resources.TextIssueDateRange:window.resources.TextLast6MonthCourseDateRange)}t[3].value.trim()||($(t[3]).toggleClass("errorhighlight",!0),o=window.resources.TextFirstNameRequired);t[4].value.trim()||($(t[4]).toggleClass("errorhighlight",!0),s=window.resources.TextLastNameRequired);t[5].value.trim()||($(t[5]).toggleClass("errorhighlight",!0),f=window.resources.TextInstructorStudentIdRequired);t[6].value.length>0&&(g.validateMobilePhone(t[6].value)||(h=window.resources.TextInvalidMobileNumber,$(t[6]).toggleClass("errorhighlight",!0)));i=$(a[1]);window.studentAssignmentViewModel.HasSubCourse==1&&i.length>0&&(!i.val()||i.val().length===0)&&(i.toggleClass("errorhighlight",!0),l=window.resources.TextCourseTypeRequired)}}),u&&(t[t.length]=u),e&&(t[t.length]=e),o&&(t[t.length]=o),s&&(t[t.length]=s),p&&(t[t.length]=p),c&&(t[t.length]=c),w&&(t[t.length]=w),b&&(t[t.length]=b),f&&(t[t.length]=f),h&&(t[t.length]=h),k&&(t[t.length]=k),l&&(t[t.length]=l),!$("#radBulkUpload").is(":checked")){if(a=$('input[id="CourseDate"]').val(),a){var d=new Date,v=new Date(a),i=new Date;i=new Date(i.setMonth(i.getMonth()-6));(v>d||v<i)&&(v>d?t.push(window.resources.TextIssueDateRange):t.push(window.resources.TextLast6MonthCourseDateRange))}else t.push(window.resources.TextCourseMonitoredDateRequired);y=$("#assignTo").find(":selected");y&&y.length!==0||t.push(window.resources.TextInstrCandidateRequired);r=$("#ddlSubCourse option:selected").val();r!=undefined&&(r==""||r<=0)&&window.studentAssignmentViewModel.HasSubCourse==1&&!$("#radBulkUpload").is(":checked")&&(t[t.length]=window.resources.TextCourseTypeRequired)}return(n.showResponseError("assignErrorstep2","errlist",t),t.length===0)?!0:!1},validateInstrStudent:function(){var w=this,f,e,o,s,h,c,l,a,v,y,t=[],i,r;if(isMobileNumberExist=!1,$("#tblInstrStudent").find("tr").length<=1&&t.push(window.resources.TextAtLeastOneCandidateRequired),i=$('input[id="CourseDate"]'),$(i).toggleClass("errorhighlight",!1),i.val()=="")$(i).toggleClass("errorhighlight",!0),f=window.resources.TextIssueDateRequired;else{var b=new Date,p=new Date(i.val()),u=new Date;u=new Date(u.setMonth(u.getMonth()-6));(p>b||p<u)&&($(i).toggleClass("errorhighlight",!0),v=p>b?window.resources.TextIssueDateRange:window.resources.TextLast6MonthCourseDateRange)}return(r=$("#ddlSubCourse"),r.toggleClass("errorhighlight",!1),window.studentAssignmentViewModel.HasSubCourse==1&&r.length>0&&(!r.val()||r.val().length===0)&&(r.toggleClass("errorhighlight",!0),y=window.resources.TextCourseTypeRequired),$("#tblInstrStudent").find("tr").each(function(n){if(n!=0){var t=$(this).find("input");$(t[1]).toggleClass("errorhighlight",!1);$(t[2]).toggleClass("errorhighlight",!1);$(t[3]).toggleClass("errorhighlight",!1);$(t[4]).toggleClass("errorhighlight",!1);t[1].value.trim()||($(t[1]).toggleClass("errorhighlight",!0),e=window.resources.TextFirstNameRequired);t[2].value.trim()||($(t[2]).toggleClass("errorhighlight",!0),o=window.resources.TextLastNameRequired);t[3].value.trim()?(w.validateEmail(t[3].value)||($(t[3]).toggleClass("errorhighlight",!0),h=window.resources.TextInvalidEmail),t[3].value.trim()==$("#hdnLoggedInUserEmail").val()&&(c=window.resources.TextInvalidStudentEmailLoggedInMsg),t[3].value.trim()==$("#ddlInstructor option:selected").data("instremail")&&(l=window.resources.TextInvalidStudentEmailMsg)):($(t[3]).toggleClass("errorhighlight",!0),s=window.resources.TextEmailRequired);t[4].value.length>0&&(w.validateMobilePhone(t[4].value)||(a=window.resources.TextInvalidMobileNumber,$(t[4]).toggleClass("errorhighlight",!0)))}}),f&&(t[t.length]=f),e&&(t[t.length]=e),o&&(t[t.length]=o),s&&(t[t.length]=s),c&&(t[t.length]=c),l&&(t[t.length]=l),v&&(t[t.length]=v),h&&(t[t.length]=h),a&&(t[t.length]=a),y&&(t[t.length]=y),n.showResponseError("assignErrorstep2","errlist",t),t.length===0)?!0:!1},highlightDuplicateRows:function(){isDuplicate=!1;var t={},i=function(){return $.trim($(this).text())};$("#tblConfirm").find("tr").each(function(){var n=$(this).find(".duplicate-student").map(i).toArray().join("|");t.hasOwnProperty(n)?t[n].push(this):t[n]=[this]});$.each(t,function(n,t){t.length>1&&$.each(t,function(n,t){n>0&&(t.style.backgroundColor="#ebccd1",isDuplicate=!0)})});isDuplicate&&($("#assignErrorstep3").toggleClass("hide",!1),n.showWarning("assignErrorstep3","errlist1",window.resources.TextDuplicateStudents))},assignModel:function(n){var o,u,r,h,f,s,e;if(window.studentAssignmentViewModel.CourseName="",window.studentAssignmentViewModel.TCName=$("#ddlTC option:selected").text(),window.studentAssignmentViewModel.TrainingSiteName=$("#ddlTS option:selected").text(),window.studentAssignmentViewModel.InstructorName=$("#ddlInstructor option:selected").text(),window.studentAssignmentViewModel.CourseId=$("#CourseId option:selected").val(),window.studentAssignmentViewModel.CourseId&&(window.studentAssignmentViewModel.CourseName=$("#CourseId option:selected").text(),window.studentAssignmentViewModel.ProductNumber=$("#CourseId option:selected").data("productnumber")),window.studentAssignmentViewModel.HasSubCourse=$("#CourseId")[0].options[$("#CourseId")[0].selectedIndex].getAttribute("data-subcourse"),window.studentAssignmentViewModel.TCId=$("#ddlTC option:selected").val(),window.studentAssignmentViewModel.TrainingSiteId=0,($("#RoleId").val()==RoleType.TSC.value||$("#RoleId").val()==RoleType.TSAdmin.value)&&(window.studentAssignmentViewModel.TrainingSiteId=$("#ddlTS option:selected").val()),window.studentAssignmentViewModel.InstructorId=$("#ddlInstructor option:selected").val(),window.studentAssignmentViewModel.InstructorId&&$("#hdnInstrName").val($("#ddlInstructor option:selected").text()),window.studentAssignmentViewModel.AvailableQty=parseInt($("#availQty").text()),window.studentAssignmentViewModel.FromRoleId=$("#RoleId option:selected").val(),window.studentAssignmentViewModel.IsUpload=$("#radBulkUpload").is(":checked"),o=$('input[id="CourseDate"]').val(),$("#ddlSubCourse").val()==undefined||studentAssignmentViewModel.IsUpload||(window.studentAssignmentViewModel.SubCourseId=$("#ddlSubCourse option:selected").val(),window.studentAssignmentViewModel.SubCourseName=$("#ddlSubCourse option:selected").text()),n!=="btnMoveNext"&&(u=$("#CourseId option:selected").data("productnumber"),r=[],$("#radBulkUpload").is(":checked")&&n=="btnConfirm"?(r=[],$("#tblStudent").find("tr").each(function(n){if(n!=0){var t=$(this).find("input"),i=$(this).find("select");r.push({InstructorId:t[1].value.trim(),CourseDate:t[2].value.trim(),FirstName:t[3].value.trim(),LastName:t[4].value.trim(),InstructorStudentId:t[5].value.trim(),Phone:t[6].value.trim(),CourseModuleName:studentAssignmentViewModel.HasModule==1?i.find(":selected").map(function(n,t){return t.text}).get().join(", "):"",CourseModuleId:studentAssignmentViewModel.HasModule==1?i.find(":selected").map(function(n,t){return t.value}).get().join(","):"",SubCourseId:studentAssignmentViewModel.HasSubCourse==1?i.find(":selected").map(function(n,t){return t.value}).get().join(","):null,SubCourse:studentAssignmentViewModel.HasSubCourse==1?i.find(":selected").map(function(n,t){return t.text}).get().join(","):""})}})):$("#radBulkUpload").is(":checked")||n!="btnConfirm"||u!=i&&u!=t?$("#radBulkUpload").is(":checked")||n!="btnFinish"||u!=i&&u!=t?$("#radBulkUpload").is(":checked")&&n=="btnFinish"?(r=[],$("#tblConfirm").DataTable().rows().every(function(){var n=$(this.node()).data("instrprofileid"),t=$(this.node()).data("subcourseid");item=this.data();r.push({InstructorId:item[0],InstructorName:item[1],CourseDate:item[2],FirstName:item[3],LastName:item[4],Email:item[5],InstructorStudentId:item[6],Phone:item[7],SubCourseId:t,InstructorProfileId:n})})):(h=$("#assignTo").find(":selected"),r=[],$.each(h,function(n,t){var i=$(t);r.push({InstructorId:i.val(),CourseDate:o,FirstName:i.data("fname"),LastName:i.data("lname"),Email:i.data("email"),SsoId:i.data("ssoid"),InstructorStudentId:i.data("instrid"),Phone:i.data("phone"),SubCourseId:i.data("subCourse")})})):(r=[],$("#tblConfirm").DataTable().rows().every(function(){var n=$(this.node()).data("instrprofileid"),t=$(this.node()).data("subcourseid");item=this.data();r.push({CourseDate:item[0],FirstName:item[1],LastName:item[2],Email:item[3],InstructorStudentId:item[4],Phone:item[5],SubCourseId:t,InstructorProfileId:n})})):(r=[],$("#tblInstrStudent").find("tr").each(function(n){if(n!=0){var t=$(this).find("input"),i=$(this).find("select");r.push({InstructorId:$("#ddlInstructor option:selected").val(),CourseDate:o,FirstName:t[1].value.trim(),LastName:t[2].value.trim(),Email:t[3].value.trim(),Phone:t[4].value.trim(),SubCourseId:$("#ddlSubCourse option:selected").val(),SubCourse:$("#ddlSubCourse option:selected").text()})}})),window.studentAssignmentViewModel.AssignedQty=r.length,window.studentAssignmentViewModel.StudentList=r),n==="btnMoveNext"&&$("#radBulkUpload").is(":checked")&&$("#radBulkUpload").is(":checked")){for(f=new FormData,s=$("#dataFile")[0].files,e=0;e<s.length;e++)f.append("file",s[e]);return window.studentAssignmentViewModel.InstructorId=0,f.append("model",JSON.stringify(window.studentAssignmentViewModel)),f}return window.studentAssignmentViewModel},checkDuplicateEmail:function(){var e=$("#tblStudent").find("tr").length>0,u=[],f=[],r,i,t;for($("#tblInstrStudent").find("tr").each(function(n){if(n!=0){var t=$(this).find("input");f.push(t[3].value.trim())}}),r=f.sort(),i=[],t=0;t<r.length-1;t++)r[t+1]==r[t]&&i.push(r[t]);for(t=0;t<i.length;t++)$("#tblInstrStudent").find("tr").each(function(n){if(n!=0){var r=$(this).find("input");r[3].value.trim()==i[t]&&$(r[3]).toggleClass("errorhighlight",!0)}});return(i.length>0&&(u[u.length]=window.resources.TextSameEmailMSg),n.showResponseError("assignErrorstep2","errlist",u),i.length>0)?!0:!1},checkDuplicateStudentInstrId:function(){var u=[],f=[],r,i,t;for($("#tblStudent").find("tr").each(function(n){if(n!=0){var t=$(this).find("input");f.push(t[5].value.trim())}}),r=f.sort(),i=[],t=0;t<r.length-1;t++)r[t+1]==r[t]&&i.push(r[t]);for(t=0;t<i.length;t++)$("#tblStudent").find("tr").each(function(n){if(n!=0){var r=$(this).find("input");r[5].value.trim()==i[t]&&$(r[5]).toggleClass("errorhighlight",!0)}});return(i.length>0&&(u[u.length]=window.resources.TextSameInstrIdMSg),n.showResponseError("assignErrorstep2","errlist",u),i.length>0)?!0:!1},moveNext:function(t){var i=$(t).data("view"),r,u;return i==="#candidateAssignment"&&$("#radBulkUpload").is(":checked")&&$("#dataFile")[0].files.length==0?(n.showResponseError("assignError","errlist",window.resources.TextUploadFileRequired),!1):(i==="#completeAssignCards"&&$(t).prop("disabled",!0),r=this.assignModel(t.id),!c())?(i==="#completeAssignCards"&&$(t).prop("disabled",!1),!1):(u=$(t).data("url"),this.submit(u,r,this.render,"",i),!1)},movePrevious:function(n){this.hideAll();$(n).toggleClass("hide",!1);$("#assignErrorstep2").toggleClass("hide",!0);$("#assignErrorstep3").toggleClass("hide",!0)},submit:function(r,u,f,e,o){var h=this,c,s,a;if(o!=="#candidateAssignment"&&(window.studentAssignmentViewModel.ProductNumber==i||window.studentAssignmentViewModel.ProductNumber==t?!h.validateInstrStudent():!h.validateStudent()))return o=="#completeAssignCards"&&$("#btnFinish").prop("disabled",!1),!1;if(c=!1,s="assignError",o==="#confirmAssignCards"&&(s="assignErrorstep2",$("#radBulkUpload").is(":checked")?h.checkDuplicateStudentInstrId():h.checkDuplicateEmail()))return!1;if(o==="#completeAssignCards"&&(s="assignErrorstep3"),$("#radBulkUpload").is(":checked")&&o==="#candidateAssignment")try{$("#divAssignInstructor").toggleClass("hide",!0);$("#divStudentTbl").toggleClass("hide",!1);jQuery.ajax({url:r,type:"POST",contentType:!1,processData:!1,data:u,dataType:"html",success:function(n){h.render(n,o)},error:function(t){n.showResponseError(s,"errlist",t)}})}catch(l){a=100}else try{$("#divStudentTbl").toggleClass("hide",!1);$("#radBulkUpload").is(":checked")?$("#divAssignInstructor").toggleClass("hide",!0):$("#divAssignInstructor").toggleClass("hide",!1);jQuery.post(r,u,function(n){h.render(n,o)}).fail(function(t){var u,r;if(c=!0,o=="#confirmAssignCards"){var i=n.ExtractError(t),f=i[0].indexOf("Teaching Instructor Id and Student Instructor")!=-1,e=i[0].indexOf("Instructor ID is not aligned with the TC")!=-1,h=f|e;if(h>0){for(u=i[0].split(":")[0].split(","),r=0;r<u.length;r++)$("input").filter(function(){return this.value==u[r]}).addClass("errorhighlight");n.showResponseError(s,"errlist",i[0].split(":")[1])}else n.showResponseError(s,"errlist",t)}else n.showResponseError(s,"errlist",t)}).always(function(){o!=="#completeAssignCards"||c||$("#btnFinish").prop("disabled",!1)})}catch(l){console.log(l)}},render:function(t,i){var u=this,f,e;t&&($(i).html(t),n.initDatePicker(!0),i=="#candidateAssignment"&&(u.initMultiSelect(),$("#moduleHelp").toggleClass("hide",window.studentAssignmentViewModel.HasModule!=1),$("#tdAssignTCName").html($("#ddlTC option:selected").text()),$("#tdAssignLocName").html($("#ddlLocation option:selected").text())),$("[id*='tdInstrNameP']").html($("#hdnInstrName").val()),$('[data-toggle="popover"]').popover());i==="#confirmAssignCards"&&($("#radBulkUpload").is(":checked")&&u.highlightDuplicateRows(),$("#tblConfirm").DataTable({pageLength:25}),u.assignModel());u.hideAll();$(i).toggleClass("hide",!1);r.init();i==="#completeAssignCards"&&(f=$("#tblEcard").DataTable({pageLength:25}),f.context.length>0&&(e=new $.fn.dataTable.Buttons(f,{buttons:[{extend:"excelHtml5",title:n.getFileName("Assigned eCards")}]}),$("#exportStudent").prepend(e.container()).find("a.dt-button").addClass("btn btn-primary").text(window.resources.TextDownload),e.container().css("display","inline-block")));n.focusMessage()},hideAll:function(){$("#index").toggleClass("hide",!0);$("#candidateAssignment").toggleClass("hide",!0);$("#confirmAssignCards").toggleClass("hide",!0)},remove:function(t){var r,u,i;return $("#tblStudent").find("tr").length>2?(r=$(t).closest("tr"),r.remove(),u=$("#tblConfirm").DataTable(),u.row(r).remove().draw(!1),i=$("#tblStudent").find("tr").length-1,window.studentAssignmentViewModel.AssignedQty=i,$("#divAssignQty").text(i),$("#assignQty").val(i)):n.showResponseError("assignErrorstep2","errlist2",window.resources.TextAtLeastOneStudentRequired),!1},updateDate:function(n){var t=$(n).val();$("#tblStudent").find("tr").each(function(n){if(n!=0){var i=$(this).find("input");$(i[2]).datepicker("setDate",t)}})},updateSubCourse:function(n){var t=$(n).val();$("#tblStudent").find("tr").each(function(n){if(n!=0){var i=$(this).find("select");i.val(t)}})},removeConfirm:function(t){var i,u,f,e,r;return $("#tblConfirm").find("tr").length>2?(i=$(t).closest("tr"),u=i.data("instrprofileid"),i.remove(),f=$("#tblConfirm").DataTable(),f.row(i).remove().draw(!1),e=$("#tblConfirm").find("tr"),r=e.length-1,window.studentAssignmentViewModel.AssignedQty=r,$("#assignTo").multiselect("deselect",[u]),$("#tdAssignQty").html(r)):n.showResponseError("assignErrorstep3","errlist3",window.resources.TextAtLeastOneCandidateRequired),!1},addNewInstructor:function(){$("#divInstrStudentTbl").toggleClass("hide",!1);var t=$("#tblInstrStudent"),n=$("#tblInstrStudent").find("tr").length,i=`<tr data-instid="item.Email">
                                    <td class="hide">
                                        <label for="chkAll`+n+`")" class="sr-only">name</label>
                                        <input type="checkbox" id="chkAll`+n+`")" />
                                    </td>
                                    <td>
                                        <label for="firstname`+n+`" class="sr-only">name</label>
                                        <input class="form-control"  name="firstName" id="firstname`+n+`" type="text" placeholder="`+window.resources.FirstName+`" />
                                    </td>
                                    <td>
                                        <label for="lastname`+n+`" class="sr-only">last</label>
                                        <input class="form-control"  name="lastName" id="lastname`+n+`" type="text" placeholder="`+window.resources.LastName+`" />
                                    </td>
                                    <td>
                                        <label for="email`+n+`" class="sr-only">email</label>
                                        <input class="form-control"  name="email" type="text" id="email`+n+`" placeholder="`+window.resources.Email+`" />
                                    </td>
                                    <td>
                                        <label for="phone`+n+`" class="sr-only">phone</label>
                                        <input class="form-control"  name="phone" type="text" id="phone`+n+`" placeholder="xxx-xxx-xxxx">
                                    </td>
                                    <td class="hide">
                                        <div class="multiselect-bin">
                                            <label for="subCourse`+n+`" class="sr-only">SubCourses</label>
                                            <select class="form-control" id="subCourse`+n+`" title="SubCourse" name="subCourse">
                                                <option value="" selected disabled>`+window.resources.SelectCourseType+`</option>
                                            </select>
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        <a href="#" onclick="appInstrCandidateAssignment.removeInstructor(this);return false;">
                                            <i class="fa fa-trash-o fa-2x" aria-hidden="true"></i>
                                            <span class="sr-only">`+window.resources.Delete+`</span>
                                        </a>
                                    </td>
                                </tr>`;return t.append(i),!1},removeInstructor:function(t){var r,i;return $("#tblInstrStudent").find("tr").length>2?(r=$(t).closest("tr"),r.remove(),i=$("#tblInstrStudent").find("tr").length-1,window.studentAssignmentViewModel.AssignedQty=i,$("#divAssignQty").text(i),$("#assignQty").val(i)):n.showResponseError("assignErrorstep2","errlist2",window.resources.TextAtLeastOneStudentRequired),!1}}},AppInstructorEcardStatus=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon,t="",i=!0,r=!1,u=function(i){$("#assignError").html("");$("#assignError").addClass("hide");var u=$("#eCardStatusForm").find('select[id="CourseId"]').val(),f=$("#eCardStatusForm").find('input[id="StartDate"]').val(),e=$("#eCardStatusForm").find('input[id="EndDate"]').val(),o=$("#eCardStatusForm").find('select[id="ddlTC"]').val(),s=$("#eCardStatusForm").find('select[id="ddlLocation"]').val(),r=[];return(i&&((!u||u.length<=0)&&(r[r.length]=window.resources.TextCourseRequired),u&&t&&((""===o||o<=0)&&(r[r.length]=window.resources.TextTrainingCenterRequired),t==="location"&&!s&&o&&(r[r.length]=window.resources.TextLocationRequired))),f&&e||(r[r.length]=window.resources.TextTransactionsDatesRequired),(f||e)&&!n.isValidDate(f,e)&&(r[r.length]=n.getDateFormatError(window.resources.TransactionDate)),r.length>0)?(n.showResponseError("assignError","errlist",r),!1):!0};return{init:function(){var n=this;$("#lnkAdvanced").toggleClass("hide",!0);$("#CourseId").on("change",$.proxy(n.changeCourse,n));$(".datepicker").on("change",function(){r=!0});n.initMultiSelect();$("#ddlTC").on("change",function(i){var r=$(i.target).val();r?t==="location"&&($("#divLocation").toggleClass("hide",!1),n.getLocation({TcId:r})):$("#divLocation").toggleClass("hide",!0)});$("input[type=radio][name=fromType]").on("change",function(n){$("#assignError").html("").addClass("hide");var i=$(n.target);t=i.val();$("#ddlTC").val("");$("#ddlLocation").val("");$("#divType").toggleClass("hide",!1);$("#divTC").toggleClass("hide",!1);t==="tc"&&$("#divLocation").toggleClass("hide",!0)})},initMultiSelect:function(){$("#CourseId").multiselect({buttonWidth:"100%",disableIfEmpty:!1,includeSelectAllOption:!0,selectAllText:window.resources.TextSelectAll,allSelectedText:window.resources.TextAllSelected,nonSelectedText:window.resources.SelectCourses,nSelectedText:" "+window.resources.TextSelectedCourses});$("#VAMCourseId").multiselect({buttonWidth:"100%",disableIfEmpty:!1,includeSelectAllOption:!0,selectAllText:window.resources.TextSelectAll,allSelectedText:window.resources.TextAllSelected,nonSelectedText:window.resources.SelectCourses,nSelectedText:" "+window.resources.TextSelectedCourses})},changeCourse:function(t){var i=this,o=$(t.target),u=$("#CourseId").find(":selected").map(function(n,t){return t.value}).get().join(","),f,e;if(r=!0,i.btnClick_reset_ecardRequests(!0),f=$(t.target).data("url"),e=$("#CourseId").find(":selected").map(function(n,t){return $(t).data("isparent")}).get().join(","),e=="True"?($("#divVAMCourse").toggleClass("hide",!1),jQuery.get(f,{courseId:u},$.proxy(i.loadVAMCourse,i)).error(function(t){n.showResponseError("assignError","errlist",t)})):($("#divVAMCourse").toggleClass("hide",!0),$("#VAMCourseId").multiselect("deselectAll",!1).multiselect("refresh")),!u)return!1;i.getTCList({courseIds:u});$("#lnkAdvanced").toggleClass("hide",!1);$("#lnkAdvanced").off("click");$("#lnkAdvanced").on("click",i.showHideOptions)},getTCList:function(t){var i=$("#tc").data("url");jQuery.get(i,t,function(n){if(n&&n.length>0){var t=[];t.push($("<option/>",{value:"",text:window.resources.SelectTrainingCenter}));$.each(n,function(n,i){t.push($("<option/>",{value:i.TrainingCenterId,text:i.Name}))});$("#ddlTC").empty().append(t);$("#ddlTC").val("")}}).error(function(t){$("#ddlTC").empty();n.showResponseError("assignError","errlist",t)})},getLocation:function(t){var i=$("#ddlLocation").data("url");jQuery.get(i,t,function(n){if(n&&n.length>0){var t=[];t.push($("<option/>",{value:"",text:window.resources.TextSelecteCardLocation}));$.each(n,function(n,i){t.push($("<option/>",{value:i.Id,text:i.Name}))});$("#ddlLocation").empty().append(t);$("#ddlLocation").val("")}}).error(function(t){$("#ddlLocation").empty();n.showResponseError("assignError","errlist",t)})},showHideOptions:function(n){i=!i;var t=$(n.target).find("span.caret");return setTimeout(function(){$("#divOptions").toggleClass("hide",i)},100),t.toggleClass("rotate",!i),!1},btnClick_search_ecardRequests:function(t){var i=this,f;return u(t)?(f=$("#fetchReq").data("url"),jQuery.ajax({url:f,type:"POST",dataType:"html",data:$("#eCardStatusForm").serialize(),success:function(u){var f,e;$("#partial").html(u);f=$("#example").DataTable({pageLength:25,order:[[5,"desc"]],columnDefs:[{targets:0,visible:!1}]});f.context.length>0&&(e=new $.fn.dataTable.Buttons(f,{buttons:[{extend:"excelHtml5",title:n.getFileName("Instructor eCard Status"),exportOptions:{columns:":visible"}}]}),$("#expotbutton").prepend(e.container()).find("a.dt-button").addClass("btn btn-primary").text(window.resources.TextDownload));$("#example").on("click",".lnkecard",$.proxy(i.loadECards,i));t&&n.focusArea("#partial");$("#spdaysView").toggleClass("hide",r);$('[data-toggle="popover"]').popover()},error:function(t){n.showResponseError("assignError","errlst",t)}}),!1):!1},btnClick_reset_ecardRequests:function(u){var f=this;$("#assignError").html("").addClass("hide");$("#ddlTC").empty().val("");$("#divTC").toggleClass("hide",!0);$("#ddlLocation").empty().val("");$("#divLocation").toggleClass("hide",!0);$("#ddlType").val("");$("#divType").toggleClass("hide",!0);$("#divOptions").toggleClass("hide",!0);$("input[type=radio][name=fromType]").prop("checked",!1);i=!0;$("#lnkAdvanced").find("span.caret").toggleClass("rotate",!1);$("#lnkAdvanced").toggleClass("hide",!0);u||(t="",$("#CourseId").multiselect("deselectAll",!1).multiselect("refresh"),$("#StartDate").datepicker("setDate",n.getMonthOldDate()),$("#EndDate").datepicker("setDate",n.getCurrentDate()),r=!1,f.btnClick_search_ecardRequests(!1));u||n.focusMessage()},loadVAMCourse:function(n){if(n&&n.length>0){var t=[];$.each(n,function(n,i){t.push($("<option/>",{value:i.CourseId,text:i.Name}))});$("#VAMCourseId").empty().append(t);$("#VAMCourseId").val("");$("#VAMCourseId").empty().append(t).multiselect("rebuild")}},loadECards:function(n){n.preventDefault();var t=this,i=$(n.target).data("transactionid");t.getECards(i)},getECards:function(t,i){var r=this,u=$("#profileId option:selected").val(),f=$("#hdnUrl").val();r.isSuccess=!!i;jQuery.get(f,{transactionId:t,profileId:u},$.proxy(r.populateECards,r)).error(function(t){n.showResponseError("assignError","errlist",t)})},populateECards:function(t){var u=this,i,r;t&&($("#divStudentECards").toggleClass("hide",!1),$("#divECardStatus").toggleClass("hide",!0),$("#divStudentECards").html(t),u.isSuccess&&$("#divAlert").toggleClass("hide",!1),i=$("#tblECards").DataTable(),i.context.length>0&&(r=new $.fn.dataTable.Buttons(i,{buttons:[{extend:"excelHtml5",title:n.getFileName("Student eCards")}]}),$("[data-blocked]").closest("tr").addClass("blockedInRed"),$("#exportECard").prepend(r.container()).find("a.dt-button").addClass("btn btn-primary").text(window.resources.TextDownload),r.container().css("display","inline-block"),$("#lnkGoResults").click(u.NavigateToResults),n.focusMessage()))},NavigateToResults:function(t){t.preventDefault();$("#divStudentECards, #divEditCard").html("");$("#divStudentECards, #divEditCard").toggleClass("hide",!0);$("#divECardStatus").toggleClass("hide",!1);n.focusArea("#partial")}}},AppInventory=function(){function t(n,t,i,r,u){var s=$("#inventoryPool option:selected").index(),f,h=$("#inventoryPool option:selected").val(),c,o,e;if(h==4){for(o=JSON.parse(n[5]),f=' <div class="text-center tableChildWrapper"> <table class="table table-bordered"><thead><th>'+window.resources.TextTrainingSite+"<\/th><th>"+window.resources.TextAvailableQuantity+"<\/th><\/thead><tbody>",e=0;e<o.length;e++)f+="<tr><td>",o[e].SourceType=="2"&&(f+=o[e].SourceName),f+="<\/td><td>"+o[e].AvailableBalance+"<\/td><\/tr>";f+="<\/tbody><\/table><\/div>"}if((t=="tcc"||t=="tcadmin")&&s!=2&&(o=JSON.parse(n[5]),c=o[0].CourseType,f=c!=4||u?u?'<div class="text-center"><br/>                                                    <a href="TrainingCenter/TrainingSiteAssignment" aria-label="Assign To Training Site" class="btn btn-sm btn-primary">'+window.resources.TextAssignToTrainingSite+"<\/a>                                                   <\/div>                                                   ":'<div class="text-center"><br/>                                                   <a href="InstructorAssignment?courseId='+n[1]+'"class="btn btn-sm btn-primary" > '+window.resources.TextAssignToInstructor+' <\/a>                                                   <a href="TrainingCenter/TrainingSiteAssignment?courseId='+n[1]+'" aria-label="Assign To Training Site" class="btn btn-sm btn-primary">'+window.resources.TextAssignToTrainingSite+'<\/a>                                                   <a href="Student/StudentAssignment?courseId='+n[1]+"&inventoryPool="+i+'" aria-label="Assign To Students"  class="btn btn-sm btn-primary">'+window.resources.TextAssignToStudents+" <\/a>                                                   <\/div>                                                   ":'<div class="text-center"><br/>                 <a href="TrainingCenter/AssignInstructorCandidate?courseId='+n[1]+"&inventoryPool="+i+'" aria-label="Assign to Instructor Candidates/Renewals"  class="btn btn-sm btn-primary">'+window.resources.TextAssignToInstructorCandidate+'<\/a>                <a href="TrainingCenter/TrainingSiteAssignment?courseId='+n[1]+'" aria-label="Assign To Training Site" class="btn btn-sm btn-primary">'+window.resources.TextAssignToTrainingSite+"<\/a>                <\/div>                "),(t=="tsc"||t=="tsadmin")&&s!=2){for(o=JSON.parse(n[5]),f=' <div class="text-center tableChildWrapper"> <table class="table table-bordered"><thead><th>'+window.resources.TextTrainingSite+"<\/th><th>"+window.resources.TextAvailableQuantity+"<\/th><\/thead><tbody>",e=0;e<o.length;e++)f+="<tr><td>",f+=o[e].SourceName+"("+o[e].SourceCode+")",f+="<\/td><td>"+o[e].AvailableBalance+"<\/td><\/tr>";f+="<\/tbody><\/table><\/div>";f=u?f:f+'<div class="text-center"><br/>                    <a href="InstructorAssignment?courseId='+n[1]+'"class="btn btn-sm btn-primary" >'+window.resources.TextAssignToInstructor+' <\/a>                    <a href="Student/StudentAssignment?courseId='+n[1]+"&inventoryPool="+i+'" aria-label="Assign"  class="btn btn-sm btn-primary">'+window.resources.TextAssignToStudents+" <\/a>                    <\/div>                    "}if(t=="ecardadmin"&&s!=2){for(o=JSON.parse(n[5]),f=' <div class="text-center tableChildWrapper"> <table class="table table-bordered"><thead><th>'+window.resources.TexteCardLocation+"<\/th><th>"+window.resources.TextAvailableQuantity+"<\/th><\/thead><tbody>",e=0;e<o.length;e++)f+="<tr><td>",f+=o[e].SourceName,f+="<\/td><td>"+o[e].AvailableBalance+"<\/td><\/tr>";f+="<\/tbody><\/table>";f+='<div class="text-center"><br/>                <a href="InstructorAssignment?courseId='+n[1]+'"class="btn btn-sm btn-primary" >'+window.resources.TextAssignToInstructor+' <\/a>                <a href="Student/StudentAssignment?courseId='+n[1]+"&inventoryPool="+i+'" aria-label="Assign"  class="btn btn-sm btn-primary">'+window.resources.TextAssignToStudents+" <\/a>                <\/div>                "}if((t=="instructor"||s==2)&&h!=4){for(o=JSON.parse(n[5]),f=' <div class="text-center tableChildWrapper"> <table class="table table-bordered"><thead><th>'+window.resources.TextTrainingCenter+"<\/th><th>"+window.resources.TextTrainingSite+"<\/th><th>"+window.resources.TextAvailableQuantity+"<\/th><\/thead><tbody>",e=0;e<o.length;e++)f+="<tr><td>",f+=o[e].SourceType==1?o[e].SourceName:$("#tcId option:selected").text(),f+="<\/td><td>",o[e].SourceType=="2"&&(f+=o[e].SourceName),f+="<\/td><td>"+o[e].AvailableBalance+"<\/td><\/tr>";r&&(f+='<\/tbody><\/table><a href="Student/StudentAssignment?courseId='+o[0].CourseId+"&inventoryPool="+i+'" aria-label="Assign" class="btn btn-primary btn-sm">'+window.resources.TextAssignToStudents+"<\/a><\/div>")}return f}$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon;return{init:function(){var n=this;$(document).ready(function(){setTimeout(function(){$("#inventoryPool").trigger("change")},600)});$("#inventoryPool").on("change",function(){var r=JSON.parse($("#algnTCWithRole").val()),t=$("#inventoryPool option:selected").val(),i;t==3?($("#divTC").toggleClass("hide",!0),$("#divSite").toggleClass("hide",!0)):$("#divTC").toggleClass("hide",!1);t==RoleType.Instructor.value&&($("#divInstructor").toggleClass("hide",!0),$("#divSite").toggleClass("hide",!0));i=[];$.each(r,function(n,r){var u=!1;$.each(i,function(n,t){t.val()==r.ParentEntityId&&(u=!0)});u||((t==RoleType.TCC.value||t==RoleType.TCAdmin.value||t=="4")&&(r.RoleId==RoleType.TCC.value||r.RoleId==RoleType.TCAdmin.value)&&i.push($("<option/>",{value:r.ParentEntityId,text:r.ParentEntityName})),t==RoleType.Instructor.value&&r.RoleId==RoleType.Instructor.value&&i.push($("<option/>",{value:r.ParentEntityId,text:r.ParentEntityName})),(t==RoleType.TSC.value||t==RoleType.TSAdmin.value)&&(r.RoleId==RoleType.TSC.value||r.RoleId==RoleType.TSAdmin.value)&&i.push($("<option/>",{value:r.ParentEntityId,text:r.ParentEntityName})))});$("#tcId").empty().append(i);$("#tcId").val($("#tcId option:first").val());n.getInventory()});$("#tcId").on("change",function(){$("#tsid option:selected").val("");n.getInventory()});$("#tsid").on("change",function(){var r=$("#tsid option:selected").val(),e=$("#inventoryPool").data("url"),o=$("#tcId option:selected").val(),t=$("#inventoryPool option:selected").val(),u,i,f;t==RoleType.TSC.value&&(u=JSON.parse($("#algnTCWithRole").val()),$.each(u,function(n,i){i.EntityId==r&&(t=i.RoleId)}));i={};f=!0;i={roleId:t,tcIdInCaseDualRole:o,tsId:r};n.loadInventory(e,i,f,n)});$("#instructor").on("change",function(){n.getInventory()});$("#btnDownload").on("click",function(){n.downloadInventory()});$("#btnSiteDownload").on("click",function(){n.downloadSiteInventory()});$("input[name=radCourseType]:radio").on("change",function(t){var i=$(t.target);n.getInventory(i.val()=="1")})},expand:function(n,i,r){if(n.which==13||n.type=="click"){var e=$(n.target.parentElement).find("span.caret"),f=n.target.parentElement,u=i.row(f);if(u.child.isShown())u.child.hide(),setTimeout(function(){$(f).removeClass("shown")},100),e.removeClass("rotate");else{var o=$(".dataTable").data("userrole"),s=$(".dataTable").data("inventorysource"),h=$(".dataTable").data("hasintlalignment");u.child(t(u.data(),o.toLowerCase(),s,r,h),"active").show();setTimeout(function(){$(f).addClass("shown")},100);e.addClass("rotate")}}},getInventory:function(n){var o=this,s="",h=!0,t,i,r,e,c,u,f;if($("#inventoryError").html(""),$("#inventoryError").addClass("hide"),$("#divInstructor").toggleClass("hide",!0),t=$("#inventoryPool option:selected").val(),t=="3"){if($("#divInstructor").toggleClass("hide",!1),t="2660004",s={userId:$("#instructor option:selected").val(),roleId:t},h=!1,$("#instructor option:selected").val()=="")return}else{if(t==RoleType.Instructor.value||t=="4"||t==RoleType.TSC.value||t==RoleType.TSAdmin.value){$("#divSite").toggleClass("hide",!1);i=$("#tcId option:selected").val();r=$("#inventoryPool option:selected").val();r==RoleType.TSC.value&&(u=JSON.parse($("#algnTCWithRole").val()),$.each(u,function(n,t){t.ParentEntityId==i&&(r=t.RoleId)}));i>0&&(f=$("#tsid").data("url"),setTimeout(function(){o.loadTrainingsites(f,{tcId:i,roleId:r},window.resources.TextSelectTrainingSite,o)},100));return}$("#divSite").toggleClass("hide",!0);e="";c=n==undefined||n==null||n==""?!1:n;e=$("#tcId option:selected").val();u=JSON.parse($("#algnTCWithRole").val());$.each(u,function(n,i){i.ParentEntityId==e&&i.RoleId==RoleType.TCAdmin.value&&(t=i.RoleId)});s={roleId:t,tcIdInCaseDualRole:e,isInternational:c};$("#instructor").val("")}f=$("#inventoryPool").data("url");this.loadInventory(f,s,h,o)},downloadInventory:function(){var t=$("#DownloadUrl").val();jQuery.get(t,{},function(t){t&&t.length>0?window.location.href="Inventory/GetInstructorInventory":n.showResponseError("inventoryError","errlist",window.resources.TextNoRecords)}).error(function(){n.showResponseError("inventoryError","errlist","error")})},downloadSiteInventory:function(){var i=$("#SiteInvDownloadUrl").val(),r=$("#inventoryPool option:selected").val(),t={tcId:$("#tcId option:selected").val(),roleId:r};jQuery.get(i,t,function(i){i&&i.length>0?window.location.href="Inventory/GetSiteInventory?tcId="+t.tcId+"&roleId="+t.roleId:n.showResponseError("inventoryError","errlist",window.resources.TextNoRecords)}).error(function(){n.showResponseError("inventoryError","errlist","error")})},loadTrainingsites:function(t,i,r,u){var f=[],e=$("#inventoryPool option:selected").val();f.push($("<option/>",{value:"",text:r}));jQuery.get(t,i,function(n){var t=$("#tsid option:selected").val(),i="";t!=undefined&&t!=""&&(i=t);n&&n.length>0&&$.each(n,function(n,t){f.push($("<option/>",{value:t.Id,text:t.Name}))});$("#tsid").empty().append(f);i=$("#tsid option:selected").val();e==4?$("#divSiteDownload").toggleClass("hide",!1):$("#divSiteDownload").toggleClass("hide",!0);var o=$("#inventoryPool").data("url"),s=$("#tcId option:selected").val(),h=$("#inventoryPool option:selected").val(),r={};r={roleId:h,tcIdInCaseDualRole:s,tsId:i};u.loadInventory(o,r,!0,u)}).error(function(){n.showResponseError("inventoryError","errlist",window.resources.TextNoTrainingSitesFound)})},loadInventory:function(t,i,r,u){return jQuery.ajax({url:t,type:"GET",dataType:"html",data:i,success:function(n){var t,i;$("#partial").html(n);t=$(".dataTable").data("inventorysource");$("#divResultsTitle").toggleClass("hide",!0);i=$("#example").DataTable({pageLength:25,order:t==window.RoleType.Distributor.value?[[1,"asc"]]:[[2,"asc"]],columnDefs:[{targets:t==window.RoleType.Distributor.value?[0]:[1],visible:!1},{targets:[-1],visible:!1}]});$(".dataTable tbody").on("click keypress","td.details-control",function(n){u.expand(n,i,r)});$(".expandInnerData").on("click",function(){$(this).prev("td").trigger("click")})},error:function(t){n.showResponseError("inventoryError","errlst",t)}}),!1}}},AppIssueECard=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon,u={init:function(){var n=$('a[data-toggle="collapse"]');n.on("click",function(){n.delay(1e3).hasClass("collapsed")?u.hide(n):u.show(n)})},hide:function(n){n.children(".text").text("Hide Info");n.children(".fa").hasClass("fa-caret-up")?n.children(".fa").removeClass("fa-caret-up").addClass("fa-caret-down"):""},show:function(n){n.children(".text").text("Show Info");n.children(".fa").hasClass("fa-caret-down")?n.children(".fa").removeClass("fa-caret-down").addClass("fa-caret-up"):""}},i,r,t,s=$("#divServiceUrl").data("tc_url"),f=$("#divServiceUrl").data("instructor_url"),h=$("#divServiceUrl").data("ts_url"),c=$("#divServiceUrl").data("quantity_url"),e=$("#divServiceUrl").data("course_url"),o=$("#ddlCourse option:selected").data("productnumber"),l=function(){var a,e,f;$("#assignError").html("");$("#assignError").addClass("hide");var i=[],o=$("#ddlCourse option:selected").val(),u=$("#ddlInventoryPool option:selected").val(),s=$("#ddlTC option:selected").val(),h=$("#ddlTS option:selected").val(),c=$("#ddlInstructor option:selected").val(),r=$("#assignQty").val(),l=parseInt($("#availQty").text());return t=$("#chkUpload")[0].checked,a=$("#dataFile")[0].files,(!o||o<=0)&&(i[i.length]=window.resources.TextCourseRequired),u=="tc"||u=="ts"||u=="tcts"||(i[i.length]=window.resources.TextInventoryPoolRequired),(!s||s<=0)&&(i[i.length]=window.resources.TextTrainingCenterRequired),u=="ts"&&(!h||h<=0)&&(i[i.length]=window.resources.TextTrainingSiteRequiredPleaseReview),l<=0,(!c||c<=0)&&(i[i.length]=window.resources.TextInstructorRequired),r>l&&(i[i.length]=window.resources.TextExceedsInventory),t?a.length==0?i[i.length]=window.resources.TextUploadFileRequired:(e=$("#dataFile")[0].files,f=e[0].name.substr(e[0].name.lastIndexOf(".")+1).toLowerCase(),f!="xls"&&f!="xlsx"&&f!="csv"&&(i[i.length]=window.resources.TextFileShouldBeExcelOrCSV)):r&&r!="0"?(!jQuery.isNumeric(r)||Math.floor(r)!=r||parseInt(r)<=0)&&(i[i.length]=window.resources.TextAssignQtyPositiveInteger):i[i.length]=window.resources.TextAssignQtyRequired,n.showResponseError("assignError","errlist",i)};return{init:function(){var i=this;$("#ddlInventoryPool").on("change",function(n){var t=$(n.target);r=t.val();i.resetAll();$("#ddlTS, #ddlCourse, #ddlTS, #ddlInstructor").val("");(r=="tc"||r=="ts"||r=="tcts")&&i.getData(s,{inventorySrc:r},"#ddlTC","#divTC",window.resources.SelectTrainingCenter)});$("#ddlTC").on("change",function(n){var r=$(n.target).val(),t;$("#assignError").toggleClass("hide",!0);$("#ddlCourse, #ddlTS, #ddlInstructor").val("");$("#divCourse").toggleClass("hide",!0);$("#divInstructor").toggleClass("hide",!0);$("#divTS").toggleClass("hide",!0);$("#divBox").toggleClass("hide",!0);$("#divSubmit").toggleClass("hide",!0);r>0&&(t=$("#ddlInventoryPool option:selected").val(),t=="tc"?i.getData(e,{orgId:r,inventorySrc:t},"#ddlCourse","#divCourse",window.resources.SelectCourse):(t=="ts"||t=="tcts")&&i.getData(h,{tcId:r,inventorySrc:t},"#ddlTS","#divTS",window.resources.TextSelectTrainingSite))});$("#ddlTS").on("change",function(n){var t=$(n.target).val(),r;$("#assignError").toggleClass("hide",!0);$("#ddlCourse, #ddlInstructor").val("");$("#divCourse").toggleClass("hide",!0);$("#divInstructor").toggleClass("hide",!0);$("#divBox").toggleClass("hide",!0);$("#divSubmit").toggleClass("hide",!0);t>0&&(r=$("#ddlInventoryPool option:selected").val(),i.getData(e,{orgId:t,inventorySrc:r},"#ddlCourse","#divCourse",window.resources.SelectCourse))});$("#ddlCourse").on("change",function(){var s=$("#ddlCourse option:selected"),r,e,n,t,u;if(courseId=$("#ddlCourse option:selected").val(),$("#assignError").toggleClass("hide",!0),$("#ddlInstructor").val(""),$("#divInstructor").toggleClass("hide",!0),$("#divBox").toggleClass("hide",!0),$("#divSubmit").toggleClass("hide",!0),courseId>0){if(r=$("#ddlTC option:selected").val(),o=$("#ddlCourse option:selected").data("productnumber"),e=$("#ddlInventoryPool").val()=="tc",o=="20-2819-12"&&e==1){if($("#divCardType").toggleClass("hide",!1),$("#ddlCardType").val()!="new")return}else $("#ddlCardType").val(""),$("#divCardType").toggleClass("hide",!0),$("#divReplace").toggleClass("hide",!0);n=s.data("parentid");(n=="0"||n=="")&&(n=courseId);t=$("#ddlInventoryPool option:selected").val();t=="tc"?(i.getAvailableQty(n,t,r,0),i.getData(f,{tcId:r,courseId:courseId},"#ddlInstructor","#divInstructor",window.resources.SelectInstructor)):(t=="ts"||t=="tcts")&&(u=$("#ddlTS option:selected").val(),i.getAvailableQty(n,t,r,u),i.getData(f,{tcId:r,tsId:u,courseId:courseId},"#ddlInstructor","#divInstructor",window.resources.SelectInstructor))}});$("#ddlCardType").on("change",function(){var n=$("#ddlCardType option:selected").val();$("#divInventoryPool").toggleClass("hide",!0);n=$("#ddlCardType option:selected").val();n=="new"&&($("#divReplace").toggleClass("hide",!0),$("#ddlCourse").trigger("change"));n=="replacement"&&($("#divReplace").toggleClass("hide",!1),$("#divInstructor").toggleClass("hide",!0),$("#divSubmit").toggleClass("hide",!0),$("#divBox").toggleClass("hide",!0))});$("#btnSearchReplace").on("click",function(){var r=$("#ddlCardType option:selected").val(),t;if(r||(t=[],t[t.length]=window.resources.SelectCardType,n.showResponseError("assignError","errlist",t)),r=="replacement"){var u=$("#ddlCardType").data("view"),f=$("#ddlCardType").data("replaceurl"),e=$("#ddlCourse option:selected").val();return i.submit(f,{courseID:e},this.render,"",u),!1}});$("#ddlInstructor").on("change",function(){$("#assignError").toggleClass("hide",!0);$("#divSubmit").toggleClass("hide",!1)});$("#chkUpload").on("change",function(n){t=$(n.target)[0].checked;t?($("#divUpload").toggleClass("hide",!1),$("#assignQty").val(""),window.studentAssignmentViewModel.AssignedQty="",$("#assignQty").attr("disabled","disabled")):($("#divUpload").toggleClass("hide",!0),$("#assignQty").removeAttr("disabled"))})},initMultiSelect:function(){$(".bootstrapmultiselect").multiselect({buttonWidth:"100%",disableIfEmpty:!1,includeSelectAllOption:!0,selectAllText:window.resources.TextSelectAll,allSelectedText:window.resources.TextAllSelected,nonSelectedText:window.resources.SelectCourseModules,nSelectedText:" "+window.resources.TextSelectedModules})},resetAll:function(){$("#assignError").toggleClass("hide",!0);$("#divTC").toggleClass("hide",!0);$("#divTS").toggleClass("hide",!0);$("#divCourse").toggleClass("hide",!0);$("#divInstructor").toggleClass("hide",!0);$("#divBox").toggleClass("hide",!0);$("#divSubmit").toggleClass("hide",!0)},getData:function(t,i,r,u,f){jQuery.get(t,i,function(n){var t=[];t.push($("<option/>",{value:"",text:f}));n&&n.length>0&&$.each(n,function(n,i){r!=="#ddlCourse"?t.push($("<option/>",{value:i.Id,text:i.Name})):t.push($("<option/>",{value:i.Id,text:i.Name,"data-parentid":i.ParentCourseId,"data-productnumber":i.ProductNumber,"data-module":i.HasModule,"data-subcourse":i.HasSubCourse}))});$(r).empty().append(t).val("");$(r).toggleClass("hide",!1);$(u).toggleClass("hide",!1)}).error(function(t){var i=[];i.push($("<option/>",{value:"",text:f}));$(r).empty().append(i).val("");n.showResponseError("assignError","errlist",t)})},getAvailableQty:function(t,i,r,u){$("#divBox").toggleClass("hide",!0);jQuery.get(c,{courseId:t,inventorySrc:i,tcId:r,tsId:u},function(n){n&&($("#divBox").toggleClass("hide",!1),$("#availQty").text(n))}).error(function(t){n.showResponseError("assignError","errlist",t)})},validateEmail:function(n){return $.trim(n).match(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/igm)?!0:!1},validateStudent:function(){var c=this,i,r,u,f,e,o,h,s,t=[];return($("#tblStudent").find("tr").each(function(n){var t,l,a,v,h;n!=0&&(t=$(this).find("input"),l=$(this).find("select"),$(t[1]).toggleClass("errorhighlight",!1),$(t[2]).toggleClass("errorhighlight",!1),$(t[3]).toggleClass("errorhighlight",!1),$(t[4]).toggleClass("errorhighlight",!1),$(t[5]).toggleClass("errorhighlight",!1),$(l[0]).toggleClass("errorhighlight",!1),t[1].value==""?($(t[1]).toggleClass("errorhighlight",!0),i=window.resources.TextCourseDateRequired):(a=new Date,v=new Date(t[1].value),v>a&&(o=window.resources.TextCourseDateRange)),t[2].value.trim()||($(t[2]).toggleClass("errorhighlight",!0),r=window.resources.TextFirstNameRequired),t[3].value.trim()||($(t[3]).toggleClass("errorhighlight",!0),u=window.resources.TextLastNameRequired),t[4].value.trim()?c.validateEmail(t[4].value)||(e=window.resources.TextInvalidEmail,$(t[4]).toggleClass("errorhighlight",!0)):($(t[4]).toggleClass("errorhighlight",!0),f=window.resources.TextEmailRequired),h=$(l[1]),window.studentAssignmentViewModel.HasSubCourse==1&&h.length>0&&(!h.val()||h.val().length===0)&&(h.toggleClass("errorhighlight",!0),s=window.resources.TextCourseTypeRequired))}),i&&(t[t.length]=i),r&&(t[t.length]=r),u&&(t[t.length]=u),f&&(t[t.length]=f),o&&(t[t.length]=o),e&&(t[t.length]=e),h&&(t[t.length]=h),s&&(t[t.length]=s),n.showResponseError("assignErrorstep2","errlist",t),t.length==0)?!0:!1},highlightDuplicateRows:function(){i=!1;var t={},r=function(){return $.trim($(this).text())};$("#tblConfirm").find("tr").each(function(){var n=$(this).find(".duplicate-student").map(r).toArray().join("|");t.hasOwnProperty(n)?t[n].push(this):t[n]=[this]});$.each(t,function(n,t){t.length>1&&$.each(t,function(n,t){t.style.backgroundColor="#ebccd1";i=!0})});i&&($("#assignErrorstep3").toggleClass("hide",!1),n.showWarning("assignErrorstep3","errlist1",window.resources.TextDuplicateStudents))},assignModel:function(n){var i,r,f,u;if(window.studentAssignmentViewModel.CourseName="",window.studentAssignmentViewModel.TCName="",window.studentAssignmentViewModel.InstructorName="",window.studentAssignmentViewModel.TrainingSiteName="",window.studentAssignmentViewModel.CourseId=$("#ddlCourse option:selected").val(),window.studentAssignmentViewModel.CourseId&&(window.studentAssignmentViewModel.CourseName=$("#ddlCourse option:selected").text()),window.studentAssignmentViewModel.ParentCourseId=$("#ddlCourse option:selected").data("parentid"),(window.studentAssignmentViewModel.ParentCourseId=="0"||window.studentAssignmentViewModel.ParentCourseId=="")&&(window.studentAssignmentViewModel.ParentCourseId=window.studentAssignmentViewModel.CourseId),window.studentAssignmentViewModel.SubCourseId=$("#ddlSubCourse option:selected").val(),window.studentAssignmentViewModel.SubCourseId&&(window.studentAssignmentViewModel.SubCourseName=$("#ddlSubCourse option:selected").text()),window.studentAssignmentViewModel.TCId=$("#ddlTC option:selected").val(),window.studentAssignmentViewModel.InstructorId=$("#ddlInstructor option:selected").val(),window.studentAssignmentViewModel.InstructorId&&$("#hdnInstrName").val($("#ddlInstructor option:selected").text()),window.studentAssignmentViewModel.TrainingSiteId=$("#ddlTS option:selected").val(),window.studentAssignmentViewModel.AvailableQty=parseInt($("#availQty").text()),window.studentAssignmentViewModel.HasModule=$("#ddlCourse option:selected").data("module"),window.studentAssignmentViewModel.HasSubCourse=$("#ddlCourse")[0].options[$("#ddlCourse")[0].selectedIndex].getAttribute("data-subcourse"),window.studentAssignmentViewModel.InventorySource=$("#ddlInventoryPool option:selected").val(),window.studentAssignmentViewModel.IsUpload=t,i=[],$("#tblStudent").find("tr").each(function(n){if(n!=0){var t=$(this).find("input"),r=$(this).find("select");i.push({CourseDate:t[1].value,FirstName:t[2].value.trim(),LastName:t[3].value.trim(),Email:t[4].value.trim(),CourseModuleName:studentAssignmentViewModel.HasModule==1?r.find(":selected").map(function(n,t){return t.text}).get().join(", "):"",CourseModuleId:studentAssignmentViewModel.HasModule==1?r.find(":selected").map(function(n,t){return t.value}).get().join(","):"",SubCourseId:studentAssignmentViewModel.HasSubCourse==1?r.find(":selected").map(function(n,t){return t.value}).get().join(","):null,SubCourse:studentAssignmentViewModel.HasSubCourse==1?r.find(":selected").map(function(n,t){return t.text}).get().join(","):""})}}),r=new FormData,t)for(f=$("#dataFile")[0].files,u=0;u<f.length;u++)r.append("file",f[u]);return n=="btnMoveNext"?window.studentAssignmentViewModel.AssignedQty=t?0:$("#assignQty").val():(window.studentAssignmentViewModel.AssignedQty=i.length,window.studentAssignmentViewModel.StudentList=i),$("#divAssignQty").text(i.length),r.append("model",JSON.stringify(window.studentAssignmentViewModel)),r},moveNext:function(n){var t=$(n).data("view"),r,u;return(t=="#completeAssignCards"&&$(n).prop("disabled",!0),r=this.assignModel(n.id),t!=="#searchreplacement"&&!l())?(t=="#completeAssignCards"&&$(n).prop("disabled",!1),!1):(u=$(n).data("url"),n.id=="btnFinish"&&i&&!confirm(window.resources.TextDuplicateAlert))?!1:(this.submit(u,r,this.render,"",t),!1)},movePrevious:function(n){this.hideAll();$(n).toggleClass("hide",!1);$("#assignErrorstep2").toggleClass("hide",!0);$("#assignErrorstep3").toggleClass("hide",!0)},submit:function(t,i,r,u,f){var o=this,e;if(f!="#studentAssignment"&&!o.validateStudent())return f=="#completeAssignCards"&&$("#btnFinish").prop("disabled",!1),!1;e="assignError";f=="#confirmAssignCards"&&(e="assignErrorstep2");f=="#completeAssignCards"&&(e="assignErrorstep3");f=="#studentAssignment"?jQuery.ajax({url:t,type:"POST",contentType:!1,processData:!1,data:i,dataType:"html",success:function(n){o.render(n,f)},error:function(t){n.showResponseError(e,"errlist",t)}}):jQuery.post(t,window.studentAssignmentViewModel,function(n){o.render(n,f)}).fail(function(t){n.showResponseError(e,"errlist",t)}).always(function(){f=="#completeAssignCards"&&$("#btnFinish").prop("disabled",!1)})},render:function(t,i){var r=this,f,e;if(t&&($(i).html(t),n.initDatePicker(!0),i=="#studentAssignment"&&(r.initMultiSelect(),$("#moduleHelp").toggleClass("hide",window.studentAssignmentViewModel.HasModule!=1),$("#tdAssignTCName").html($("#ddlTC option:selected").text()),$("#tdAssignTSName").html($("#ddlTS option:selected").text())),$("[id*='tdInstrNameP']").html($("#hdnInstrName").val()),$('[data-toggle="popover"]').popover()),i=="#confirmAssignCards"){if(!r.validateStudent())return!1;r.highlightDuplicateRows();$("#tblConfirm").DataTable({pageLength:25});$("#tdConfirmTCName").html($("#ddlTC option:selected").text());$("#tdConfirmTSName").html($("#ddlTS option:selected").text())}r.assignModel();$("#divAssignQty").text(window.studentAssignmentViewModel.AssignedQty);r.hideAll();$(i).toggleClass("hide",!1);u.init();i=="#completeAssignCards"&&($("#tdCompTCName").html($("#ddlTC option:selected").text()),$("#tdCompTSName").html($("#ddlTS option:selected").text()),f=$("#tblEcard").DataTable({pageLength:25}),f.context.length>0&&(e=new $.fn.dataTable.Buttons(f,{buttons:[{extend:"excelHtml5",title:n.getFileName("Assigned eCards")}]}),$("#exportStudent").prepend(e.container()).find("a.dt-button").addClass("btn btn-primary").text(window.resources.TextDownload),e.container().css("display","inline-block"),$(".lnkecard").click($.proxy(r.loadECards,r))))},hideAll:function(){$("#index").toggleClass("hide",!0);$("#studentAssignment").toggleClass("hide",!0);$("#confirmAssignCards").toggleClass("hide",!0);$("#completeAssignCards").toggleClass("hide",!0)},remove:function(t){var r,u,i;return $("#tblStudent").find("tr").length>2?(r=$(t).closest("tr"),r.remove(),u=$("#tblConfirm").DataTable(),u.row(r).remove().draw(!1),i=$("#tblStudent").find("tr").length-1,window.studentAssignmentViewModel.AssignedQty=i,$("#divAssignQty").text(i),$("#assignQty").val(i)):n.showResponseError("assignErrorstep2","errlist2",window.resources.TextAtLeastOneStudentRequired),!1},removeConfirm:function(t){var u,f,e,r;return $("#tblConfirm").find("tr").length>2?(u=$(t).closest("tr"),u.remove(),f=$("#tblStudent").DataTable(),f.row(u).remove().draw(!1),e=$("#tblConfirm").find("tr"),r=e.length-1,window.studentAssignmentViewModel.AssignedQty=r,$("#tdAssignQty, #divAssignQty").html(r),$("#assignQty").val(r),r==1&&(i=!1)):n.showResponseError("assignErrorstep3","errlist3",window.resources.TextAtLeastOneStudentRequired),!1},selectAll:function(n){$("#tblStudent").find("input:checkbox").each(function(){this.checked=n.checked})},updateSubCourse:function(n){var t=$(n).val();$("#tblStudent").find("tr").each(function(n){if(n!=0){var i=$(this).find("select");i.val(t)}})},updateDate:function(n){var t=$(n).val();$("#tblStudent").find("tr").each(function(n){if(n!=0){var i=$(this).find("input");$(i[1]).datepicker("setDate",t)}})},updateModule:function(n){var t=$(n).val();$("#tblStudent").find("tr").each(function(n){if(n!=0){var i=$(this).find("select");i.val(t);i.multiselect("refresh")}})},validateSearch:function(){var t=[],u=$("#tcId option:selected").val(),i=$("#firstname").val(),r=$("#lastname").val(),f=$("#email").val(),e=$("#ecode").val();return i||r||f||e?(i&&!r&&(t[t.length]=window.resources.TextEnterLastName),u||(t[t.length]=window.resources.TextTrainingCenterRequired)):t[t.length]=window.resources.TextAtleastOneValue,n.showResponseError("assignError1","errlist1",t)},loadInitialResult:function(t){var r=this,u=$("#hdnSearchUrl").val(),i;if($("#divAlert").toggleClass("hide",t),$("#assignError1").toggleClass("hide",!0),window.studentAssignmentViewModel.StudentECardInfo={},!this.validateSearch())return!1;window.studentAssignmentViewModel.CourseId=$("#hdnCourseId").val();window.studentAssignmentViewModel.TCId=$("#tcId option:selected").val();window.studentAssignmentViewModel.StudentECardInfo.FirstName=$("#firstname").val();window.studentAssignmentViewModel.StudentECardInfo.LastName=$("#lastname").val();window.studentAssignmentViewModel.StudentECardInfo.Email=$("#email").val();window.studentAssignmentViewModel.StudentECardInfo.CertificateId=$("#ecode").val();i="#divSearchResult";jQuery.post(u,{model:window.studentAssignmentViewModel,__RequestVerificationToken:$("input[name=__RequestVerificationToken]").val()},function(n){r.render(n,i)}).fail(function(t){n.showResponseError("assignError1","errlist",t)}).always(function(){i=="#completeAssignCards"&&$("#btnFinish").prop("disabled",!1)})},searcheCards:function(n){n.preventDefault();var t=this;t.loadInitialResult(!n.canShowMsg)},issueReplacementCard:function(n){n.preventDefault();$("#divEditError, #divEditAlert").toggleClass("hide",!0);var t=this;$("#confirmReplacementeCardModal").modal("show");$("#divModelBody").html(window.resources.TextConfirmReplaceCard);$("#confirmReplacementeCardModal").modal("show");$("#btnReplaceCardOk").off("click");$("#btnReplaceCardOk").on("click",function(){t.saveReplacementCard(n)})},saveReplacementCard:function(t){t.preventDefault();$("#confirmReplacementeCardModal").modal("hide");var r=this,i=$(t.target),u=i.data("url"),f=i.data("eid"),e=i.data("tcid"),o=$("#tcId option:selected").text(),s=$("input[name=__RequestVerificationToken]").val(),h={eCardGuid:f,tcid:e,courseMoudules:"",TCName:o,__RequestVerificationToken:s};jQuery.post(u,h,function(n){var t="#completeReplacement";$(t).toggleClass("hide",!1);r.render(n,t);$("#searchreplacement").toggleClass("hide",!0)}).fail(function(t){n.showResponseError("assignError1","errlist",t)})},clearSearch:function(t){t.preventDefault();var i=this;$("#divSearchError").toggleClass("hide",!0);$("#firstname").val("");$("#lastname").val("");$("#email").val("");$("#ecode").val("");$("#tcId").val("");n.focusMessage()}}},AppOptInReport=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon,t=function(){$("#reportError").html("");$("#reportError").addClass("hide");var i=$("#reportForm").find('input[id="StartDate"]').val(),r=$("#reportForm").find('input[id="EndDate"]').val(),t=[];return(i===""&&r!=""&&(t[t.length]=window.resources.TextStartDateRequired),r===""&&i!=""&&(t[t.length]=window.resources.TextEndDateRequired),t.length>0)?(n.showResponseError("reportError","errlist",t),!1):!0};return{init:function(){var n=this;$(document).ready(function(){$("#ddlReports option:contains(Opt-In Report)").attr("selected",!0)})},btnReport_Click:function(){var f=this,e=$("#btnReport").data("url"),n=$("#reportForm").find('input[id="StartDate"]').val(),i=$("#reportForm").find('input[id="EndDate"]').val(),r=$("#ddlCourse option:selected").val(),u=$("#ddlType option:selected").val(),o={CourseId:r,startdate:n,enddate:i,type:u};t()&&f.loadReport(e,n,i,r,u)},loadReport:function(t,i,r,u,f){jQuery.ajax({url:t,type:"GET",dataType:"html",data:{CourseId:u,startdate:i,enddate:r,type:f},success:function(n){$("#reportData").html(n);var t=$("#example").DataTable({pageLength:25,order:[[0,"asc"]]})},error:function(t){n.showResponseError("assignError","errlist",t)}})},btnDownload_Click:function(t){t.preventDefault();var l=this,h=$("#btnDownload").data("url"),i=$(t.target),r=$("#reportForm").find('input[id="StartDate"]').val(),u=$("#reportForm").find('input[id="EndDate"]').val(),f=$("#ddlCourse option:selected").val(),e=$("#ddlType option:selected").val(),o=i.data("startindex"),s=i.data("endindex"),c={CourseId:f,startdate:r,enddate:u,type:e,startIndex:o,endIndex:s};jQuery.get(h,c,function(t){t&&t.length>0?window.location.href="OptInReport/DownloadReport?CourseId="+f+"&startdate="+r+"&enddate="+u+"&type="+e+"&startIndex="+o+"&endIndex="+s:n.showResponseError("reportError","errlist",window.resources.TextNoRecords)}).error(function(){n.showResponseError("reportError","errlist","error")})}}},AppSearchAllECards=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon;return{init:function(){var n=this;if($(document).ready(function(){$("#resendEmailModal").on("shown.bs.modal",n.focusResend);$("#resendSMSModal").on("shown.bs.modal",n.focusResend);$("#sendSecurityAnsModal").on("shown.bs.modal",n.focusResend);$("#tcDetailModal").on("shown.bs.modal",n.focusResend);$("#confirmClaimeCardModal").on("shown.bs.modal",n.focusResend);$("#confirmUpdateEcardModal").on("shown.bs.modal",n.focusResend);$("#hdnIsAdmin").val()==1&&$("#divSearchBox").toggleClass("hide",!1);setTimeout(function(){$("#profileId").trigger("change")},500)}),n.initMultiSelect(),$("#divInstType").length>0){$("input[id=radActive]:radio").prop("checked",!0);$("input[type=radio][name=instType]").on("change",function(t){n.toggleInstrStatus(t)})}$("#profileId").on("change",function(){var t=JSON.parse($("#algnTCWithRole").val()),i=$("#profileId option:selected").val(),n=[];n.push($("<option/>",{value:"",text:window.resources.SelectTrainingCenter}));$.each(t,function(t,r){r.RoleId==i&&n.push($("<option/>",{value:r.EntityId,text:r.EntityName,"data-isprintonly":r.IsPrintOnly}))});$("#ddlTC").empty().append(n).val("");$("#divSearchResult").toggleClass("hide",!0);$("#divSite").toggleClass("hide",!0);$("#divSearchBox").toggleClass("hide",!0)});$("#ddlTC").on("change",function(){var u=$("#ddlTC").data("url"),f=$("#ddlTC").data("instrurl"),e={},i=$("#ddlTC option:selected").val(),t=$("#profileId option:selected").val(),r;if(t!=""&&i!=""){if(t==RoleType.Instructor.value?$("#divInst").addClass("hide"):$("#divInst").removeClass("hide"),$("#statusErr").toggleClass("hide",!0),$("#divSearchResult").toggleClass("hide",!0),$("#ddlTS").val(""),t==RoleType.TSC.value||t==RoleType.TSAdmin.value||(r={orgId:i,orgType:"tc",isActiveInstructor:!0},$("#instructor").empty().val(""),n.renderSource(f,r,"#instructor",window.resources.TextSelectInstructor,n)),t==RoleType.TSC.value||t==RoleType.TSAdmin.value||t==RoleType.EcardAdmin.value||t==RoleType.Instructor.value){if(i>0){var s=t==RoleType.EcardAdmin.value,h=t==RoleType.Instructor.value&&$("#hdnIsIntlAlignment").val()==0,e={tcId:i,roleId:t},u=$("#ddlTC").data("tsurl"),o=window.resources.TextSelectTrainingSite;n.renderSource(u,e,"#ddlTS",o,n);$("#divSite").toggleClass("hide",!1);$("#spanTsAstrkRequire").toggleClass("hide",t==RoleType.Instructor.value);t==RoleType.Instructor.value?$("#divSearchBox").toggleClass("hide",!1):$("#divSearchBox").toggleClass("hide",!0)}return}$("#divSite").toggleClass("hide",!0);$("input[id=radActive]:radio").prop("checked",!0);$("#divSearchBox").toggleClass("hide",!1)}});$("#ddlTS").on("change",function(){var f=$("#ddlTS").data("url"),u=$("#ddlTC").data("instrurl"),i=$("#ddlTS option:selected").val(),t=$("#profileId option:selected").val(),r;t!=""&&i!=""&&($("#divSearchBox").toggleClass("hide",!1),$("#divSearchResult").toggleClass("hide",!0),$("#statusErr").toggleClass("hide",!0),$("input[id=radActive]:radio").prop("checked",!0),t==RoleType.EcardAdmin.value||t==RoleType.Instructor.value&&$("#hdnIsIntlAlignment").val()==0||(r={orgId:i,orgType:"ts",isActiveInstructor:!0},$("#instructor").empty().val(""),n.renderSource(u,r,"#instructor",window.resources.TextSelectInstructor,n)),t==RoleType.Instructor.value?$("#divInst").addClass("hide"):$("#divInst").removeClass("hide"))})},toggleInstrStatus:function(n){var u=this,o=$(n.target),s=o.val(),r;$("#statusErr").toggleClass("hide",!0);var f=$("#ddlTC option:selected").val(),e=$("#profileId option:selected").val(),t=s==="act"?!0:!1,h=$("#hdnGetInstrUrl").val(),i={};e==RoleType.TSC.value||e==RoleType.TSAdmin.value?(r=$("#ddlTS option:selected").val(),i=r==""?{orgId:f,orgType:"tc",isActiveInstructor:t}:{orgId:r,orgType:"ts",isActiveInstructor:t}):i={orgId:f,orgType:"tc",isActiveInstructor:t};$("#instructor").empty().val("");u.renderSource(h,i,"#instructor",window.resources.TextSelectInstructor,u)},initMultiSelect:function(){$("#course").multiselect({buttonWidth:"100%",disableIfEmpty:!1,includeSelectAllOption:!1,selectAllText:window.resources.TextSelectAll,allSelectedText:window.resources.TextAllSelected,nonSelectedText:window.resources.SelectCourses,nSelectedText:" "+window.resources.TextSelectedCourses})},callAPI:function(n,t,i,r,u){n==="get"?$.get(t,i,r).error(function(n){u(n)}):$.post(t,i,r).error(function(n){u(n)})},renderSource:function(t,i,r,u){var f=[];r!="#courseId"&&f.push($("<option/>",{value:"",text:u}));jQuery.get(t,i?i:null,function(n){n&&n.length>0&&$.each(n,function(n,t){f.push($("<option/>",{value:t.Id,"data-isparent":t.HasChild,text:t.Name}))});r=="#courseId"?$("#courseId").empty().append(f).multiselect("rebuild").val(""):$(r).empty().append(f).val("")}).error(function(t){$(r).empty().append(f).val("");n.showResponseError("statusErr","errlist",t)})},validateEmail:function(n){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/igm.test(n)},onLoadInstrSuccess:function(n){var t=[];t.push($("<option/>",{value:"",text:window.resources.TextSelectInstructor}));n&&n.length>0&&$.each(n,function(n,i){t.push($("<option/>",{value:i.UserId,text:i.InstructorWithId}))});$("#instructor").empty().append(t).val("")},onLoadInstrFail:function(t){var i=[];i.push($("<option/>",{value:"",text:window.resources.TextSelectInstructor}));$("#ddlInstructor").empty().append(i).val("");n.showResponseError("statusErr","errlist",t)},focusResend:function(n){var t=$(this),r,i;t.find("#studentemail").focus();t.find("#btnResendSMS").focus();t.find("#btnSendSecurityAns").focus();t.find("#btnCloseTC").focus();r=$(n.target);i=r.attr("id");i=="resendEmailModal"?$("#alertSuccess").text(window.resources.TextResentSuccessfully):i=="resendSMSModal"?$("#alertSuccess").text(window.resources.TextResentSuccessfully):i=="sendSecurityAnsModal"&&$("#alertSuccess").text(window.resources.TextSentSecAnswerSuccessfully)},validateSearch:function(){var t=[],h,f,c,i,w;window.searchCardModel.CourseDate="";var e=window.searchCardModel.FirstName=$("#firstname").val(),o=window.searchCardModel.LastName=$("#lastname").val(),l=window.searchCardModel.Email=$("#email").val(),a=window.searchCardModel.ECardCode=$("#ecode").val(),r=$("#courseFromDate").val(),u=$("#courseToDate").val(),v=window.searchCardModel.EStatus=$("#estatus option:selected").val(),s=$("#course").multiselect("getSelected").val(),y=window.searchCardModel.CourseIds=s?s.join(","):"",p=window.searchCardModel.InstructorId=$("#instructor option:selected").val();return $("#hdnIsAdmin").val()==0&&(i=$("#profileId option:selected").val(),w=$("#hdnIsIntlAlignment").val(),h=window.searchCardModel.TCId=$("#ddlTC").val(),window.searchCardModel.SelectRoleId=i,window.searchCardModel.TSId="",window.searchCardModel.LocationId="",(i==RoleType.TSC.value||i==RoleType.TSAdmin.value||i==RoleType.Instructor.value)&&(f=window.searchCardModel.TSId=$("#ddlTS").val())),e||o||l||a||v||y||p||r&&u?(e&&!o&&(t[t.length]=window.resources.TextEnterLastName),(r||u)&&!n.isValidDate(r,u)&&(t[t.length]=n.getDateFormatError(window.resources.CourseDate)),i!=RoleType.TSC.value&&i!=RoleType.TSAdmin.value||f||(t[t.length]=window.resources.TextSelectTrainingSite),i!=RoleType.EcardAdmin.value||c||(t[t.length]=window.resources.TextSelectTrainingSite)):t[t.length]=window.resources.TextAtleastOneValue,n.showResponseError("statusErr","errlist",t)},loadInitialResult:function(n){var t=this,r=$("#hdnSearchUrl").val(),i;if($("#divAlert").toggleClass("hide",n),$("#statusErr").toggleClass("hide",!0),!this.validateSearch())return window.searchCardModel.StartDate="",window.searchCardModel.EndDate="",!1;window.searchCardModel.StartDate=$("#courseFromDate").val();window.searchCardModel.EndDate=$("#courseToDate").val();window.searchCardModel.CourseDate="";window.searchCardModel.IssueDate="";i=window.searchCardModel;t.callAPI("post",r,i,t.onLoadResult,t.onFailSearch)},searcheCards:function(n){n.preventDefault();var t=this;t.loadInitialResult(!n.canShowMsg)},onLoadResult:function(t){$("#divSearchResult").toggleClass("hide",!1).html(t);$("#example").DataTable();$("[data-blocked]").closest("tr").addClass("blockedInRed");$("#divAlert").is(":visible")?n.focusMessage():$("html, body").animate({scrollTop:$("#titleResults").offset().top-55},1e3)},onFailSearch:function(t){n.showResponseError("statusErr","errlist",t)},clearSearch:function(t){t.preventDefault();var i=this;$("#statusErr").html("");$("#statusErr").toggleClass("hide",!0);$("#firstname").val("");$("#lastname").val("");$("#email").val("");$("#ecode").val("");$("#estatus").val("");$("#course").multiselect("deselectAll",!1);$("#course").multiselect("updateButtonText");$("#instructor").val("");$("#courseToDate").datepicker("setDate","");$("#courseFromDate").datepicker("setDate","");$("#divSearchResult").html("");$("#divEditCard").html("");$("#divAlert").toggleClass("hide",!0);window.searchCardModel={};n.focusMessage()},action_Click:function(n){var i,t,r;if(n.preventDefault(),i=this,$("#divAlert").toggleClass("hide",!0),$("#resendEmailModal").modal("hide"),$("#resendSMSModal").modal("hide"),$("#sendSecurityAnsModal").modal("hide"),$("#resendEmailError").toggleClass("hide",!0),$("#resendSMSError").toggleClass("hide",!0),$("#sendSecurityAnsError").toggleClass("hide",!0),$("#lnkSaveResendEmail").toggleClass("hide",!1),t=$(n.target),r={ECardUId:t.data("eid"),StudentId:t.data("stuid"),EmailAddress:t.data("email"),Url:t.data("url"),MobilePhone:t.data("mobilephone"),FirstName:t.data("firstname"),LastName:t.data("lastname"),ECardUId:t.data("eid"),Action:t.data("action"),CanSaveEmail:!1,CanSavePhone:!1,Status:t.data("status")},t.data("action")=="email"||t.data("action")=="claimemail"){t.data("coursetype")==4&&$("#lnkSaveResendEmail").toggleClass("hide",!0);$("#resendEmailModal").modal("show");$("#btnResend").off("click");$("#lnkSaveResendEmail").off("click");$("#btnResend").on("click",r,$.proxy(i.validateReSendEmail,i));$("#lnkSaveResendEmail").on("click",r,$.proxy(i.validateReSendEmail,i));$("#studentemail").val(r.EmailAddress)}else if(t.data("action")=="sms"){$("#resendSMSModal").modal("show");$("#btnResendSMS").off("click");$("#btnResendSMS").on("click",r,$.proxy(i.validateReSendSMS,i));$("#studentphone").val(r.MobilePhone)}else if(t.data("action")=="securityAnswer"){$("#sendSecurityAnsModal").modal("show");$("#btnSendSecurityAns").off("click");$("#btnSendSecurityAns").on("click",r,$.proxy(i.validateSendSecurityAns,i));$("#studentSecurityEmail").val(r.EmailAddress)}t.data("action")=="claimemail"&&$("#lnkSaveResendEmail").toggleClass("hide",!0)},validateSendSecurityAns:function(t){var i,f;t.preventDefault();var u=this,r=t.data,e=$(t.target);if(r.EmailAddress=$("#studentSecurityEmail").val(),$("#sendSecurityAnsError").toggleClass("hide",!0),i=[],r.EmailAddress||(i[i.length]=window.resources.TextEmailRequired),r.EmailAddress&&!u.validateEmail(r.EmailAddress)&&(i[i.length]=window.resources.TextInvalidEmail),i.length>0)return n.showResponseError("sendSecurityAnsError","emailErr",i);f=r.Url;u.callAPI("post",f,r,u.onSuccess,u.onFail)},validateReSendEmail:function(t){var r,f;t.preventDefault();var u=this,i=t.data,e=$(t.target);if(e[0].id=="lnkSaveResendEmail"&&(i.CanSaveEmail=!0),i.EmailAddress=$("#studentemail").val(),$("#resendEmailError").toggleClass("hide",!0),r=[],i.EmailAddress||(r[r.length]=window.resources.TextEmailRequired),i.EmailAddress&&!u.validateEmail(i.EmailAddress)&&(r[r.length]=window.resources.TextInvalidEmail),r.length>0)return n.showResponseError("resendEmailError","emailErr",r);f=i.Url;u.callAPI("post",f,i,u.onSuccess,u.onFail)},validateReSendSMS:function(t){var i,f;t.preventDefault();var r=this,u=t.data,e=$(t.target);if($("#resendSMSError").toggleClass("hide",!0),i=[],u.MobilePhone||(i[i.length]=window.resources.TextMobileNumberRequired),i.length>0)return n.showResponseError("resendSMSError","emailErr",i);f=u.Url;r.callAPI("post",f,u,r.onSuccess,r.onFail)},onSuccess:function(n){n&&($("#resendEmailModal").modal("hide"),$("#resendSMSModal").modal("hide"),$("#sendSecurityAnsModal").modal("hide"),$("#divAlert").toggleClass("hide",!1),$("#btnSearchCards").trigger({type:"click",canShowMsg:!0}))},onFail:function(t){n.showResponseError("resendError","emailErr",t)},editECard:function(n){n.preventDefault();$("#divEditError").toggleClass("hide",!0);$("#divEditAlert").toggleClass("hide",!0);var t=this,i=$(n.target.parentElement),r=i.data("url"),u={eCardGuid:i.data("eid"),isInstructorCard:i.data("isinstsrc")};t.callAPI("post",r,u,$.proxy(t.onLoadingEditCard,t),t.onFailSearch)},onLoadingEditCard:function(t){var i=this;if(t&&t.length>0&&($("#divSearch").toggleClass("hide",!0),$("#divEditCard").toggleClass("hide",!1).html(t),n.initDatePicker(!0),n.focusMessage(),$("#blockeCard").length>0)){$("#blockeCard").off("change");$("#blockeCard").on("change",i.changeStatus);$("#notes").prop("disabled",!$("#blockeCard").is(":checked"))}},changeStatus:function(){this.checked?$("#notes").prop("disabled",!1):$("#notes").val("").prop("disabled","disabled")},validateEdit:function(){var e=this,t=[],o=window.searchCardModel.FirstName=$("#fname").val(),s=window.searchCardModel.LastName=$("#lname").val(),i=window.searchCardModel.Email=$("#emailaddress").val(),u,r,f;return window.searchCardModel.Phone=$("#phone").val(),window.searchCardModel.InstructorStudentId=$("#instructorStudentId").val(),window.searchCardModel.ECardUId=$("#hdnEUId").val(),window.searchCardModel.SubCourseId=$("#subCourse option:selected").val(),u=window.searchCardModel.CourseDate=$("#courseDate").val(),$("#blockeCard").length>0&&(r=$("#blockeCard").is(":checked"),window.searchCardModel.EStatus=r?$("#blockeCard").val():0,window.searchCardModel.Notes=r?$("#notes").val():"",window.searchCardModel.TCId=$("#hdnTCId").val()),window.searchCardModel.HasModules=$("input[id^=courseModule]").length>0,window.searchCardModel.ModuleIds=$("input[id^=courseModule]:checked").map(function(){return this.value}).get().join(","),f=window.searchCardModel.InstructorId=$("#newInstructor option:selected").val(),o||(t[t.length]=window.resources.TextFirstNameRequired),s||(t[t.length]=window.resources.TextLastNameRequired),i?e.validateEmail(i)||(t[t.length]=window.resources.TextInvalidEmail):t[t.length]=window.resources.TextEmailRequired,i!=$("#hdnPreviuosEmail").val()&&(i.toLowerCase()==$("#hdnLoggedInUserEmail").val().toLowerCase()&&(t[t.length]=window.resources.TextInvalidStudentEmailLoggedInMsg),i.toLowerCase()==$("#newInstructor option:selected").data("instremail").toLowerCase()&&(t[t.length]=window.resources.TextInvalidStudentEmailMsg)),u||(t[t.length]=window.resources.TextCourseDateRequired),f||(t[t.length]=window.resources.TextInstructorRequired),n.showResponseError("divEditError","errlist1",t)},validateMobilePhone:function(n){return $.trim(n).match(/^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/im)?!0:!1},saveInfo:function(n){n.preventDefault();$("#divEditError, #divEditAlert").toggleClass("hide",!0);var t=this,i=$(n.target),r=i.data("url");if(!t.validateEdit())return!1;$("#confirmUpdateEcardModal").modal("show");$("#btnOk").off("click");$("#btnOk").on("click",function(){t.callAPI("post",r,window.searchCardModel,t.onSuccessSave,t.onEditCardFailed)})},onSuccessSave:function(t){t&&($("#confirmUpdateEcardModal").modal("hide"),$("#divEditAlert").toggleClass("hide",!1),$("#divEditAlert").find("#pSuccessMsg").html(window.resources.TextStudentInformationUpdated),n.focusMessage())},onEditCardFailed:function(t){n.showResponseError("divEditError","errlist1",t)},claimECard:function(n){n.preventDefault();$("#divEditError, #divEditAlert").toggleClass("hide",!0);var t=this;$("#confirmClaimeCardModal").modal("show");$("#divModelBody").html(window.resources.TextConfirmClaimeCard);$("#confirmClaimeCardModal").modal("show");$("#btnClaimeCardOk").off("click");$("#btnClaimeCardOk").on("click",function(){t.saveClaimECard(n)})},saveClaimECard:function(n){n.preventDefault();$("#confirmClaimeCardModal").modal("hide");var t=this,i=$(n.target),r=i.data("url"),u=i.data("eid"),f=i.data("tcid"),e={eCardGuid:u,tcid:f};t.callAPI("post",r,e,t.onSuccessClaim,t.onEditCardFailed)},onSuccessClaim:function(t){t&&($("#divEditAlert").toggleClass("hide",!1),$("#divEditAlert").find("#pSuccessMsg").html(window.resources.TexteCardClaimedSuccessfully),$("#lnkClaimECard, #lnlReclaimECard").hide(),n.focusMessage())},reclaimECard:function(n){n.preventDefault();$("#divEditError, #divEditAlert").toggleClass("hide",!0);var t=this;$("#confirmClaimeCardModal").modal("show");$("#divModelBody").html(window.resources.TextConfirmReclaimeCard);$("#confirmClaimeCardModal").modal("show");$("#btnClaimeCardOk").off("click");$("#btnClaimeCardOk").on("click",function(){t.saveReclaimECard(n)})},showRevisionHistory:function(t){t.preventDefault();var r=this,i=$(t.target),u=i.data("url"),f=i.data("ecode"),e={certId:f};r.callAPI("get",u,e,function(t){var i,r;t&&t.length>0&&($("#divRevisionModelBody").html(t),$("#eCardRevisionModal").modal("show"),i=$("#tblEcardRevisionHistory").DataTable({pageLength:25,order:[[8,"desc"]]}),i.context.length>0&&(r=new $.fn.dataTable.Buttons(i,{buttons:[{extend:"excelHtml5",title:n.getFileName("Ecard Revision History")}]}),$("#expotbutton").prepend(r.container()).find("a.dt-button").addClass("btn-sm btn-primary").text(window.resources.TextDownload),n.focusArea("#divRevisionModelBody")))},function(t){n.showResponseError("divEditError","errlist",t)})},saveReclaimECard:function(n){n.preventDefault();$("#confirmClaimeCardModal").modal("hide");var t=this,i=$(n.target),r=i.data("url"),u=i.data("eid"),f=i.data("courseid"),e={eCardGuid:u,courseId:f};t.callAPI("post",r,e,t.onReclaimSuccess,t.onEditCardFailed)},onReclaimSuccess:function(t){t&&($("#divEditAlert").toggleClass("hide",!1),$("#divEditAlert").find("#pSuccessMsg").html(window.resources.TexteCardReclaimedSuccessfully),$("#lnkClaimECard, #lnlReclaimECard").hide(),n.focusMessage())},loadSearch:function(n){n.preventDefault();$("#divSearch").toggleClass("hide",!1);$("#divEditCard").html("").toggleClass("hide",!0);$("#btnSearchCards").trigger({type:"click",canShowMsg:!1})},toggleState:function(n){var t=$(n.target).val();t=="USA"||t=="CAN"?$("#stateDiv").show():$("#stateDiv").hide()},open_lookup:function(){var n=this,t;$("#tcError").html("").addClass("hide");t=$("#tcModal").data("url");n.callAPI("get",t,null,function(t){$(".modal-body").html(t);$("#tcModal").modal("show");$("#countryCode").off("click");$("#search").off("click");$("#countryCode").on("change",n.toggleState);$("#search").on("click",$.proxy(n.searchTC,n))},n.onEditCardFailed)},searchTC:function(t){var r,i,u;if(t.preventDefault(),r=this,$("#tcError").html("").addClass("hide"),i=$("#countryCode").val(),u=$("#stateCode").val(),!i)return n.showResponseError("tcError","tcErrlist",window.resources.TextCountryRequired);if((i==="USA"||i==="CAN")&&!u)return n.showResponseError("tcError","tcErrlist",window.resources.TextStateRequired);var f=$("#city").val(),e=$("#tcId").val(),o=$("#hdnLookUpUrl").val(),s={countryCode:i,stateCode:u,city:f,tcNumber:e};return r.callAPI("get",o,s,function(n){$("#tcNamesTableContainer").html(n);$("a[id^=lnkPick]").off("click");$("a[id^=lnkPick]").on("click",$.proxy(r.pickTC,r))},function(t){n.showResponseError("tcError","tcErrlist",t)}),!1},pickTC:function(t){t.preventDefault();var f=this,i=$(t.target),r=i.data("tcid"),e=i.data("tcname"),u=$("#newInstructor option:selected").val(),o={tcId:r,courseId:$("#divCourse").data("cid"),isActive:!0},s=$("#hdnInstructorUrl").val();f.callAPI("get",s,o,function(n){if(n&&n.length>0){$("#hdnTCId").val(r);$("#spTCName").html(e);var t=[];$.each(n,function(n,i){t.push($("<option/>",{value:i.Id,text:i.DisplayName}))});$("#newInstructor").empty().append(t).val("");$("#newInstructor option[value='"+u+"']").length>0&&$("#newInstructor").val(u)}$("#tcModal").modal("hide")},function(t){n.showResponseError("tcError","tcErrlist",t)})},findTCById:function(n){n.preventDefault();var t=this,i=$(n.target),r=i.data("tcid"),u=i.data("url"),f={tcid:r};t.callAPI("get",u,f,t.onfindTCByIdResult,t.onFailedFindTC)},onfindTCByIdResult:function(n){var t="";t="<div>"+n.TrainingCenter.Name+"<\/div><div>"+n.TrainingCenter.TCIdNumber+"<\/div>";n.TrainingCenter.Address1&&(t=t+"<div>"+n.TrainingCenter.Address1+"<\/div>");n.TrainingCenter.City&&(t=t+"<div>"+n.TrainingCenter.City+"<\/div>");n.TrainingCenter.State&&(t=t+"<div>"+n.TrainingCenter.State,n.TrainingCenter.Country?t=t+", "+n.TrainingCenter.Country+"<\/div>":t+"<\/div>");!n.TrainingCenter.State&&n.TrainingCenter.Country&&(t=t+"<div>"+n.TrainingCenter.Country+"<\/div>");n.TrainingCenter.Phone&&(t=t+"<div>"+n.TrainingCenter.Phone+"<\/div>");$("#tcDetailContent").html(t);$("#tcDetailModal").modal("show")},onFailedFindTC:function(t){n.showResponseError("tcDetailError","tcErr",t)}}},AppSearchECards=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon;return{init:function(){var n=this;if($(document).ready(function(){$("#resendEmailModal").on("shown.bs.modal",n.focusResend);$("#resendSMSModal").on("shown.bs.modal",n.focusResend);$("#sendSecurityAnsModal").on("shown.bs.modal",n.focusResend);$("#tcDetailModal").on("shown.bs.modal",n.focusResend);$("#confirmClaimeCardModal").on("shown.bs.modal",n.focusResend)}),n.initMultiSelect(),$("#divInstType").length>0){$("input[id=radActive]:radio").prop("checked",!0);$("input[type=radio][name=instType]").on("change",function(t){n.toggleInstrStatus(t)})}},toggleInstrStatus:function(n){var t=this,u=$(n.target),f=u.val(),i,r;$("#divSearchError").toggleClass("hide",!0);i={isActive:f==="act"?!0:!1};r=$("#hdnGetInstrUrl").val();t.callAPI("get",r,i,t.onLoadInstrSuccess,t.onLoadInstrFail)},initMultiSelect:function(){$("#course").multiselect({buttonWidth:"100%",disableIfEmpty:!1,includeSelectAllOption:!0,selectAllText:window.resources.TextSelectAll,allSelectedText:window.resources.TextAllSelected,nonSelectedText:window.resources.SelectCourses,nSelectedText:" "+window.resources.TextSelectedCourses})},callAPI:function(n,t,i,r,u){n==="get"?$.get(t,i,r).error(function(n){u(n)}):$.post(t,i,r).error(function(n){u(n)})},validateEmail:function(n){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/igm.test(n)},onLoadInstrSuccess:function(n){var t=[];t.push($("<option/>",{value:"",text:window.resources.TextSelectInstructor}));n&&n.length>0&&$.each(n,function(n,i){t.push($("<option/>",{value:i.UserId,text:i.InstructorWithId}))});$("#instructor").empty().append(t).val("")},onLoadInstrFail:function(t){var i=[];i.push($("<option/>",{value:"",text:window.resources.TextSelectInstructor}));$("#ddlInstructor").empty().append(i).val("");n.showResponseError("divSearchError","errlist",t)},focusResend:function(n){var t=$(this),r,i;t.find("#studentemail").focus();t.find("#btnResendSMS").focus();t.find("#btnSendSecurityAns").focus();t.find("#btnCloseTC").focus();r=$(n.target);i=r.attr("id");i=="resendEmailModal"?$("#alertSuccess").text(window.resources.TextResentSuccessfully):i=="resendSMSModal"?$("#alertSuccess").text(window.resources.TextResentSuccessfully):i=="sendSecurityAnsModal"&&$("#alertSuccess").text(window.resources.TextSentSecAnswerSuccessfully)},validateSearch:function(){var t=[];window.searchCardModel.CourseDate="";var u=window.searchCardModel.FirstName=$("#firstname").val(),f=window.searchCardModel.LastName=$("#lastname").val(),o=window.searchCardModel.Email=$("#email").val(),s=window.searchCardModel.ECardCode=$("#ecode").val(),i=$("#courseFromDate").val(),r=$("#courseToDate").val(),h=window.searchCardModel.EStatus=$("#estatus option:selected").val(),e=$("#course").multiselect("getSelected").val(),c=window.searchCardModel.CourseIds=e?e.join(","):"",l=window.searchCardModel.InstructorId=$("#instructor option:selected").val();return u||f||o||s||h||c||l||i&&r?(u&&!f&&(t[t.length]=window.resources.TextEnterLastName),(i||r)&&!n.isValidDate(i,r)&&(t[t.length]=n.getDateFormatError(window.resources.CourseDate))):t[t.length]=window.resources.TextAtleastOneValue,n.showResponseError("divSearchError","errlist",t)},loadInitialResult:function(n){var t=this,r=$("#hdnSearchUrl").val(),i;if($("#divAlert").toggleClass("hide",n),$("#divSearchError").toggleClass("hide",!0),!this.validateSearch())return window.searchCardModel.StartDate="",window.searchCardModel.EndDate="",!1;window.searchCardModel.StartDate=$("#courseFromDate").val();window.searchCardModel.EndDate=$("#courseToDate").val();window.searchCardModel.CourseDate="";i=window.searchCardModel;t.callAPI("post",r,i,t.onLoadResult,t.onFailSearch)},searcheCards:function(n){n.preventDefault();var t=this;t.loadInitialResult(!n.canShowMsg)},onLoadResult:function(t){$("#divSearchResult").toggleClass("hide",!1).html(t);$("#example").DataTable();$("[data-blocked]").closest("tr").addClass("blockedInRed");$("#divAlert").is(":visible")?n.focusMessage():$("html, body").animate({scrollTop:$("#titleResults").offset().top-55},1e3)},onFailSearch:function(t){n.showResponseError("divSearchError","errlist",t)},clearSearch:function(t){t.preventDefault();var i=this;$("#divSearchError").html("");$("#divSearchError").toggleClass("hide",!0);$("#firstname").val("");$("#lastname").val("");$("#email").val("");$("#ecode").val("");$("#estatus").val("");$("#course").multiselect("deselectAll",!1);$("#course").multiselect("updateButtonText");$("#instructor").val("");$("#courseToDate").datepicker("setDate","");$("#courseFromDate").datepicker("setDate","");$("#divSearchResult").html("");$("#divEditCard").html("");$("#divAlert").toggleClass("hide",!0);window.searchCardModel={};n.focusMessage()},action_Click:function(n){var i,t,r;if(n.preventDefault(),i=this,$("#divAlert").toggleClass("hide",!0),$("#resendEmailModal").modal("hide"),$("#resendSMSModal").modal("hide"),$("#sendSecurityAnsModal").modal("hide"),$("#resendEmailError").toggleClass("hide",!0),$("#resendSMSError").toggleClass("hide",!0),$("#sendSecurityAnsError").toggleClass("hide",!0),$("#lnkSaveResendEmail").toggleClass("hide",!1),t=$(n.target),r={ECardUId:t.data("eid"),StudentId:t.data("stuid"),EmailAddress:t.data("email"),Url:t.data("url"),MobilePhone:t.data("mobilephone"),FirstName:t.data("firstname"),LastName:t.data("lastname"),ECardUId:t.data("eid"),Action:t.data("action"),CanSaveEmail:!1,CanSavePhone:!1,Status:t.data("status")},t.data("action")=="email"||t.data("action")=="claimemail"){$("#resendEmailModal").modal("show");$("#btnResend").off("click");$("#lnkSaveResendEmail").off("click");$("#btnResend").on("click",r,$.proxy(i.validateReSendEmail,i));$("#lnkSaveResendEmail").on("click",r,$.proxy(i.validateReSendEmail,i));$("#studentemail").val(r.EmailAddress)}else if(t.data("action")=="sms"){$("#resendSMSModal").modal("show");$("#btnResendSMS").off("click");$("#btnResendSMS").on("click",r,$.proxy(i.validateReSendSMS,i));$("#studentphone").val(r.MobilePhone)}else if(t.data("action")=="securityAnswer"){$("#sendSecurityAnsModal").modal("show");$("#btnSendSecurityAns").off("click");$("#btnSendSecurityAns").on("click",r,$.proxy(i.validateSendSecurityAns,i));$("#studentSecurityEmail").val(r.EmailAddress)}t.data("action")=="claimemail"&&$("#lnkSaveResendEmail").toggleClass("hide",!0)},validateSendSecurityAns:function(t){var i,f;t.preventDefault();var u=this,r=t.data,e=$(t.target);if(r.EmailAddress=$("#studentSecurityEmail").val(),$("#sendSecurityAnsError").toggleClass("hide",!0),i=[],r.EmailAddress||(i[i.length]=window.resources.TextEmailRequired),r.EmailAddress&&!u.validateEmail(r.EmailAddress)&&(i[i.length]=window.resources.TextInvalidEmail),i.length>0)return n.showResponseError("sendSecurityAnsError","emailErr",i);f=r.Url;u.callAPI("post",f,r,u.onSuccess,u.onFail)},validateReSendEmail:function(t){var r,f;t.preventDefault();var u=this,i=t.data,e=$(t.target);if(e[0].id=="lnkSaveResendEmail"&&(i.CanSaveEmail=!0),i.EmailAddress=$("#studentemail").val(),$("#resendEmailError").toggleClass("hide",!0),r=[],i.EmailAddress||(r[r.length]=window.resources.TextEmailRequired),i.EmailAddress&&!u.validateEmail(i.EmailAddress)&&(r[r.length]=window.resources.TextInvalidEmail),r.length>0)return n.showResponseError("resendEmailError","emailErr",r);f=i.Url;u.callAPI("post",f,i,u.onSuccess,u.onFail)},validateReSendSMS:function(t){var i,f;t.preventDefault();var r=this,u=t.data,e=$(t.target);if($("#resendSMSError").toggleClass("hide",!0),i=[],u.MobilePhone||(i[i.length]=window.resources.TextMobileNumberRequired),i.length>0)return n.showResponseError("resendSMSError","emailErr",i);f=u.Url;r.callAPI("post",f,u,r.onSuccess,r.onFail)},onSuccess:function(n){n&&($("#resendEmailModal").modal("hide"),$("#resendSMSModal").modal("hide"),$("#sendSecurityAnsModal").modal("hide"),$("#divAlert").toggleClass("hide",!1),$("#btnSearchCards").trigger({type:"click",canShowMsg:!0}))},onFail:function(t){n.showResponseError("resendError","emailErr",t)},editECard:function(n){n.preventDefault();$("#divEditError").toggleClass("hide",!0);$("#divEditAlert").toggleClass("hide",!0);var t=this,i=$(n.target.parentElement),r=i.data("url"),u={eCardGuid:i.data("eid"),isInstructorCard:i.data("isinstsrc")};t.callAPI("post",r,u,$.proxy(t.onLoadingEditCard,t),t.onFailSearch)},onLoadingEditCard:function(t){var i=this;if(t&&t.length>0&&($("#divSearch").toggleClass("hide",!0),$("#divEditCard").toggleClass("hide",!1).html(t),n.initDatePicker(!0),n.focusMessage(),$("#blockeCard").length>0)){$("#blockeCard").off("change");$("#blockeCard").on("change",i.changeStatus);$("#notes").prop("disabled",!$("#blockeCard").is(":checked"))}},changeStatus:function(){this.checked?$("#notes").prop("disabled",!1):$("#notes").val("").prop("disabled","disabled")},validateEdit:function(){var e=this,t=[],o=window.searchCardModel.FirstName=$("#fname").val(),s=window.searchCardModel.LastName=$("#lname").val(),r=window.searchCardModel.Email=$("#emailaddress").val(),u,i,f;return window.searchCardModel.Phone=$("#phone").val(),window.searchCardModel.InstructorStudentId=$("#instructorStudentId").val(),window.searchCardModel.ECardUId=$("#hdnEUId").val(),window.searchCardModel.SubCourseId=$("#subCourse option:selected").val(),u=window.searchCardModel.CourseDate=$("#courseDate").val(),$("#blockeCard").length>0&&(i=$("#blockeCard").is(":checked"),window.searchCardModel.EStatus=i?$("#blockeCard").val():0,window.searchCardModel.Notes=i?$("#notes").val():"",window.searchCardModel.TCId=$("#hdnTCId").val()),window.searchCardModel.HasModules=$("input[id^=courseModule]").length>0,window.searchCardModel.ModuleIds=$("input[id^=courseModule]:checked").map(function(){return this.value}).get().join(","),f=window.searchCardModel.InstructorId=$("#newInstructor option:selected").val(),o||(t[t.length]=window.resources.TextFirstNameRequired),s||(t[t.length]=window.resources.TextLastNameRequired),r?e.validateEmail(r)||(t[t.length]=window.resources.TextInvalidEmail):t[t.length]=window.resources.TextEmailRequired,u||(t[t.length]=window.resources.TextCourseDateRequired),f||(t[t.length]=window.resources.TextInstructorRequired),n.showResponseError("divEditError","errlist1",t)},validateMobilePhone:function(n){return $.trim(n).match(/^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/im)?!0:!1},saveInfo:function(n){n.preventDefault();$("#divEditError, #divEditAlert").toggleClass("hide",!0);var t=this,i=$(n.target),r=i.data("url");if(!t.validateEdit())return!1;t.callAPI("post",r,window.searchCardModel,t.onSuccessSave,t.onEditCardFailed)},onSuccessSave:function(t){t&&($("#divEditAlert").toggleClass("hide",!1),$("#divEditAlert").find("#pSuccessMsg").html(window.resources.TextStudentInformationUpdated),n.focusMessage())},onEditCardFailed:function(t){n.showResponseError("divEditError","errlist1",t)},claimECard:function(n){n.preventDefault();$("#divEditError, #divEditAlert").toggleClass("hide",!0);var t=this;$("#confirmClaimeCardModal").modal("show");$("#divModelBody").html(window.resources.TextConfirmClaimeCard);$("#confirmClaimeCardModal").modal("show");$("#btnClaimeCardOk").off("click");$("#btnClaimeCardOk").on("click",function(){t.saveClaimECard(n)})},saveClaimECard:function(n){n.preventDefault();$("#confirmClaimeCardModal").modal("hide");var t=this,i=$(n.target),r=i.data("url"),u=i.data("eid"),f=i.data("tcid"),e={eCardGuid:u,tcid:f};t.callAPI("post",r,e,t.onSuccessClaim,t.onEditCardFailed)},onSuccessClaim:function(t){t&&($("#divEditAlert").toggleClass("hide",!1),$("#divEditAlert").find("#pSuccessMsg").html(window.resources.TexteCardClaimedSuccessfully),$("#lnkClaimECard, #lnlReclaimECard").hide(),n.focusMessage())},reclaimECard:function(n){n.preventDefault();$("#divEditError, #divEditAlert").toggleClass("hide",!0);var t=this;$("#confirmClaimeCardModal").modal("show");$("#divModelBody").html(window.resources.TextConfirmReclaimeCard);$("#confirmClaimeCardModal").modal("show");$("#btnClaimeCardOk").off("click");$("#btnClaimeCardOk").on("click",function(){t.saveReclaimECard(n)})},saveReclaimECard:function(n){n.preventDefault();$("#confirmClaimeCardModal").modal("hide");var t=this,i=$(n.target),r=i.data("url"),u=i.data("eid"),f=i.data("courseid"),e={eCardGuid:u,courseId:f};t.callAPI("post",r,e,t.onReclaimSuccess,t.onEditCardFailed)},onReclaimSuccess:function(t){t&&($("#divEditAlert").toggleClass("hide",!1),$("#divEditAlert").find("#pSuccessMsg").html(window.resources.TexteCardReclaimedSuccessfully),$("#lnkClaimECard, #lnlReclaimECard").hide(),n.focusMessage())},loadSearch:function(n){n.preventDefault();$("#divSearch").toggleClass("hide",!1);$("#divEditCard").html("").toggleClass("hide",!0);$("#btnSearchCards").trigger({type:"click",canShowMsg:!1})},toggleState:function(n){var t=$(n.target).val();t=="USA"||t=="CAN"?$("#stateDiv").show():$("#stateDiv").hide()},open_lookup:function(){var n=this,t;$("#tcError").html("").addClass("hide");t=$("#tcModal").data("url");n.callAPI("get",t,null,function(t){$(".modal-body").html(t);$("#tcModal").modal("show");$("#countryCode").off("click");$("#search").off("click");$("#countryCode").on("change",n.toggleState);$("#search").on("click",$.proxy(n.searchTC,n))},n.onEditCardFailed)},searchTC:function(t){var r,i,u;if(t.preventDefault(),r=this,$("#tcError").html("").addClass("hide"),i=$("#countryCode").val(),u=$("#stateCode").val(),!i)return n.showResponseError("tcError","tcErrlist",window.resources.TextCountryRequired);if((i==="USA"||i==="CAN")&&!u)return n.showResponseError("tcError","tcErrlist",window.resources.TextStateRequired);var f=$("#city").val(),e=$("#tcId").val(),o=$("#hdnLookUpUrl").val(),s={countryCode:i,stateCode:u,city:f,tcNumber:e};return r.callAPI("get",o,s,function(n){$("#tcNamesTableContainer").html(n);$("a[id^=lnkPick]").off("click");$("a[id^=lnkPick]").on("click",$.proxy(r.pickTC,r))},function(t){n.showResponseError("tcError","tcErrlist",t)}),!1},pickTC:function(t){t.preventDefault();var f=this,i=$(t.target),r=i.data("tcid"),e=i.data("tcname"),u=$("#newInstructor option:selected").val(),o={tcId:r,courseId:$("#divCourse").data("cid"),isActive:!0},s=$("#hdnInstructorUrl").val();f.callAPI("get",s,o,function(n){if(n&&n.length>0){$("#hdnTCId").val(r);$("#spTCName").html(e);var t=[];$.each(n,function(n,i){t.push($("<option/>",{value:i.Id,text:i.DisplayName}))});$("#newInstructor").empty().append(t).val("");$("#newInstructor option[value='"+u+"']").length>0&&$("#newInstructor").val(u)}$("#tcModal").modal("hide")},function(t){n.showResponseError("tcError","tcErrlist",t)})},findTCById:function(n){n.preventDefault();var t=this,i=$(n.target),r=i.data("tcid"),u=i.data("url"),f={tcid:r};t.callAPI("get",u,f,t.onfindTCByIdResult,t.onFailedFindTC)},onfindTCByIdResult:function(n){var t="";t="<div>"+n.TrainingCenter.Name+"<\/div><div>"+n.TrainingCenter.TCIdNumber+"<\/div>";n.TrainingCenter.Address1&&(t=t+"<div>"+n.TrainingCenter.Address1+"<\/div>");n.TrainingCenter.City&&(t=t+"<div>"+n.TrainingCenter.City+"<\/div>");n.TrainingCenter.State&&(t=t+"<div>"+n.TrainingCenter.State,n.TrainingCenter.Country?t=t+", "+n.TrainingCenter.Country+"<\/div>":t+"<\/div>");!n.TrainingCenter.State&&n.TrainingCenter.Country&&(t=t+"<div>"+n.TrainingCenter.Country+"<\/div>");n.TrainingCenter.Phone&&(t=t+"<div>"+n.TrainingCenter.Phone+"<\/div>");$("#tcDetailContent").html(t);$("#tcDetailModal").modal("show")},onFailedFindTC:function(t){n.showResponseError("tcDetailError","tcErr",t)}}},AppStudentAssignment=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon,f={init:function(){var n=$('a[data-toggle="collapse"]');n.on("click",function(){n.delay(1e3).hasClass("collapsed")?f.hide(n):f.show(n)});$(document).ready(function(){$("#confirmReplacementeCardModal").on("shown.bs.modal",self.focusResend)})},hide:function(n){n.children(".text").text("Hide Info");n.children(".fa").hasClass("fa-caret-up")?n.children(".fa").removeClass("fa-caret-up").addClass("fa-caret-down"):""},show:function(n){n.children(".text").text("Show Info");n.children(".fa").hasClass("fa-caret-down")?n.children(".fa").removeClass("fa-caret-down").addClass("fa-caret-up"):""}},u,o,t="tc",r,l=$("#divServiceUrl").data("tc_url"),a=$("#divServiceUrl").data("ts_url"),s=$("#divServiceUrl").data("course_url"),h=$("#divServiceUrl").data("instructor_url"),v=$("#divServiceUrl").data("quantity_url"),i=$("#CourseId option:selected").val(),c=$("#CourseId option:selected").data("productnumber"),e=[],y=function(){var l,f,u;$("#assignError").html("");$("#assignError").addClass("hide");var t=[],e=$("#CourseId option:selected").val(),o=$("#RoleId option:selected").val(),s=$("#ddlTC option:selected").val(),a=$("#ddlLocation option:selected").val(),h=$("#ddlInstructor option:selected").val(),i=$("#assignQty").val(),c=parseInt($("#availQty").text());return r=$("#chkUpload")[0].checked,l=$("#dataFile")[0].files,(!e||e<=0)&&(t[t.length]=window.resources.TextCourseRequired),(!o||o<=0)&&(t[t.length]=window.resources.TextSelectRoleRequired),(!s||s<=0)&&(t[t.length]=window.resources.TextTrainingCenterRequired),c<=0,(!h||h<=0)&&(t[t.length]=window.resources.TextInstructorRequired),i>c&&(t[t.length]=window.resources.TextExceedsInventory),r?l.length==0?t[t.length]=window.resources.TextUploadFileRequired:(f=$("#dataFile")[0].files,u=f[0].name.substr(f[0].name.lastIndexOf(".")+1).toLowerCase(),u!="xls"&&u!="xlsx"&&u!="csv"&&(t[t.length]=window.resources.TextFileShouldBeExcelOrCSV)):i&&i!="0"?(!jQuery.isNumeric(i)||Math.floor(i)!=i||parseInt(i)<=0)&&(t[t.length]=window.resources.TextAssignQtyPositiveInteger):t[t.length]=window.resources.TextAssignQtyRequired,n.showResponseError("assignError","errlist",t)};return{init:function(){var u=this;i>0&&u.showK12Info();$("#ddlCardType").on("change",function(){var n;u.resetAll();n=$("#ddlCardType option:selected").val();$("#divInventoryPool").toggleClass("hide",!0);u.showK12Info();n=$("#ddlCardType option:selected").val();n=="new"&&($("#divReplace").toggleClass("hide",!0),$("#CourseId").trigger("change"));n=="replacement"&&$("#divReplace").toggleClass("hide",!1)});$("#btnSearchReplace").on("click",function(){var i=$("#ddlCardType option:selected").val(),t;if(i||(t=[],t[t.length]=window.resources.SelectCardType,n.showResponseError("assignError","errlist",t)),i=="replacement"){var r=$("#ddlCardType").data("view"),f=$("#ddlCardType").data("replaceurl"),e=$("#CourseId option:selected").val();return u.submit(f,{courseID:e},this.render,"",r),!1}});$("#RoleId").on("change",function(n){var t=$(n.target).val(),i;t>0?(u.resetAll(),$("#divTC").toggleClass("hide",!0),$("#divTS").toggleClass("hide",!0),$("#divCourse").toggleClass("hide",!0),$("#divFrom").toggleClass("hide",!0),$("#divCardType").toggleClass("hide",!0),$("input[type=radio][name=fromType]").prop("checked",!1),(t==RoleType.TCC.value||t==RoleType.TCAdmin.value||t==RoleType.TSC.value||t==RoleType.TSAdmin.value)&&($("#divTC").toggleClass("hide",!1),i=$(n.target).data("url"),u.getData(i,{selectedRoleId:t},"#ddlTC","#divTC",window.resources.SelectTrainingCenter)),t==RoleType.Instructor.value&&$("#divFrom").toggleClass("hide",!1)):($("#assignError").toggleClass("hide",!0),$("#divTC").toggleClass("hide",!0),$("#divTS").toggleClass("hide",!0),$("#divFrom").toggleClass("hide",!0),$("#divCourse").toggleClass("hide",!0),$("#divBox").toggleClass("hide",!0),$("#divSubmit").toggleClass("hide",!0),$("#divSubmit").toggleClass("hide",!0))});$("#ddlInstructor").on("change",function(){$("#divSubmit").toggleClass("hide",!1)});$("#ddlTC").on("change",function(n){var i,r,f;$("#assignError").toggleClass("hide",!0);$("#divCardType").toggleClass("hide",!0);i=$("#RoleId option:selected").val();r=$(n.target).val();$("#ddlTS").val("");t=i!=RoleType.Instructor.value?"tc":t;r>0?(u.resetAll(),$("#divTS").toggleClass("hide",!0),$("#divCourse").toggleClass("hide",!0),f=$("#ddlInventoryPool option:selected").val(),t=="tc"&&(i==RoleType.TCC.value||i==RoleType.TCAdmin.value||i==RoleType.Instructor.value)?u.getData(s,{orgId:r,orgType:"tc",roleId:i},"#CourseId","#divCourse",window.resources.SelectCourse):(t=="ts"||i==RoleType.Instructor.value||i==RoleType.TSC.value||i==RoleType.TSAdmin.value)&&($("#divInstructor").toggleClass("hide",!0),$("#divBox").toggleClass("hide",!0),$("#divSubmit").toggleClass("hide",!0),u.getData(a,{tcId:r,roleId:i},"#ddlTS","#divTS",window.resources.TextSelectTrainingSite))):($("#divTS").toggleClass("hide",!0),$("#divFrom").toggleClass("hide",!0),$("#divCourse").toggleClass("hide",!0),$("#divBox").toggleClass("hide",!0),$("#divSubmit").toggleClass("hide",!0),$("#divInstructor").toggleClass("hide",!0))});$("#ddlTS").on("change",function(n){var t=$(n.target).val();$("#assignError").toggleClass("hide",!0);var r=$("#ddlTC option:selected").val(),f=$("#ddlInventoryPool option:selected").val(),i=$("#RoleId option:selected").val();t>0?(u.resetAll(),$("#divCourse").toggleClass("hide",!0),u.getData(s,{orgId:t,orgType:"ts",roleId:i},"#CourseId","#divCourse",window.resources.SelectCourse)):($("#divInstructor").toggleClass("hide",!0),$("#divBox").toggleClass("hide",!0),$("#divSubmit").toggleClass("hide",!0),$("#divCourse").toggleClass("hide",!0))});$("#CourseId").on("change",function(){var n,t,r,f,e;if(u.resetAll(),i=$("#CourseId option:selected").val(),n=$("#RoleId option:selected").val(),t=$("#ddlTC option:selected").val(),(n==RoleType.TSC.value||n==RoleType.TSAdmin.value||n==RoleType.Instructor.value)&&(r=$("#ddlTS option:selected").val()),u.showK12Info(),i>0){if(c=$("#CourseId option:selected").data("productnumber"),f=$("#RoleId").val()==RoleType.TCC.value||$("#RoleId").val()==RoleType.TCAdmin.value,c=="20-3006-3"&&f==1){if($("#divCardType").toggleClass("hide",!1),$("#ddlCardType").val()!="new")return}else $("#ddlCardType").val(""),$("#divCardType").toggleClass("hide",!0),$("#divReplace").toggleClass("hide",!0);$("#divInstType").toggleClass("hide",n==RoleType.Instructor.value);$("input[id=radActive]:radio").prop("checked",n!=RoleType.Instructor.value);e=$("input[name=instType]:checked").val();u.getAvailableQty(i,n,t,r);u.getData(h,{tcId:t,tsId:r,courseId:i,roleId:n,isActive:n==RoleType.Instructor.value?!0:e==="act"?!0:!1},"#ddlInstructor","#divInstructor",window.resources.SelectInstructor)}else $("#divInstructor").toggleClass("hide",!0),$("#divBox").toggleClass("hide",!0),$("#divSubmit").toggleClass("hide",!0)});$("input[type=radio][name=fromType]").on("change",function(n){var r=$(n.target),i;t=r.val();t==""&&(t="tc");t=="tc"&&$("#ddlTS").val("");i=$("#RoleId option:selected").val();u.getData(l,{selectedRoleId:i,filterBy:t},"#ddlTC","#divTC",window.resources.SelectTrainingCenter);$("#divTS").toggleClass("hide",!0);$("#divCourse").toggleClass("hide",!0);$("#divInstructor").toggleClass("hide",!0);$("#divSubmit").toggleClass("hide",!0);$("#divBox").toggleClass("hide",!0)});$("input[type=radio][name=instType]").on("change",function(n){var i;$("#assignError").toggleClass("hide",!0);var f=$(n.target),e=f.val(),o=$("#ddlTC option:selected").val(),r=0,s=$("#CourseId option:selected").val(),t=$("#RoleId option:selected").val();(t==RoleType.TSC.value||t==RoleType.TSAdmin.value||t==RoleType.Instructor.value)&&(r=$("#ddlTS option:selected").val());i=[];i.push($("<option/>",{value:"",text:window.resources.SelectInstructor}));$("#ddlInstructor").empty().append(i).val("");u.getData(h,{tcId:o,tsId:r,courseId:s,roleId:t,isActive:e==="act"},"#ddlInstructor","#divInstructor",window.resources.SelectInstructor)});$("#chkUpload").on("change",function(n){r=$(n.target)[0].checked;r?($("#divUpload").toggleClass("hide",!1),$("#assignQty").val(""),window.studentAssignmentViewModel.AssignedQty="",$("#assignQty").attr("disabled","disabled")):($("#divUpload").toggleClass("hide",!0),$("#assignQty").removeAttr("disabled"))})},showK12Info:function(){this.hideAlert();var n=$("#CourseId option:selected").text();$("#divk12").toggleClass("hide",n.toLowerCase()!=="heartsaver for k-12 schools")},hideAlert:function(){$("#divk12 .close").off("click");$("#divk12 .close").on("click",function(){$(this).parent().toggleClass("hide",!0)})},initMultiSelect:function(){$(".bootstrapmultiselect").multiselect({buttonWidth:"100%",disableIfEmpty:!1,includeSelectAllOption:!0,selectAllText:window.resources.TextSelectAll,allSelectedText:window.resources.TextAllSelected,nonSelectedText:window.resources.SelectCourseModules,nSelectedText:" "+window.resources.TextSelectedModules})},resetAll:function(){$("#assignError").toggleClass("hide",!0);$("#divBox").toggleClass("hide",!0);$("#divInstructor").toggleClass("hide",!0);$("#divSubmit").toggleClass("hide",!0)},getData:function(t,r,u,f,e){jQuery.get(t,r,function(n){var r=[];r.push($("<option/>",{value:"",text:e}));n&&n.length>0&&$.each(n,function(n,i){t.toLocaleLowerCase().indexOf("getcourse")!=-1?r.push($("<option/>",{value:i.Id,text:i.Name,"data-productnumber":i.ProductNumber,"data-module":i.HasModule,"data-subcourse":i.HasSubCourse})):t.toLocaleLowerCase().indexOf("getinstructors")!=-1?r.push($("<option/>",{value:i.Id,text:i.Name,"data-instremail":i.email})):r.push($("<option/>",{value:i.Id,text:i.Name}))});$(u).empty().append(r).val("");$(u).toggleClass("hide",!1);$(f).toggleClass("hide",!1);i=$("#CourseId option:selected").val();f=="#divInstructor"&&(i==63||i==65||i==67)&&$("#divInstType").toggleClass("hide",!0)}).error(function(t){var i=[];i.push($("<option/>",{value:"",text:e}));$(u).empty().append(i).val("");n.showResponseError("assignError","errlist",t)})},getAvailableQty:function(t,i,r,u){$("#divBox").toggleClass("hide",!0);jQuery.get(v,{courseId:t,fromRole:i,tcId:r,tsId:u},function(n){n&&($("#divBox").toggleClass("hide",!1),$("#availQty").text(n))}).error(function(t){n.showResponseError("assignError","errlist",t)})},validateEmail:function(n){return $.trim(n).match(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/igm)?!0:!1},validateMobilePhone:function(n){return $.trim(n).match(/^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/im)?!0:!1},validateStudent:function(){var v=this,i,r,u,f,s,h,c,l,y,a,t=[];return(e=[],o=!1,$("#tblStudent").find("tr").each(function(n){var t,b,k,y,w,p;n!=0&&(t=$(this).find("input"),b=$(this).find("select"),$(t[1]).toggleClass("errorhighlight",!1),$(t[2]).toggleClass("errorhighlight",!1),$(t[3]).toggleClass("errorhighlight",!1),$(t[4]).toggleClass("errorhighlight",!1),$(t[5]).toggleClass("errorhighlight",!1),$(b[0]).toggleClass("errorhighlight",!1),t[1].value==""?($(t[1]).toggleClass("errorhighlight",!0),i=window.resources.TextCourseDateRequired):(k=new Date,y=new Date,y=new Date(y.setMonth(y.getMonth()-6)),w=new Date(t[1].value),(w>k||w<y)&&(l=w>k?window.resources.TextCourseDateRange:window.resources.TextLast6MonthCourseDateRange)),t[2].value.trim()||($(t[2]).toggleClass("errorhighlight",!0),r=window.resources.TextFirstNameRequired),t[3].value.trim()||($(t[3]).toggleClass("errorhighlight",!0),u=window.resources.TextLastNameRequired),t[4].value.trim()?(v.validateEmail(t[4].value)||(h=window.resources.TextInvalidEmail,$(t[4]).toggleClass("errorhighlight",!0)),t[4].value.trim()==$("#ddlInstructor option:selected").data("instremail")&&(s=window.resources.TextInvalidStudentEmailMsg)):($(t[4]).toggleClass("errorhighlight",!0),f=window.resources.TextEmailRequired),t[5].value.trim()&&(o=!0,v.validateMobilePhone(t[5].value)||(c=window.resources.TextInvalidMobileNumber,$(t[5]).toggleClass("errorhighlight",!0))),e.push(t[4].value.trim()),p=$(b[1]),window.studentAssignmentViewModel.HasSubCourse==1&&p.length>0&&(!p.val()||p.val().length===0)&&(p.toggleClass("errorhighlight",!0),a=window.resources.TextCourseTypeRequired))}),i&&(t[t.length]=i),r&&(t[t.length]=r),u&&(t[t.length]=u),f&&(t[t.length]=f),s&&(t[t.length]=s),l&&(t[t.length]=l),h&&(t[t.length]=h),c&&(t[t.length]=c),y&&(t[t.length]=y),a&&(t[t.length]=a),n.showResponseError("assignErrorstep2","errlist",t),t.length==0)?!0:!1},checkDuplicateEmail:function(){for(var u=[],r=e.sort(),i=[],t=0;t<r.length-1;t++)r[t+1]==r[t]&&i.push(r[t]);for(t=0;t<i.length;t++)$("#tblStudent").find("tr").each(function(n){if(n!=0){var r=$(this).find("input");r[4].value.trim()==i[t]&&$(r[4]).toggleClass("errorhighlight",!0)}});return(i.length>0&&(u[u.length]=window.resources.TextSameEmailMSg),n.showResponseError("assignErrorstep2","errlist",u),i.length>0)?!0:!1},highlightDuplicateRows:function(){u=!1;var t={},i=function(){return $.trim($(this).text())};$("#tblConfirm").find("tr").each(function(){var n=$(this).find(".duplicate-student").map(i).toArray().join("|");t.hasOwnProperty(n)?t[n].push(this):t[n]=[this]});$.each(t,function(n,t){t.length>1&&$.each(t,function(n,t){t.style.backgroundColor="#ebccd1";u=!0})});u&&($("#assignErrorstep3").toggleClass("hide",!1),n.showWarning("assignErrorstep3","errlist1",window.resources.TextDuplicateStudents))},assignModel:function(n){var t,i,f,u;if(window.studentAssignmentViewModel.CourseName="",window.studentAssignmentViewModel.TCName="",window.studentAssignmentViewModel.InstructorName="",window.studentAssignmentViewModel.TrainingSiteName="",window.studentAssignmentViewModel.CourseId=$("#CourseId option:selected").val(),window.studentAssignmentViewModel.CourseId&&(window.studentAssignmentViewModel.CourseName=$("#CourseId option:selected").text()),window.studentAssignmentViewModel.SubCourseId=$("#ddlSubCourse option:selected").val(),window.studentAssignmentViewModel.SubCourseId&&(window.studentAssignmentViewModel.SubCourseName=$("#ddlSubCourse option:selected").text()),window.studentAssignmentViewModel.TCId=$("#ddlTC option:selected").val(),window.studentAssignmentViewModel.InstructorId=$("#ddlInstructor option:selected").val(),window.studentAssignmentViewModel.InstructorId&&$("#hdnInstrName").val($("#ddlInstructor option:selected").text()),window.studentAssignmentViewModel.TrainingSiteId=$("#ddlTS option:selected").val(),window.studentAssignmentViewModel.AvailableQty=parseInt($("#availQty").text()),window.studentAssignmentViewModel.HasModule=$("#CourseId")[0].options[$("#CourseId")[0].selectedIndex].getAttribute("data-module"),window.studentAssignmentViewModel.HasSubCourse=$("#CourseId")[0].options[$("#CourseId")[0].selectedIndex].getAttribute("data-subcourse"),window.studentAssignmentViewModel.FromRoleId=$("#RoleId option:selected").val(),window.studentAssignmentViewModel.IsUpload=r,t=[],$("#tblStudent").find("tr").each(function(n){if(n!=0){var i=$(this).find("input"),r=$(this).find("select");t.push({CourseDate:i[1].value,FirstName:i[2].value.trim(),LastName:i[3].value.trim(),Email:i[4].value.trim(),Phone:i[5].value.trim(),CourseModuleName:studentAssignmentViewModel.HasModule==1?r.find(":selected").map(function(n,t){return t.text}).get().join(", ").replace(", Select Course Type",""):"",CourseModuleId:studentAssignmentViewModel.HasModule==1?r.find(":selected").map(function(n,t){return t.value}).get().join(","):"",SubCourseId:studentAssignmentViewModel.HasSubCourse==1?r.find(":selected").map(function(n,t){return t.value}).get().join(","):null,SubCourse:studentAssignmentViewModel.HasSubCourse==1?r.find(":selected").map(function(n,t){return t.text}).get().join(","):""})}}),i=new FormData,r)for(f=$("#dataFile")[0].files,u=0;u<f.length;u++)i.append("file",f[u]);return n=="btnMoveNext"?window.studentAssignmentViewModel.AssignedQty=r?0:$("#assignQty").val():(window.studentAssignmentViewModel.AssignedQty=t.length,window.studentAssignmentViewModel.StudentList=t),$("#divAssignQty").text(t.length),i.append("model",JSON.stringify(window.studentAssignmentViewModel)),i},moveNext:function(n){var t=$(n).data("view"),i,r;return(t=="#completeAssignCards"&&$(n).prop("disabled",!0),i=this.assignModel(n.id),t!=="#searchreplacement"&&!y())?(t=="#completeAssignCards"&&$(n).prop("disabled",!1),!1):(r=$(n).data("url"),n.id=="btnFinish"&&u&&!confirm(window.resources.TextDuplicateAlert))?!1:(this.submit(r,i,this.render,"",t),!1)},movePrevious:function(n){this.hideAll();$(n).toggleClass("hide",!1);$("#assignErrorstep2").toggleClass("hide",!0);$("#assignErrorstep3").toggleClass("hide",!0);$("#searchreplacement").toggleClass("hide",!0)},submit:function(t,i,r,u,f){var o=this,e,s;if(f!="#studentAssignment"&&!o.validateStudent())return f=="#completeAssignCards"&&$("#btnFinish").prop("disabled",!1),!1;e="assignError";f=="#confirmAssignCards"&&(e="assignErrorstep2");f=="#completeAssignCards"&&(e="assignErrorstep3");f=="#studentAssignment"?jQuery.ajax({url:t,type:"POST",contentType:!1,processData:!1,data:i,dataType:"html",success:function(n){o.render(n,f)},error:function(t){n.showResponseError(e,"errlist",t)}}):(s=!1,jQuery.post(t,window.studentAssignmentViewModel,function(n){o.render(n,f)}).fail(function(t){s=!0;n.showResponseError(e,"errlist",t)}).always(function(){f!="#completeAssignCards"||s||$("#btnFinish").prop("disabled",!1)}))},render:function(t,i){var r=this,u,e;if(t&&($(i).html(t),n.initDatePicker(!0),i=="#studentAssignment"&&(r.initMultiSelect(),$("#moduleHelp").toggleClass("hide",window.studentAssignmentViewModel.HasModule!=1),$("#tdAssignTCName").html($("#ddlTC option:selected").text()),$("#tdAssignTSName").html($("#ddlTS option:selected").text())),$("[id*='tdInstrNameP']").html($("#hdnInstrName").val()),$('[data-toggle="popover"]').popover()),i=="#confirmAssignCards"){if(!r.validateStudent()||r.checkDuplicateEmail())return!1;r.highlightDuplicateRows();$("#tblConfirm").DataTable({pageLength:25});$("#tdConfirmTCName").html($("#ddlTC option:selected").text());$("#tdConfirmTSName").html($("#ddlTS option:selected").text())}r.assignModel();$("#divAssignQty").text(window.studentAssignmentViewModel.AssignedQty);r.hideAll();$(i).toggleClass("hide",!1);f.init();i=="#completeAssignCards"&&($("#tdCompTCName").html($("#ddlTC option:selected").text()),$("#tdCompTSName").html($("#ddlTS option:selected").text()),u=$("#tblEcard").DataTable({pageLength:25}),u.context.length>0&&(e=new $.fn.dataTable.Buttons(u,{buttons:[{extend:"excelHtml5",title:n.getFileName("Assigned eCards")}]}),$("#exportStudent").prepend(e.container()).find("a.dt-button").addClass("btn btn-primary").text(window.resources.TextDownload),e.container().css("display","inline-block"),$(".lnkecard").click($.proxy(r.loadECards,r))))},hideAll:function(){$("#index").toggleClass("hide",!0);$("#studentAssignment").toggleClass("hide",!0);$("#confirmAssignCards").toggleClass("hide",!0);$("#completeAssignCards").toggleClass("hide",!0)},remove:function(t){var r,u,i;return $("#tblStudent").find("tr").length>2?(r=$(t).closest("tr"),r.remove(),u=$("#tblConfirm").DataTable(),u.row(r).remove().draw(!1),i=$("#tblStudent").find("tr").length-1,window.studentAssignmentViewModel.AssignedQty=i,$("#divAssignQty").text(i),$("#assignQty").val(i)):n.showResponseError("assignErrorstep2","errlist2",window.resources.TextAtLeastOneStudentRequired),!1},removeConfirm:function(t){var r,f,e,i;return $("#tblConfirm").find("tr").length>2?(r=$(t).closest("tr"),r.remove(),f=$("#tblStudent").DataTable(),f.row(r).remove().draw(!1),e=$("#tblConfirm").find("tr"),i=e.length-1,window.studentAssignmentViewModel.AssignedQty=i,$("#tdAssignQty, #divAssignQty").html(i),$("#assignQty").val(i),i==1&&(u=!1)):n.showResponseError("assignErrorstep3","errlist3",window.resources.TextAtLeastOneStudentRequired),!1},selectAll:function(n){$("#tblStudent").find("input:checkbox").each(function(){this.checked=n.checked})},updateDate:function(n){var t=$(n).val();$("#tblStudent").find("tr").each(function(n){if(n!=0){var i=$(this).find("input");$(i[1]).datepicker("setDate",t)}})},updateModule:function(n){var t=$(n).val();$("#tblStudent").find("tr").each(function(n){if(n!=0){var i=$(this).find("select");i.val(t);i.multiselect("refresh")}})},updateSubCourse:function(n){var t=$(n).val();$("#tblStudent").find("tr").each(function(n){if(n!=0){var i=$(this).find("select");i.val(t)}})},validateSearch:function(){var t=[],u=$("#tcId option:selected").val(),i=$("#firstname").val(),r=$("#lastname").val(),f=$("#email").val(),e=$("#ecode").val();return i||r||f||e?(i&&!r&&(t[t.length]=window.resources.TextEnterLastName),u||(t[t.length]=window.resources.TextTrainingCenterRequired)):t[t.length]=window.resources.TextAtleastOneValue,n.showResponseError("assignError1","errlist1",t)},loadInitialResult:function(t){var r=this,u=$("#hdnSearchUrl").val(),i;if($("#divAlert").toggleClass("hide",t),$("#assignError1").toggleClass("hide",!0),window.studentAssignmentViewModel.StudentECardInfo={},!this.validateSearch())return!1;window.studentAssignmentViewModel.CourseId=$("#hdnCourseId").val();window.studentAssignmentViewModel.TCId=$("#tcId option:selected").val();window.studentAssignmentViewModel.StudentECardInfo.FirstName=$("#firstname").val();window.studentAssignmentViewModel.StudentECardInfo.LastName=$("#lastname").val();window.studentAssignmentViewModel.StudentECardInfo.Email=$("#email").val();window.studentAssignmentViewModel.StudentECardInfo.CertificateId=$("#ecode").val();i="#divSearchResult";jQuery.post(u,window.studentAssignmentViewModel,function(n){r.render(n,i);r.initMultiSelect()}).fail(function(t){n.showResponseError("assignError1","errlist",t)}).always(function(){i=="#completeAssignCards"&&$("#btnFinish").prop("disabled",!1)})},searcheCards:function(n){n.preventDefault();var t=this;t.loadInitialResult(!n.canShowMsg)},issueReplacementCard:function(n){n.preventDefault();$("#divEditError, #divEditAlert").toggleClass("hide",!0);var t=this;$("#confirmReplacementeCardModal").modal("show");$("#divModelBody").html(window.resources.TextConfirmReplaceCard);$("#confirmReplacementeCardModal").modal("show");$("#btnReplaceCardOk").off("click");$("#btnReplaceCardOk").on("click",function(){t.saveReplacementCard(n)})},saveReplacementCard:function(t){t.preventDefault();$("#confirmReplacementeCardModal").modal("hide");var r=this,i=$(t.target),u=i.data("url"),f=i.data("eid"),e=i.data("tcid"),o=$("#tcId option:selected").text(),s={eCardGuid:f,tcid:e,courseMoudules:"",TCName:o};jQuery.post(u,s,function(n){var t="#completeReplacement";$(t).toggleClass("hide",!1);r.render(n,t);$("#searchreplacement").toggleClass("hide",!0)}).fail(function(t){n.showResponseError("divSearchError","errlist",t)})},clearSearch:function(t){t.preventDefault();var i=this;$("#divSearchError").toggleClass("hide",!0);$("#firstname").val("");$("#lastname").val("");$("#email").val("");$("#ecode").val("");$("#tcId").val("");n.focusMessage()}}},AppStudentECard=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon,i=!1,t=!1,r=function(){var t,i;return $("#claimError").html(""),$("#claimError").addClass("hide"),t=[],$("#answer").length>0&&$("#question").length>0&&($("#question option:selected").val()||(t[t.length]=window.resources.TextSecurityQuestionRequired),i=$("#answer").val().trim(),i&&"0"!==i||(t[t.length]=window.resources.TextSecurityAnswerRequired)),$("input[name=condition]:checked").val()||(t[t.length]=window.resources.TextUserTermsRequired),$("input[name=condition]:checked").val()==="no"&&(t[t.length]=window.resources.TextYouMustAgree),n.showResponseError("claimError","errlist",t)},u=function(){var i,t,r;return $("#surveyError").html(""),$("#surveyError").addClass("hide"),i=$("div.survey-questions"),t=[],i.each(function(){var n=$(this).find("input:checked");n.length===1&&t.push(n.val())}),r=[],(t.length>0&&i.length!==t.length||t.length===0)&&(r[r.length]=window.resources.TextCompleteAllSurvey.replace("{0}",i.length)),n.showResponseError("surveyError","errlist1",r)};return{init:function(){var n=this;$("#btnSubmit").on("click",n.loadSurvey);n.hideAlert()},myCards:function(t){t.preventDefault();var i=this,r=$(t.target),u=$("#hdnStudentId").val(),f=r.data("url");jQuery.get(f,{studentId:u},function(n){n&&n.length>0&&($("#divMyCards").html(n).toggleClass("hide",!1),$("#divClaimedCard").toggleClass("hide",!0),i.cardsFilter())}).error(function(t){n.showResponseError("claimError","errlist",t)})},SetFilter:function(){var t=this,n;t.cardsFilter();n=$(".grid").isotope({layoutMode:"fitRows"});filterText=window.resources.TextAll;n.isotope({filter:""});$("#nowShowingText").html(filterText)},updateOptIn:function(t,i){var r=this,u=$(t.target),f=u.data("url");if(isECCOptIn=$("input[id='chkEccOpt']").prop("checked"),isAHAOptIn=$("input[id='chkAhaOpt']").prop("checked"),r.hideAlert(),$("#divWarningAlert").toggleClass("hide",!0),$("#divUpdateAlert").toggleClass("hide",!0),$("#hidIsECCOptIn").val().toLowerCase()==isECCOptIn.toString()&&$("#hidIsAHAOptIn").val().toLowerCase()==isAHAOptIn.toString())return $("#divWarningAlert").toggleClass("hide",!1),!1;jQuery.post(f,{studentId:i,isECCOptIn:isECCOptIn,isAHAOptIn:isAHAOptIn},function(t){t&&t.length>0&&($("#hidIsECCOptIn").val(isECCOptIn),$("#hidIsAHAOptIn").val(isAHAOptIn),$("#divUpdateAlert").toggleClass("hide",!1),n.focusMessage())}).error(function(t){n.showResponseError("updateOptError","errlist",t)})},loadSurvey:function(t){if(t.preventDefault(),!r())return!1;var i=$(t.target),u=$("#hdnCourseId").val(),f=$("#hdnModuleIds").val(),e=i.data("url");jQuery.get(e,{courseId:u,moduleIds:f},function(n){n&&n.length>0&&($("#divSurvey").html(n).toggleClass("hide",!1),$("#diveCardInfo").toggleClass("hide",!0))}).error(function(t){n.showResponseError("claimError","errlist",t)})},claimCard:function(n){var t=$(n),i,f;return r()?(i=t.prop("id")==="btnClaim",i&&!u())?!1:(t.attr("disabled","disabled"),t.removeAttr("onclick"),t.removeAttr("href"),f=t.data("url"),this.submitClaim(f,i),!1):!1},submitClaim:function(t,i){this.buildRequest(i);jQuery.post(t,window.claimModel,function(n){n&&(window.location.href=n)}).error(function(t){n.showResponseError("surveyError","errlist1",t)})},updateSurvey:function(n){var t=$(n),i=t.prop("id")==="btnClaim",r;return i&&!u()?!1:(t.attr("disabled","disabled"),t.removeAttr("onclick"),t.removeAttr("href"),r=t.data("url"),this.submitSurvey(r,i),!1)},submitSurvey:function(t,i){this.buildRequest(i);jQuery.post(t,window.claimModel,function(t){t.IsError?n.showResponseError("surveyError","errlist1",t.Message):($("#divSurveySuccess").toggleClass("hide",!1),$("#hSuccessMsg").text(t.Message),$("#divSurvey").toggleClass("hide",!0))}).error(function(t){n.showResponseError("surveyError","errlist1",t)})},getTimezone:function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},buildRequest:function(n){var i=this,t;if(window.claimModel.CourseId=$("#hdnCourseId").val(),window.claimModel.ClaimType=$("#hdnClaimType").val(),window.claimModel.SecurityQuestions=[],$("#answer").length>0&&$("#question").length>0&&(window.claimModel.SecurityQuestions.push({QuestionId:$("#question option:selected").val(),Answer:$("#answer").val()}),window.claimModel.StudentECard.HasSecurityQA=!0),window.claimModel.StudentLog.IsTermsAccepted=$("input[name=condition]:checked").val()==="yes",window.claimModel.StudentLog.TimeZone=i.getTimezone(),window.claimModel.StudentECard.Phone=$("#phone").val(),window.claimModel.StudentECard.ECardUID=$("#hdneCardUId").val(),window.claimModel.StudentECard.CertificateId=$("#hdnCertificateId").val(),window.claimModel.StudentECard.IssuedDate="",window.claimModel.StudentECard.ExpiryDate="",window.claimModel.StudentECard.LastActivityDate="",window.claimModel.StudentECard.IsActiveCourse=$("#hdnIsActiveCourse").val(),window.claimModel.StudentECard.IsECCOptIn=$("input[id='chkEccOpt']").prop("checked"),window.claimModel.StudentECard.IsAHAOptIn=$("input[id='chkAhaOpt']").prop("checked"),window.claimModel.SurveyQuestions=[],!n)return!1;t=$("div.survey-questions");t.each(function(){var n=$(this).find("input:checked"),t;n.length===1&&(t=$(this).data("questionid"),window.claimModel.SurveyQuestions.push({QuestionId:t,SurveyOptions:[{OptionId:n.prop("id"),Value:n.val(),IsSelected:!0}]}))})},btnEmail_Click:function(n){var t,i,r;n.preventDefault();t=this;$("#myModal").modal("show");$("#userEmail").val("");i=$(n.target);r={ECardUId:i.data("eid"),StudentId:i.data("stuid"),EmailAddress:""};$("#btnEmailECard").off("click");$("#btnEmailECard").on("click",r,$.proxy(t.sendEmail,t))},sendEmail:function(t){var u,r,i,f;if(t.preventDefault(),u=this,r=t.data,r.EmailAddress=$("#userEmail").val(),i=[],r.EmailAddress||(i[i.length]=window.resources.TextEmailRequired),r.EmailAddress&&!u.validateEmail(r.EmailAddress)&&(i[i.length]=window.resources.TextInvalidEmail),i.length>0)return n.showResponseError("emailError","emailErr",i);f=window.serverAddress+"/ecard/email";jQuery.post(f,r,function(n){n&&$("#myModal").modal("hide")}).error(function(t){n.showResponseError("emailError","emailErr",t)})},validateEmail:function(n){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/igm.test(n)},cardsFilter:function(){var n=$(".grid").isotope({layoutMode:"fitRows"});$(".filter-button-group").on("click",".filter--link",function(t){var r,i;t.preventDefault();r=$(this).attr("data-filter");n.isotope({filter:r});switch(r){case".active":i=window.resources.TextActive;break;case".inactive":i=window.resources.TextInactive;break;case".unclaim":i=window.resources.TextUnclaimed;break;default:i=window.resources.TextAll}$("#nowShowingText").html(i)});$(".sort_old").on("click",function(t){t.preventDefault();n.isotope({getSortData:{crdate:function(n){return Date.parse($(n).find(".crdate").text())}},sortBy:"crdate",sortAscending:!1});n.isotope("updateSortData").isotope()});$(".sort_new").on("click",function(t){t.preventDefault();n.isotope({getSortData:{date:function(n){return Date.parse($(n).find(".renewdate").text())}},sortBy:"date",sortAscending:!1});n.isotope("updateSortData").isotope()})},callAPI:function(n,t,i,r,u){n==="get"?$.get(t,i,r).error(function(n){u(n)}):$.post(t,i,r).error(function(n){u(n)})},isValidStudent:function(){var e=this,t=[],r=$("#first").val(),u=$("#last").val(),i=$("#emailAddress").val(),f=$("#ecardcode").val();return r||u||i?f?t[t.length]=window.resources.TextEnterData2:r&&u&&i?e.validateEmail(i)||(t[t.length]=window.resources.TextInvalidEmail):t[t.length]=window.resources.TextProvideAllValues:f||(t[t.length]=window.resources.TextEnterData1),n.showResponseError("divSearchErr","errlist",t)},validateStudentInfo:function(n){var t;if(n.preventDefault(),$("#divSearchErr").toggleClass("hide",!0),$("#divFindTc").toggleClass("hide",!0),t=this,!t.isValidStudent())return!1;var i=$(n.target),r=i.data("url"),u={fName:$("#first").val(),lName:$("#last").val(),email:$("#emailAddress").val(),code:$("#ecardcode").val()};t.callAPI("get",r,u,$.proxy(t.loadResult,t),t.failSearchResp)},loadEditECard:function(n){n.preventDefault();var t=this,i=$(n.target),r=i.data("url"),f=i.data("cid"),u={cid:i.data("cid")};t.callAPI("get",r,u,$.proxy(t.loadEditResult,t),t.failSearchResp)},loadEditQA:function(n,t){n.preventDefault();var i=this,r=$(n.target),u=r.data("url"),f={studentId:t};i.callAPI("get",u,f,$.proxy(i.loadEditQAResult,i),i.failSearchResp)},loadEditQAResult:function(n){n&&n.length>0&&($("#divSecurity").toggleClass("hide",!0),$("#divMyCards").toggleClass("hide",!0),$("#divClaimedCard").toggleClass("hide",!0),$("#divEditEcard").toggleClass("hide",!0),$("#divEditStduentQA").toggleClass("hide",!1).html(n))},createStudentQA:function(n){var i;n.preventDefault();$("#divEditQAError, #divEditQAAlert").toggleClass("hide",!0);var t=this,r=$(n.target),u=r.data("url"),f=$("#securityQues").val(),e=$("#hdnStudentId").val(),o=$("#securityAns").val();if(!t.validateEditQA())return!1;i={studentId:e,questionId:f,answer:o};t.callAPI("post",u,i,$.proxy(t.loadCreateSecurityResult,t),t.failCreateSecurityResp)},saveStudentQA:function(n){var i;n.preventDefault();$("#divEditQAError, #divEditQAAlert").toggleClass("hide",!0);var t=this,r=$(n.target),u=r.data("url"),f=$("#securityQues").val(),e=$("#hdnStudentId").val(),o=$("#securityAns").val();if(!t.validateEditQA())return!1;i={studentId:e,questionId:f,answer:o};t.callAPI("post",u,i,t.onSuccessSaveStudentQA,t.onSaveStudentQAFailed)},onSuccessSaveStudentQA:function(t){t&&($("#divEditQAAlert").toggleClass("hide",!1),$("#divSuccessMessage").text(window.resources.TextStudentQAUpdateSuccess),n.focusMessage())},onSaveStudentQAFailed:function(t){n.showResponseError("divEditQAError","errlist1",t)},showPendingRequest:function(n){var t=this;if(n){$("#assignModel").modal("show");$("#requestedFname").val(n.NewFirstName==""?n.CurrentFirstName:n.NewFirstName);$("#requestedLname").val(n.NewLastName==""?n.CurrentLastName:n.NewLastName);$("#requestedemailaddress").val(n.NewEmail==""?n.CurrentEmail:n.NewEmail);$("#requestedreason").val(n.Reason);$("#assignModel").on("shown.bs.modal",t.focus)}},focus:function(){var n=$(this);n.find("#btnClose").focus()},getPendingRequest:function(n){n.preventDefault();var t=this,i=$(n.target),r=i.data("url"),u=i.data("studentid"),f={studentId:u};t.callAPI("get",r,f,$.proxy(t.showPendingRequest,t),t.failSearchResp)},loadEditResult:function(n){n&&n.length>0&&($("#divSecurity").toggleClass("hide",!0),$("#divMyCards").toggleClass("hide",!0),$("#divClaimedCard").toggleClass("hide",!0),$("#divEditStduentQA").toggleClass("hide",!0),$("#divEditEcard").toggleClass("hide",!1).html(n))},reasonChange:function(){$("#reason").val().toLowerCase()=="other"?$("#divOther").toggleClass("hide",!1):$("#divOther").toggleClass("hide",!0)},LoadAlleCard:function(t){t.preventDefault();var i=this,r=$(t.target),u=$("#hdnStudentId").val(),f=r.data("url");jQuery.get(f,{studentId:u},function(n){n&&n.length>0&&($("#divEditEcard").toggleClass("hide",!0),$("#divEditStduentQA").toggleClass("hide",!0),$("#ecardSearchWrapper").toggleClass("hide",!0),$("#divSecurity").html(n).toggleClass("hide",!1),$("#divMyCards").html(n).toggleClass("hide",!1),i.cardsFilter())}).error(function(t){n.showResponseError("claimError","errlist",t)})},validateEditQA:function(){var r=this,t=[],i;return $("#securityAns").length>0&&$("#securityQues").length>0&&($("#securityQues option:selected").val()||(t[t.length]=window.resources.TextSecurityQuestionRequired),i=$("#securityAns").val().trim(),i&&"0"!==i||(t[t.length]=window.resources.TextSecurityAnswerRequired)),n.showResponseError("divEditQAError","errlist1",t)},validateCodes:function(t){var i,u,f,r,e;if(t.preventDefault(),i=this,u=$(t.target),$("#divSearchErr").toggleClass("hide",!0),$("#divFindTc").toggleClass("hide",!0),f=u.data("url"),r=$("#ecardcodeemp").val(),!r)return n.showResponseError("divSearchErr","errlist",window.resources.TextInvalideCardCode);e={codes:r};i.callAPI("post",f,e,$.proxy(i.loadResult,i),i.failSearchResp)},loadResult:function(t){var u=this,i,r;t&&t.length>0?($("#ecardSearchWrapper").toggleClass("hide",!0),$("#divSecurity").toggleClass("hide",!1).html(t),$(".grid").length>0&&u.cardsFilter(),$("#tblECards").length>0&&(i=$("#tblECards").DataTable(),i.context.length>0&&(r=new $.fn.dataTable.Buttons(i,{buttons:[{extend:"excelHtml5",title:n.getFileName("Student eCards"),exportOptions:{columns:[1,2,3,4]}}]}),$("#divDownload").prepend(r.container()).find("a.dt-button").addClass("btn btn-primary").text(window.resources.TextDownloadList),r.container().css("display","inline-block")))):t&&t.Status=="Warning"&&($("#divFindTc").toggleClass("hide",!1),$("#lnkFind").focus())},failSearchResp:function(t){n.showResponseError("divSearchErr","errlist",t)},hideAlert:function(){$("#divAlert .close").off("click");$("#divAlert .close").on("click",function(){$(this).parent().toggleClass("hide",!0)});$("#divUpdateAlert .close").off("click");$("#divUpdateAlert .close").on("click",function(){$(this).parent().toggleClass("hide",!0)})},forgotAnswer:function(n){n.preventDefault();var t=this,i=$(n.target),r=i.data("url"),u={studentId:i.data("stuid")};t.callAPI("get",r,u,$.proxy(t.loadSecurityResult,t),t.failSecurityResp)},sendSecurityAnswer:function(n){$("#divSendAnswerErr").toggleClass("hide",!0);n.preventDefault();var t=this,i=window.serverAddress+"/student/forgotanswer",r={"":$("#email").data("stuid")};t.callAPI("post",i,r,t.onSuccessSending,t.onFailSending)},onSuccessSending:function(n){n&&$("#divAlert").toggleClass("hide",!1)},onFailSending:function(t){$("#claimedCardError").length>0?n.showResponseError("claimedCardError","errlist1",t):n.showResponseError("divSendAnswerErr","errlist2",t)},gobackToSecurity:function(){$("#divConfirmSecurity").toggleClass("hide",!1);$("#divSecurityResult, #divQuestionError").html("").toggleClass("hide",!0)},verifyAccount:function(n){n.preventDefault();var t=this,i=$(n.target),r=i.data("url"),u={studentId:i.data("stuid"),answer:$("#answer").val()};t.callAPI("post",r,u,$.proxy(t.loadSecurityResult,t),t.failSecurityResp)},loadSecurityResult:function(n){var i=this,t,r,u;if(n&&n.length>0)$("#divConfirmSecurity").toggleClass("hide",!0),$("#divSecurityResult").toggleClass("hide",!1).html(n),i.hideAlert(),$(".grid").length>0&&i.cardsFilter();else if(n&&n.Status=="Warning")return t=$("#divQuestionError"),t.html(""),u=window.isInternational,r=u=="True"?'<button type="button" class="close" aria-label="Close"><span aria-hidden="true">&times;<\/span><\/button><div class="alert-notification"><p>'+window.resources.TextError+"<\/p><div><ul>"+n.WarningMessage+"<\/ul><\/div><\/div>":'<button type="button" class="close" aria-label="Close"><span aria-hidden="true">&times;<\/span><\/button><div class="alert-notification"><p>'+window.resources.TextError+'<\/p><div><ul id="errlist1">'+window.resources.TextInvalidSecurityAnswer+'<br/><br/><div style="padding-left: 4em;"><li>'+window.resources.TextInvalidSecurityAnswerLine1+"<\/li><li>"+window.resources.TextInvalidSecurityAnswerLine2+"<\/li><\/div ><\/ul ><\/div ><\/div > ",t.append(r),t.toggleClass("hide",!1),t.removeClass("alert-warning"),t.toggleClass("alert-danger",!0),$("html, body").animate({scrollTop:$("#top-header").offset().top},1e3),!1},failSecurityResp:function(t){n.showResponseError("divQuestionError","errlist1",t)},loadCreateSecurityResult:function(t){var r=this,i;t&&t.length>0?($("#divCreateSecurity").toggleClass("hide",!0),$("#divCreateSecurityResult").toggleClass("hide",!1).html(t),r.hideAlert(),$(".grid").length>0&&r.cardsFilter()):t&&t.Status=="Warning"&&(i=[],i[i.length]=t.WarningMessage,n.showResponseError("divEditQAError","errlist1",i))},failCreateSecurityResp:function(t){n.showResponseError("divEditQAError","errlist1",t)},verifyMoreCards:function(n){n.preventDefault();$("#ecardSearchWrapper").toggleClass("hide",!1);$("#divSecurity").html("").toggleClass("hide",!0);$(n.target).prop("id")!=="lnkBack"&&$("#ecardcodeemp").val("")},selectAll:function(n){$("#tblECards").find("tr").each(function(t){if(t!=0){var i=$(this).find("input");i[0]&&(i[0].checked=$(n.target).prop("checked"))}})},validateEdit:function(){var c=this,r=[],u;if(i==!0||$("#hdnIsProfileUpdatePending").val()=="True")return r[r.length]=window.resources.TextProfileUpdateWarning,n.showResponseError("divEditError","errlist1",r);u=!1;window.EditEcardInfo={};var e=window.EditEcardInfo.NewFirstName=$("#fname").val(),o=window.EditEcardInfo.NewLastName=$("#lname").val(),f=window.EditEcardInfo.NewEmail=$("#emailaddress").val(),s=window.EditEcardInfo.Reason=$("#reason").val(),h=$("#txtOther").val();return window.EditEcardInfo.Phone=$("#phone").val(),window.EditEcardInfo.CertificateId=$("#hdnCertificateId").val(),window.EditEcardInfo.ECardId=$("#hdnEcardId").val(),window.EditEcardInfo.TcId=$("#hdnTcId").val(),window.EditEcardInfo.StudentId=$("#hdnStudentId").val(),window.EditEcardInfo.IsUpdateAllCards=$("input[id='chkUpdateAll']").prop("checked"),e||(r[r.length]=window.resources.TextFirstNameRequired),o||(r[r.length]=window.resources.TextLastNameRequired),f?c.validateEmail(f)||(r[r.length]=window.resources.TextInvalidEmail):r[r.length]=window.resources.TextEmailRequired,s||(r[r.length]=window.resources.TextReasonRequired),s.toLowerCase()=="other"&&(h?window.EditEcardInfo.Reason=h:r[r.length]=window.resources.TextReasonRequired),$.trim(e)!=$("#hdnFirstName").val()||$.trim(o)!=$("#hdnLastName").val()||$.trim(f)!=$("#hdnEmail").val()?t=!0:$.trim($("#phone").val())!=$("#hdnPhone").val()&&(u=!0),window.EditEcardInfo.IsProfileDateUpdated=t,r.length==0&&(t==!1&&u==!1?r[r.length]=window.resources.TextNoChangesToSave:i=!0),n.showResponseError("divEditError","errlist1",r)},onSuccessSave:function(r){r&&($("#divEditAlert").toggleClass("hide",!1),t?$("#divMessage").text(window.resources.TextApprovalPendingMessage):(i=!1,$("#divMessage").text(window.resources.TextMobileUpdateMessage)),$("#btnSaveEdit").prop("disabled",!0),n.focusMessage())},onEditCardFailed:function(t){n.showResponseError("divEditError","errlist1",t)},saveInfo:function(n){n.preventDefault();$("#divEditError, #divEditAlert").toggleClass("hide",!0);var t=this,i=$(n.target),r=i.data("url");if(!t.validateEdit())return!1;t.callAPI("post",r,window.EditEcardInfo,t.onSuccessSave,t.onEditCardFailed)},downloadeCards:function(t){var r,f,i;t.preventDefault();$("#loaderModal").modal("show");$("#divError").toggleClass("hide",!0);var s=this,e=$(t.target),o=e.data("url"),u=[];if($("#tblECards").find("tr").each(function(n){if(n!=0){var t=$(this).find("input");t[0]&&t[0].checked&&u.push(t[0].value)}}),u=="")return r=[],r[r.length]=window.resources.TextSelectToDownload,n.showResponseError("divError","errlist",r),$("#loaderModal").modal("hide"),!1;f=JSON.stringify({eCardCodes:u});i=new XMLHttpRequest;i.open("Post",o,!0);i.setRequestHeader("Content-Type","application/json; charset=utf-8");i.responseType="blob";i.onreadystatechange=function(){if(this.readyState==4){var n=new Blob([this.response],{type:"application/octet-stream"});saveAs(n,"Student_eCards.zip");$("#loaderModal").modal("hide")}};i.send(f)},printeCard:function(n){n.preventDefault();var t=$(n.target).data("cid"),i="";i=t>=0?$("#ddlTemplates"+t).val():$("#ddlTemplates").val();window.open(i,"_blank")}}},AppSearchStudent=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon;return{init:function(){var n=this;$(document).ready(function(){$("#confirmUpdateModal").on("shown.bs.modal",n.focus)})},focus:function(){var n=$(this);n.find("#btnClose").focus()},callAPI:function(n,t,i,r,u){n==="get"?$.get(t,i,r).error(function(n){u(n)}):$.post(t,i,r).error(function(n){u(n)})},validateEmail:function(n){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/igm.test(n)},validateSearch:function(){var t=[],r=window.searchStudentModel.FirstName=$("#firstname").val(),u=window.searchStudentModel.LastName=$("#lastname").val(),i=window.searchStudentModel.Email=$("#email").val();return r||u||i||(t[t.length]=window.resources.TextAtleastOneValue),i&&!this.validateEmail(i)&&(t[t.length]=window.resources.TextInvalidEmail),n.showResponseError("divSearchError","errlist",t)},searchStudents:function(n){var t,i,r;if(n.preventDefault(),t=this,!t.validateSearch())return!1;$("#divAlert, #divSearchError").toggleClass("hide",!0);i=window.searchStudentModel;r=$("#hdnSearchUrl").val();t.callAPI("post",r,i,t.onLoadResult,t.onFailSearch)},onLoadResult:function(t){$("#divSearchResult").toggleClass("hide",!1).html(t);$("#tblSearchStudent").DataTable();$("#divAlert").is(":visible")?n.focusMessage():$("html, body").animate({scrollTop:$("#titleResults").offset().top-55},1e3)},onFailSearch:function(t){n.showResponseError("divSearchError","errlist",t)},clearSearch:function(t){t.preventDefault();$("#divSearchError, #divSearchResult, #divEditStudent").html("");$("#firstname, #lastname, #email").val("");$("#divSearchError, #divAlert").toggleClass("hide",!0);window.searchStudentModel={};n.focusMessage()},editStudent:function(n){n.preventDefault();$("#divEditError, #divEditAlert").toggleClass("hide",!0);var t=this,i=$(n.target.parentElement),r=i.data("url"),u={studentId:i.data("uid")};t.callAPI("get",r,u,$.proxy(t.onLoadingEditStudent,t),t.onFailSearch)},onLoadingEditStudent:function(t){t&&t.length>0&&($("#divSearch").toggleClass("hide",!0),$("#divEditStudent").toggleClass("hide",!1).html(t),$("#tblEditStudent").DataTable(),n.focusMessage())},validateEdit:function(){var t=[],i=$("#reasonCode").val().trim(),r=$("#reason").val().trim();return r||(t[t.length]=window.resources.TextReasonRequired),i||(t[t.length]=window.resources.TextReasonCodeRequired),window.searchStudentModel.AnonymizeActiveECads=$("input[name='chkStudentECards']:checked").length>0,window.searchStudentModel.ReasonCode=i,window.searchStudentModel.Reason=r,window.searchStudentModel.StudentId=$("#hdnStudentId").val(),n.showResponseError("divEditError","errlist1",t)},confirmSave:function(n){n.preventDefault();var t=this;if($("#divEditError, #divEditAlert, #divUpdateStudent").toggleClass("hide",!0),!t.validateEdit())return!1;$("#confirmUpdateModal").modal("show");$("#btnOk").off("click");$("#divUpdateStudent").toggleClass("hide",!1);$("#btnOk").on("click",$.proxy(t.saveInfo,t));return!1},saveInfo:function(n){n.preventDefault();$("#confirmUpdateModal").modal("hide");$("#divEditError, #divEditAlert").toggleClass("hide",!0);var t=this,i=$("#hdnStudentInfoUrl").val();if(!t.validateEdit())return!1;t.callAPI("post",i,window.searchStudentModel,t.onSuccessSave,t.onEditCardFailed)},onSuccessSave:function(t){t&&t.length>0&&($("#divEditAlert").toggleClass("hide",!1),n.focusMessage())},onEditCardFailed:function(t){n.showResponseError("divEditError","errlist1",t)},loadSearch:function(n){n.preventDefault();$("#divSearch").toggleClass("hide",!1);$("#divEditStudent").html("").toggleClass("hide",!0);$("#btnSearchStudents").trigger({type:"click"})}}},AppEcardStatus=function(){$.ajaxSetup({async:!0,cache:!1});var t=!0,i=!1,n=new AppCommon,r=function(){var s;$("#statusErr").html("");$("#statusErr").toggleClass("hide",!0);var t=[],o=$("#courseId option:selected").val(),u=$("#ddlSource option:selected").val(),i=$("input[name=transBy]:checked").val(),r=$("#profileId option:selected").val(),f=$("#eCardStatusForm").find('input[id="StartDate"]').val(),e=$("#eCardStatusForm").find('input[id="EndDate"]').val();return i==="fromLoc"&&r&&r==window.RoleType.Instructor.value&&(u=$("#ddlLocation option:selected").val()),f&&e||(t[t.length]=window.resources.TextTransactionsDatesRequired),(f||e)&&!n.isValidDate(f,e)&&(t[t.length]=n.getDateFormatError(window.resources.TransactionDate)),(i==="fromIns"||i==="fromLoc"||i==="fromDist"||i==="fromTc")&&((!o||o.length<=0)&&(t[t.length]=window.resources.TextCourseRequired),(!u||u<=0)&&(i==="fromIns"&&(t[t.length]=window.resources.TextInstructorRequired),i==="fromLoc"&&(s=$("#ddlSource option:selected").val(),t[t.length]=r&&r==window.RoleType.Instructor.value&&!s?window.resources.TextTrainingCenterRequired:window.resources.TextLocationRequired),i==="fromDist"&&(t[t.length]=window.resources.TextDistributorRequired),i==="fromTc"&&(t[t.length]=window.resources.TextTrainingCenterRequired))),n.showResponseError("statusErr","errlist",t)};return{init:function(){var n=this,t;$("#divOptions").toggleClass("hide",!0);$("#lnkAdvanced").toggleClass("hide",!0);$("input[type=radio][name=transBy]").on("change",function(t){n.toggleOptions(t)});$("input[type=radio][name=instType]").on("change",function(t){n.toggleInstrStatus(t)});$("#lnkAdvanced").on("click",n.showHideOptions);$("#divECardStatus").on("change","#profileId",$.proxy(n.changeProfile,n));$("#divECardStatus").on("change","#ddlSource",$.proxy(n.changeTC,n));t=$("#profileId option:selected").val();$("#radioTc, #radioDist, #radioInst, #radioLoc").toggleClass("hide",!0);t&&t==window.RoleType.Instructor.value?$("#radioTc, #radioLoc").toggleClass("hide",!1):$("#radioDist, #radioInst, #radioLoc").toggleClass("hide",!1);$("#courseId").on("change",$.proxy(n.changeCourse,n));$("#ddlVAMCourse").on("change",$.proxy(n.changeVAMCourse,n));$(".datepicker").on("change",function(){i=!0});$(document).ready(function(){n.searchTransactions(!0)});n.initMultiSelect()},initMultiSelect:function(){$("#courseId").multiselect({buttonWidth:"100%",disableIfEmpty:!1,includeSelectAllOption:!0,selectAllText:window.resources.TextSelectAll,allSelectedText:window.resources.TextAllSelected,nonSelectedText:window.resources.SelectCourses,nSelectedText:" "+window.resources.TextSelectedCourses});$("#ddlVAMCourse").multiselect({buttonWidth:"100%",disableIfEmpty:!1,includeSelectAllOption:!0,selectAllText:window.resources.TextSelectAll,allSelectedText:window.resources.TextAllSelected,nonSelectedText:window.resources.SelectCourses,nSelectedText:" "+window.resources.TextSelectedCourses})},toggleInstrStatus:function(n){var t=this,u=$(n.target);t.clearErrorMsg();var f=u.val(),e=$("#courseId").find(":selected").map(function(n,t){return t.value}).get().join(","),i=window.resources.TextSelectInstructor,o=$("input[id=inst]:radio").data("url"),s={courseIds:e,isActive:f==="act"?!0:!1},r=[];r.push($("<option/>",{value:"",text:i}));$("#ddlSource").empty().append(r).val("");t.renderSource(o,s,"#ddlSource",i)},toggleOptions:function(t){var s=this,o,f,r,u,c;s.clearErrorMsg();var i=$(t.target),e=$("#courseId").find(":selected").map(function(n,t){return t.value}).get().join(","),h=$("#profileId option:selected").val();if(!e||e==="0")return i.prop("checked",!1),n.showResponseError("statusErr","errlist",window.resources.TextCourseRequired);if(o=i.data("url"),$("#divInstType").toggleClass("hide",i.val()!=="fromIns"),$("input[id=radActive]:radio").prop("checked",i.val()==="fromIns"),i.val()==="fromLoc"){if(h&&h==window.RoleType.Instructor.value)return $("#ddlLocation, #ddlSource, #ddlTransType").val(""),$("#divLoc").toggleClass("hide",!0),f={courseIds:e},o=$("#tc").data("url"),r=window.resources.TextTrainingCenter,$("#lblSource").text(r).append("<span class='required'> * <\/span>"),u=window.resources.SelectTrainingCenter,s.renderSource(o,f,"#ddlSource",u),$("#divSource, #divTransactionType").toggleClass("hide",!1),!1;r=window.resources.TexteCardLocation;f={tcId:null};u=window.resources.TextSelecteCardLocation}i.val()==="fromIns"?(r=window.resources.TextInstructor,u=window.resources.TextSelectInstructor,c=$("input[name=instType]:checked").val(),f={courseIds:e,isActive:c==="act"?!0:!1}):i.val()==="fromDist"?(r=window.resources.TextDistributor,u=window.resources.TextSelectDistributor):i.val()==="fromTc"&&(f={courseIds:e},r=window.resources.TextTrainingCenter,u=window.resources.SelectTrainingCenter,$("#ddlLocation, #ddlSource, #ddlTransType").val(""),$("#divLoc").toggleClass("hide",!0));$("#lblSource").text(r).append("<span class='required'> * <\/span>");$("#divSource, #divTransactionType").toggleClass("hide",!1);$("#ddlTransType").val("");$("#ddlSource").empty().val("");$("#ddlLocation").empty().val("");s.renderSource(o,f,"#ddlSource",u)},renderSource:function(t,i,r,u){var f=[];f.push($("<option/>",{value:"",text:u}));jQuery.get(t,i?i:null,function(n){n&&n.length>0&&$.each(n,function(n,t){f.push($("<option/>",{value:t.Id,text:t.Name}))});$(r).empty().append(f).val("")}).error(function(t){$(r).empty().append(f).val("");n.showResponseError("statusErr","errlist",t)})},showHideOptions:function(n){t=!t;var i=$(n.target).find("span.caret");return setTimeout(function(){var n=$("#profileId option:selected").val();n&&n==window.RoleType.Instructor.value&&!t&&$("#radioTc").toggleClass("hide",!1);$("#divOptions").toggleClass("hide",t)},100),i.toggleClass("rotate",!t),!1},changeCourse:function(t){var r=this,u=$("#courseId").find(":selected").map(function(n,t){return t.value}).get().join(","),f=$(t.target).data("url"),e=$("#profileId option:selected").val()==window.RoleType.Instructor.value,o=$("#courseId").find(":selected").map(function(n,t){return $(t).data("isparent")}).get().join(",");o=="True"?($("#divVAMCourse").toggleClass("hide",!1),jQuery.get(f,{courseId:u,isInstructor:e},$.proxy(r.loadVAMCourse,r)).error(function(t){n.showResponseError("statusErr","errlist",t)})):($("#divVAMCourse").toggleClass("hide",!0),$("#ddlVAMCourse").multiselect("deselectAll",!1).multiselect("refresh"));i=!0;r.clearErrorMsg();r.clearSearchOptions(!0);u&&$("#lnkAdvanced").toggleClass("hide",!1)},changeProfile:function(n){var t=$(n.target).val();window.location.href=$("#hdnProfileUrl").val()+"?profileId="+t},changeTC:function(n){var r=this,t=$(n.target).val(),i=$("#profileId option:selected").val(),u=$("input[name=transBy]:checked").val();if(i&&i==window.RoleType.Instructor.value&&u!=="fromTc")if(t){var f={tcId:t},e=$("#eLoc").data("url"),o=window.resources.TextSelecteCardLocation;r.renderSource(e,f,"#ddlLocation",o);$("#divLoc").toggleClass("hide",!1)}else $("#ddlLocation").val(""),$("#divLoc").toggleClass("hide",!0);else return},clearErrorMsg:function(){$("#statusErr").html("");$("#statusErr").toggleClass("hide",!0)},clearSearchOptions:function(r){return this.clearErrorMsg(),$("#ddlSource").empty().val(""),$("#ddlLocation").empty().val(""),t=!0,$("#lnkAdvanced").find("span.caret").toggleClass("rotate",!1),$("#lnkAdvanced").toggleClass("hide",!0),$("#ddlTransType").val(""),$("#divOptions").toggleClass("hide",!0),$("input[type=radio][name=transBy]").prop("checked",!1),$("input[type=radio][name=instType]").prop("checked",!1),$("#divTransactionType").toggleClass("hide",!0),$("#divSource").toggleClass("hide",!0),$("#divLoc").toggleClass("hide",!0),$("#divInstType").toggleClass("hide",!0),r||($("#courseId").multiselect("deselectAll",!1).multiselect("refresh"),$("#StartDate").datepicker("setDate",n.getMonthOldDate()),$("#EndDate").datepicker("setDate",n.getCurrentDate()),i=!1,this.searchTransactions(!0)),r||n.focusMessage(),!1},buildSearchRequest:function(){var r,u;window.eCardStatusViewModel.InstructorId=window.eCardStatusViewModel.LocationId=window.eCardStatusViewModel.DistributorId=window.eCardStatusViewModel.TrainingCenterId=window.eCardStatusViewModel.VAMCourseId=window.eCardStatusViewModel.TransactionType=null;r=$("#StartDate").val();u=$("#EndDate").val();window.eCardStatusViewModel.CourseId=$("#courseId").find(":selected").map(function(n,t){return t.value}).get().join(",");window.eCardStatusViewModel.StartDate=r;window.eCardStatusViewModel.EndDate=u;var n=$("input[name=transBy]:checked").val(),t=$("#ddlSource option:selected").val(),i=$("#profileId option:selected").val();window.eCardStatusViewModel.ProfileId=i;window.eCardStatusViewModel.VAMCourseId=$("#ddlVAMCourse").find(":selected").map(function(n,t){return t.value}).get().join(",");(n==="fromIns"||n==="fromLoc"||n==="fromDist"||n==="fromTc")&&(n==="fromTc"&&(window.eCardStatusViewModel.TrainingCenterId=t),n==="fromIns"&&(window.eCardStatusViewModel.InstructorId=t),n==="fromLoc"&&(window.eCardStatusViewModel.LocationId=i&&i==window.RoleType.Instructor.value?$("#ddlLocation option:selected").val():t),n==="fromDist"&&(window.eCardStatusViewModel.DistributorId=t),window.eCardStatusViewModel.TransactionType=$("#ddlTransType option:selected").val())},searchTransactions:function(t){if(!r())return!1;this.buildSearchRequest();var f=window.eCardStatusViewModel.ProfileId!=window.RoleType.Instructor.value,e=$("#btnSearch").data("url"),o=$("input[name=transBy]:checked").val(),u=this;return jQuery.post(e,window.eCardStatusViewModel,function(r){var e,s;if(r){$("#divResults").toggleClass("hide",!1);$("#divResults").html(r);e=$("#example").DataTable({columnDefs:[{targets:[7],visible:window.eCardStatusViewModel.CourseId.indexOf(",")<0&&!!window.eCardStatusViewModel.CourseId&&!o&&window.eCardStatusViewModel.VAMCourseId==0}]});e.context.length>0&&(s=new $.fn.dataTable.Buttons(e,{buttons:[{extend:"excelHtml5",title:n.getFileName(f?"Training Center eCard Status":"Instructor eCard Status"),exportOptions:{columns:":visible"}}]}),$("#exportbutton").prepend(s.container()).find("a.dt-button").addClass("btn btn-primary").text(window.resources.TextDownload));$("#spdaysView").toggleClass("hide",i);$("#example").on("click",".lnkecard",$.proxy(u.loadECards,u));t||n.focusArea("#divResults")}$('[data-toggle="popover"]').popover()}).error(function(t){n.showResponseError("statusErr","errlist",t)}),!1},loadFilterTargets:function(n){if(n&&n.length>0){var t=[];$.each(n,function(n,i){t.push($("<option/>",{value:i.Id,text:i.Name}))});$("#ddlSource").empty().append(t);$("#ddlSource").val("")}},loadVAMCourse:function(n){if(n&&n.length>0){var t=[];$.each(n,function(n,i){t.push($("<option/>",{value:i.CourseId,text:i.Name}))});$("#ddlVAMCourse").empty().append(t);$("#ddlVAMCourse").val("");$("#ddlVAMCourse").empty().append(t).multiselect("rebuild")}},changeVAMCourse:function(){var n=this;n.loadInstructor()},loadInstructor:function(){var u=this,f=$("#inst"),e=f.data("url"),t,i,r,n;i=window.resources.TextInstructor;r=window.resources.TextSelectInstructor;n=$("#ddlVAMCourse").find(":selected").map(function(n,t){return t.value}).get().join(",");n==""&&(n=$("#courseId").find(":selected").map(function(n,t){return t.value}).get().join(","));t={courseIds:n,isActive:!0};$("#lblSource").text(i).append("<span class='required'> * <\/span>");$("#divSource, #divTransactionType").toggleClass("hide",!1);$("#ddlTransType").val("");$("#ddlSource").empty().val("");$("#ddlLocation").empty().val("");u.renderSource(e,t,"#ddlSource",r)},loadECards:function(n){n.preventDefault();var t=this,i=$(n.target).data("transactionid");t.getECards(i)},getECards:function(t,i){var r=this,u=$("#profileId option:selected").val(),f=$("#hdnUrl").val();r.isSuccess=!!i;jQuery.get(f,{transactionId:t,profileId:u},$.proxy(r.populateECards,r)).error(function(t){n.showResponseError("statusErr","errlist",t)})},populateECards:function(t){var u=this,i,r;t&&($("#divStudentECards").toggleClass("hide",!1),$("#divECardStatus").toggleClass("hide",!0),$("#divStudentECards").html(t),u.isSuccess&&$("#divAlert").toggleClass("hide",!1),i=$("#tblECards").DataTable(),i.context.length>0&&(r=new $.fn.dataTable.Buttons(i,{buttons:[{extend:"excelHtml5",title:n.getFileName("Student eCards")}]}),$("[data-blocked]").closest("tr").addClass("blockedInRed"),$("#exportECard").prepend(r.container()).find("a.dt-button").addClass("btn btn-primary").text(window.resources.TextDownload),r.container().css("display","inline-block"),$("#lnkGoResults").click(u.NavigateToResults),n.focusMessage()))},NavigateToResults:function(t){t.preventDefault();$("#divStudentECards, #divEditCard").html("");$("#divStudentECards, #divEditCard").toggleClass("hide",!0);$("#divECardStatus").toggleClass("hide",!1);$("#divResults").is(":visible")?n.focusArea("#divResults"):n.focusArea("#partial")}}},AppTC=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon,t={},i={init:function(){var n=$('a[data-toggle="collapse"]');n.on("click",function(){n.delay(1e3).hasClass("collapsed")?i.hide(n):i.show(n)})},hide:function(n){n.children(".text").text("Hide Info");n.children(".fa").hasClass("fa-caret-up")?n.children(".fa").removeClass("fa-caret-up").addClass("fa-caret-down"):""},show:function(n){n.children(".text").text("Show Info");n.children(".fa").hasClass("fa-caret-down")?n.children(".fa").removeClass("fa-caret-down").addClass("fa-caret-up"):""}},r=function(){var u,f,e,o;$("#assignError").html("");$("#assignError").addClass("hide");var t=[],s=$("#CourseId option:selected").val(),h=$("#ddlTC option:selected").val(),i=$("#qty").val(),r=parseInt($("#availQty").text());(!s||s<=0)&&(t[t.length]=window.resources.TextCourseRequired);(!h||h<=0)&&(t[t.length]=window.resources.TextTrainingCenterRequired);switch(window.currentController.toLowerCase()){case"ecardlocationassignment":r<=0&&(t[t.length]=window.resources.TexteLocationLowInventory);u=$("#assignTo option:selected").val();(!u||u<=0)&&(t[t.length]=window.resources.TextLocationRequired);i&&i!="0"?(!jQuery.isNumeric(i)||Math.floor(i)!=i||parseInt(i)<=0)&&(t[t.length]=window.resources.TextAssignQtyPositiveInteger):t[t.length]=window.resources.TextAssignQuantityRequired;r>0&&parseInt(i)>r&&(t[t.length]=window.resources.TextExceedsInventory);break;case"instructorassignment":f=$("#hdnRole").val();f==="ECard Admin"&&(e=$("#ddlLoc option:selected").val(),(!e||e<=0)&&(t[t.length]=window.resources.TextLocationRequired));r<=0&&(t[t.length]=f==="ECard Admin"?window.resources.TexteLocationLowInventory:window.resources.TextInsufficiantInventory);o=$("#assignTo").multiselect("getSelected");(!o||o.length<=0)&&(t[t.length]=window.resources.TextMultiInstructorsRequired)}return n.showResponseError("assignError","errlist",t)},u=function(){window.tcAssignmentViewModel.LocationId=$("#assignTo option:selected").val();window.tcAssignmentViewModel.CourseId=$("#CourseId option:selected").val();window.tcAssignmentViewModel.TCId=$("#ddlTC option:selected").val();window.tcAssignmentViewModel.AssignedQty=$("#qty").val();window.tcAssignmentViewModel.AvailableQty=$("#availQty").text()};return{init:function(){var n=this,i=$("#CourseId option:selected").val(),t=$("#hdnRole").val();window.currentController.toLowerCase()==="instructorassignment"&&n.initMultiSelect();$("#RoleId").on("change",function(t){var i=$(t.target).val(),r=$(t.target).data("url");i>0&&($("#assignError, #divBox, #divTC,#divSite, #divLoc, #divAssignTo, #divSubmit").toggleClass("hide",!0),n.loadCourses(r,{roleId:i},window.resources.SelectCourse))});$("#CourseId").on("change",function(t){$("#assignError, #divBox, #divTC, #divSite, #divLoc, #divAssignTo, #divSubmit").toggleClass("hide",!0);var i=$(t.target).val(),r=$("#RoleId").val();i>0&&n.getTCList(i,r)});$("#ddlTC").on("change",function(i){$("#assignError, #divBox, #divLoc, #divAssignTo, #divSubmit").toggleClass("hide",!0);var u=$("#CourseId option:selected").val(),r=$(i.target).val(),f=$("#RoleId").val();r>0&&(window.currentController&&window.currentController.toLowerCase()==="instructorassignment"?t==="ECard Admin"?n.geteCardLocations(i,{tcId:r}):f==RoleType.TSC.value||f==RoleType.TSAdmin.value?n.getSites(i,{tcId:r,roleId:f}):(n.getAssignTo(i,{tcId:r,courseId:u},window.resources.SelectInstructors),n.getAvailableQty({tcId:r,courseId:u})):(n.loadLocation(i,{tcId:r},window.resources.TextSelecteCardLocation),n.getAvailableQty({tcId:r,courseId:u})))});$("#ddlLoc").on("change",function(t){$("#assignError, #divBox, #divAssignTo, #divSubmit").toggleClass("hide",!0);var i=$("#CourseId option:selected").val(),r=$("#ddlTC option:selected").val(),u=$(this).val();n.getAssignTo(t,{tcId:r,courseId:i},window.resources.SelectInstructors);n.getAvailableQty({tcId:r,courseId:i,locationOrSiteId:u})});$("#ddlSite").on("change",function(t){$("#assignError, #divBox, #divAssignTo, #divSubmit").toggleClass("hide",!0);var i=$("#CourseId option:selected").val(),r=$("#ddlTC option:selected").val(),u=$("#ddlSite").val(),f=$("#RoleId").val();n.getAssignTo(t,{tcId:r,courseId:i,roleId:f,tsId:u},window.resources.SelectInstructors);n.getAvailableQty({tcId:r,courseId:i,locationOrSiteId:u})})},initMultiSelect:function(){$("#assignTo").multiselect({buttonWidth:"100%",disableIfEmpty:!1,includeSelectAllOption:!0,selectAllText:window.resources.TextSelectAll,allSelectedText:window.resources.TextAllSelected,nonSelectedText:window.resources.SelectInstructors,nSelectedText:" "+window.resources.TextSelectedInstructors})},getTCList:function(t,i){var r=$("#CourseId").data("tc-url");jQuery.get(r,{courseId:t,roleId:i},function(n){if(n&&n.length>0){var t=[];t.push($("<option/>",{value:"",text:window.resources.SelectTrainingCenter}));$.each(n,function(n,i){t.push($("<option/>",{value:i.TrainingCenterId,text:i.Name}))});$("#divTC").toggleClass("hide",!1);$("#ddlTC").empty().append(t).val("")}}).error(function(t){n.showResponseError("assignError","errlist",t);$("#ddlTC").empty()})},geteCardLocations:function(t,i){var r=$(t.target).data("insturl");jQuery.get(r,i,function(n){if(n&&n.length>0){var t=[];t.push($("<option/>",{value:"",text:window.resources.TextSelecteCardLocation}));$.each(n,function(n,i){t.push($("<option/>",{value:i.Id,text:i.Name}))});$("#divLoc").toggleClass("hide",!1);$("#ddlLoc").empty().append(t).val("")}}).error(function(t){$("#ddlLoc").empty();n.showResponseError("assignError","errlist",t)})},loadLocation:function(t,i,r){var f=$(t.target).data("url"),u=[];u.push($("<option/>",{value:"",text:r}));jQuery.get(f,i,function(n){n&&n.length>0&&$.each(n,function(n,t){u.push($("<option/>",{value:t.Id,text:t.Name}))});$("#divAssignTo").toggleClass("hide",!1);$("#divSubmit").toggleClass("hide",!1);$("#assignTo").empty().append(u).val("")}).error(function(t){$("#divAssignTo").toggleClass("hide",!1);$("#assignTo").empty().append(u).val("");n.showResponseError("assignError","errlist",t)})},loadCourses:function(t,i,r){var u=[];u.push($("<option/>",{value:"",text:r}));jQuery.get(t,i,function(n){n&&n.length>0&&$.each(n,function(n,t){u.push($("<option/>",{value:t.Id,text:t.Name}))});$("#CourseId").empty().append(u).val("");$("#divCourse").toggleClass("hide",!1)}).error(function(){n.showResponseError("assignError","errlist",window.resources.TextNoCourseFoundPleaseReview)})},getSites:function(t,i){var r=$(t.target).data("siteurl");jQuery.get(r,i,function(n){if(n&&n.length>0){var t=[];t.push($("<option/>",{value:"",text:window.resources.TextSelectTrainingSite}));$.each(n,function(n,i){t.push($("<option/>",{value:i.Id,text:i.Name}))});$("#divSite").toggleClass("hide",!1);$("#ddlSite").empty().append(t).val("")}}).error(function(t){$("#ddlSite").empty();n.showResponseError("assignError","errlist",t)})},getAssignTo:function(t,i){var r=$(t.target).data("url");jQuery.get(r,i,function(n){if(n&&n.length>0){var t=[];$.each(n,function(n,i){t.push($("<option/>",{value:i.Id,text:i.Name}))});$("#divAssignTo").toggleClass("hide",!1);$("#divSubmit").toggleClass("hide",!1);$("#assignTo").empty().append(t).multiselect("rebuild")}}).error(function(t){$("#divAssignTo").toggleClass("hide",!1);$("#assignTo").empty().multiselect("rebuild");n.showResponseError("assignError","errlist",t)})},getAvailableQty:function(t){var i=$("#CourseId").data("url");$("#divBox").toggleClass("hide",!0);jQuery.get(i,t,function(n){n&&($("#divBox").toggleClass("hide",!1),$("#availQty").text(n))}).error(function(t){n.showResponseError("assignError","errlist",t)})},loadConfirmation:function(){$("#confirmError").html("");$("#confirmError").toggleClass("hide",!0);$("#tdCourse").html($("#CourseId option:selected").text());$("#tdTC").html($("#ddlTC option:selected").text());$("#tdlocation").html($("#assignTo option:selected").text());$("#tdAvailQty").html($("#availQty").text());$("#tdQty").html($("#qty").val())},loadCompletion:function(n){$("#completeAssignCards").toggleClass("hide",!1);$("#confirmAssignCards").toggleClass("hide",!0);$("#tdCompCourse").html($("#CourseId option:selected").text());$("#tdCompTC").html($("#ddlTC option:selected").text());$("#tdComplocation").html($("#assignTo option:selected").text());$("#tdCompQty").html($("#qty").val());n&&n>=0&&$("#tdCompAvailQty").html(n)},goBackToAssignment:function(){return $("#assignCards").toggleClass("hide",!1),$("#confirmAssignCards").toggleClass("hide",!0),!1},confirmLocationAssignment:function(){return r()?($("#assignCards").toggleClass("hide",!0),$("#confirmAssignCards").toggleClass("hide",!1),this.loadConfirmation(),!1):!1},completeLocationAssignment:function(){var i=this,t;return $("#btnComplete").prop("disabled",!0),u(),t=$("#btnComplete").data("url"),jQuery.post(t,window.tcAssignmentViewModel,i.loadCompletion).fail(function(t){n.showResponseError("confirmError","errlist1",t)}).always(function(){$("#btnComplete").prop("disabled",!1)}),!1},moveNext:function(n){var i,f,u,e;return r()?(i=$("#CourseId option:selected").text(),window.tcAssignmentViewModel.CourseId=$("#CourseId option:selected").val(),window.tcAssignmentViewModel.CourseName=i,window.tcAssignmentViewModel.TCId=$("#ddlTC option:selected").val(),window.tcAssignmentViewModel.LocationId=$("#ddlLoc option:selected").val(),window.tcAssignmentViewModel.TSId=$("#ddlSite option:selected").val(),window.tcAssignmentViewModel.RoleId=$("#RoleId option:selected").val(),f=$("#assignTo").find(":selected"),u=[],t={},$.each(f,function(n,r){u.push({CourseName:i,InstructorId:$(r).val(),IsConfirmed:!1});t[$(r).val()]=$(r).text()}),e=$(n).data("url"),this.renderInstQty(e,u,this.loadInstQty,"assign"),!1):!1},confirmInstAssignment:function(){var t,i=[],u=/^\-?\d+$/,r;return($("#tblInsQty").find("input:text").each(function(){var n=this.value,f,r;if(n&&n!="0")if(u.test(n))f=$(this).closest("tr").data("instid"),r=jQuery.grep(window.tcAssignmentViewModel.InstructorQtyList,function(n){return n.InstructorId==f}),r&&r.length>0&&i.push({CourseName:window.tcAssignmentViewModel.CourseName,InstructorId:r[0].InstructorId,Quantity:n,IsConfirmed:!0});else{t=window.resources.TextAssignQtyPositiveInteger;return}else t=window.resources.TextAssignQuantityRequired}),t&&t.length>0)?n.showResponseError("qtyError","ulQty",t):(r=$("#btnConfirm").data("url"),this.renderInstQty(r,i,this.loadInstConfirm,"confirmQty"),!1)},renderInstQty:function(t,i,r,u){var f=this,e=window.tcAssignmentViewModel.InstructorQtyList;window.tcAssignmentViewModel.InstructorQtyList=i;jQuery.post(t,window.tcAssignmentViewModel,$.proxy(r,f)).fail(function(t){window.tcAssignmentViewModel.InstructorQtyList=e;u==="assign"?n.showResponseError("assignError","errlist",t):n.showResponseError("qtyError","ulQty",t)})},loadInstQty:function(n){var t=this;n&&($("#confirmQty").html(n),$("#tdTC").html($("#ddlTC option:selected").text()),$("#tdLoc").html($("#ddlLoc option:selected").text()),$("#tdSite").html($("#ddlSite option:selected").text()));$("#assignCards").toggleClass("hide",!0);$("#confirmQty").toggleClass("hide",!1);$("#trAssignedQty").toggleClass("hide",!0);$("#btnQtyAssign").show();$("#btnQtyConfirm").hide();$("#hdAssignQty").show();$("#hdConfirmQty").hide();$("#instQtyTitle").show();$("#confirmTitle").hide();i.init();t.enrichInstrs()},loadInstConfirm:function(n){var t=this;n&&($("#confirmQty").html(n),$("#tdTC").html($("#ddlTC option:selected").text()),$("#tdLoc").html($("#ddlLoc option:selected").text()),$("#tdSite").html($("#ddlSite option:selected").text()));$("#assignCards").toggleClass("hide",!0);$("#confirmQty").toggleClass("hide",!1);$("#trAssignedQty").toggleClass("hide",!1);$("#btnQtyAssign").hide();$("#btnQtyConfirm").show();$("#hdAssignQty").hide();$("#hdConfirmQty").show();$("#instQtyTitle").hide();$("#confirmTitle").show();i.init();t.enrichInstrs()},goBackToInstAssignment:function(n){if(n==="assign")$("#assignCards").toggleClass("hide",!1),$("#confirmQty").toggleClass("hide",!0);else{$.each(window.tcAssignmentViewModel.InstructorQtyList,function(n,t){t.IsConfirmed=!1});var t=$("#btnConfirm").data("url");this.renderInstQty(t,window.tcAssignmentViewModel.InstructorQtyList,this.loadInstQty,"assign")}return!1},removeInst:function(n){var i=$(n).closest("tr").data("instid"),r=jQuery.grep(window.tcAssignmentViewModel.InstructorQtyList,function(n){return n.InstructorId!=i}),u,f;return t.hasOwnProperty(i)&&delete t[i],u=jQuery.grep(window.tcAssignmentViewModel.InstructorQtyList,function(n){return n.IsConfirmed}),$("#tblInsQty").find("input:text").each(function(){var n=this.value,t=$(this).closest("tr").data("instid");$.each(r,function(i,r){r.InstructorId==t&&(r.Quantity=n)})}),f=$("#btnConfirm").data("url"),u&&u.length===window.tcAssignmentViewModel.InstructorQtyList.length?this.renderInstQty(f,r,this.loadInstConfirm,"confirmQty"):this.renderInstQty(f,r,this.loadInstQty,"confirmQty"),!1},completeInstAssignment:function(){var t,r;return $("#btnComplete").prop("disabled",!0),t=[],$("#tblInsQty").find("td[id^=tdInstQty]").each(function(){var n=$(this).text(),i=$(this).closest("tr").data("instid");t.push({InstructorId:i,Quantity:n,IsConfirmed:!0})}),t.length>0?(window.tcAssignmentViewModel.InstructorQtyList=t,r=$("#btnComplete").data("url"),jQuery.post(r,window.tcAssignmentViewModel,function(n){$("#completeAssignCards").toggleClass("hide",!1);$("#confirmQty").toggleClass("hide",!0);$("#completeAssignCards").html(n);window.tcAssignmentViewModel=null;i.init();$("#tblCompleted").DataTable();$("#tdCompTC").html($("#ddlTC option:selected").text());$("#tdCompLoc").html($("#ddlLoc option:selected").text());$("#tdCompSite").html($("#ddlSite option:selected").text())}).fail(function(t){n.showResponseError("qtyError","ulQty",t)}).always(function(){$("#btnComplete").prop("disabled",!1)})):$("#btnComplete").prop("disabled",!1),!1},enrichInstrs:function(){$("#tblInsQty tr").each(function(){var n,i;for(n in t)if(t.hasOwnProperty(n)&&(i=$(this).find("td[id*=tdInstrName"+n+"]"),i.length===1)){$(i).html(t[n]);break}})}}},AppTSAssignment=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon,t={init:function(){var n=$('a[data-toggle="collapse"]');n.on("click",function(){n.delay(1e3).hasClass("collapsed")?t.hide(n):t.show(n)})},hide:function(n){n.children(".text").text("Hide Info");n.children(".fa").hasClass("fa-caret-up")?n.children(".fa").removeClass("fa-caret-up").addClass("fa-caret-down"):""},show:function(n){n.children(".text").text("Show Info");n.children(".fa").hasClass("fa-caret-down")?n.children(".fa").removeClass("fa-caret-down").addClass("fa-caret-up"):""}},i=function(){var u;$("#assignError").html("");$("#assignError").addClass("hide");var t=[],f=$("#courseId option:selected").val(),e=$("#tcId option:selected").val(),i=$("#qty").val(),r=parseInt($("#availQty").text());return(!f||f<=0)&&(t[t.length]=window.resources.TextCourseRequired),(!e||e<=0)&&(t[t.length]=window.resources.TextTrainingCenterRequired),r<=0&&(t[t.length]=window.resources.TextInsufficiantInventory),u=$("#tsList option:selected").val(),(!u||u<=0)&&(t[t.length]=window.resources.TextTrainingSiteRequired),i&&i!="0"?(!jQuery.isNumeric(i)||Math.floor(i)!=i||parseInt(i)<=0)&&(t[t.length]=window.resources.TextAssignQtyPositiveInteger):t[t.length]=window.resources.TextAssignQuantityRequired,r>0&&parseInt(i)>r&&(t[t.length]=window.resources.TextExceedsInventory),n.showResponseError("assignError","errlist",t)},r=function(){window.tcAssignmentViewModel.TSId=$("#tsList option:selected").val();window.tcAssignmentViewModel.CourseId=$("#courseId option:selected").val();window.tcAssignmentViewModel.TCId=$("#tcId option:selected").val();window.tcAssignmentViewModel.AssignedQty=$("#qty").val();window.tcAssignmentViewModel.AvailableQty=$("#availQty").text()};return{init:function(){var n=this;$("#tcId").on("change",function(t){var i,r;$("#assignError, #divBox, #divTC, #divTS, #divCourse, #divSubmit").toggleClass("hide",!0);i=$(t.target).val();i>0&&(r=$(t.target).data("url"),n.loadTrainingsites(r,{tcId:i},window.resources.TextSelectTrainingSite))});$("#tsList").on("change",function(t){var i=$(t.target).val(),r;i>0&&(r=$(t.target).data("url"),n.loadCourses(r,{tsId:i},window.resources.SelectCourse))});$("#courseId").on("change",function(t){var i=$(t.target).val(),r=$("#tcId option:selected").val(),u=$(t.target).data("url");i>0?(n.getAvailableQty(u,{tcId:r,courseId:i}),$("#qty").val(0)):$("#divBox").toggleClass("hide",!0)})},loadTrainingsites:function(t,i,r){var u=[];u.push($("<option/>",{value:"",text:r}));jQuery.get(t,i,function(t){t&&t.length>0?$.each(t,function(n,t){u.push($("<option/>",{value:t.Id,text:t.Name}))}):n.showResponseError("assignError","errlist",window.resources.TextNoTrainingSitesFound);$("#divTS").toggleClass("hide",!1);$("#tsList").empty().append(u).val("")}).error(function(){$("#divTS").toggleClass("hide",!1);$("#tsList").empty().append(u).val("");n.showResponseError("assignError","errlist",window.resources.TextNoTrainingSitesFound)})},loadCourses:function(t,i,r){var u=[];u.push($("<option/>",{value:"",text:r}));jQuery.get(t,i,function(n){n&&n.length>0&&$.each(n,function(n,t){u.push($("<option/>",{value:t.Id,text:t.Name}))});$("#divCourse").toggleClass("hide",!1);$("#courseId").empty().append(u).val("")}).error(function(){$("#divCourse").toggleClass("hide",!1);$("#courseId").empty().append(u).val("");n.showResponseError("assignError","errlist",window.resources.TextNoCourseFoundPleaseReview)})},getAvailableQty:function(t,i){$("#divBox").toggleClass("hide",!0);jQuery.get(t,i,function(n){n&&($("#divBox").toggleClass("hide",!1),$("#availQty").text(n),$("#divSubmit").toggleClass("hide",!1))}).error(function(t){n.showResponseError("assignError","errlist",t)})},loadConfirmation:function(){$("#confirmError").html("");$("#confirmError").toggleClass("hide",!0);$("#tdCourse").html($("#courseId option:selected").text());$("#tdTC").html($("#tcId option:selected").text());$("#tdTS").html($("#tsList option:selected").text());$("#tdAvailQty").html($("#availQty").text());$("#tdQty").html($("#qty").val())},loadCompletion:function(n){$("#completeAssignCards").toggleClass("hide",!1);$("#confirmAssignCards").toggleClass("hide",!0);$("#tdCompCourse").html($("#courseId option:selected").text());$("#tdCompTC").html($("#tcId option:selected").text());$("#tdCompTS").html($("#tsList option:selected").text());$("#tdCompQty").html($("#qty").val());n&&n>=0&&$("#tdCompAvailQty").html(n)},goBackToAssignment:function(){return $("#assignCards").toggleClass("hide",!1),$("#confirmAssignCards").toggleClass("hide",!0),!1},confirmSiteAssignment:function(){return i()?($("#assignCards").toggleClass("hide",!0),$("#confirmAssignCards").toggleClass("hide",!1),this.loadConfirmation(),!1):!1},completeSiteAssignment:function(){var i=this,t;return $("#btnComplete").prop("disabled",!0),r(),t=$("#btnComplete").data("url"),jQuery.post(t,window.tcAssignmentViewModel,i.loadCompletion).fail(function(t){n.showResponseError("confirmError","errlist1",t)}).always(function(){$("#btnComplete").prop("disabled",!1)}),!1}}},AppIntlReclaim=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon,t=function(){$("#reClaimErr").html("");$("#reClaimErr").addClass("hide");var t=[],f=$("#courseId option:selected").val(),r=$("#tsList option:selected").val(),e=$("#tcId option:selected").val(),i=$("#qty").val(),u=parseInt($("#divAvailQty").text());return(!f||f<=0)&&(t[t.length]=window.resources.TextCourseRequired),(!e||e<=0)&&(t[t.length]=window.resources.TextTrainingCenterRequired),(!r||r<=0)&&(t[t.length]=window.resources.TextTrainingSiteRequired),u<=0&&(t[t.length]=window.resources.TextInstructorLowInventory),r>0&&(i&&i!="0"?(!jQuery.isNumeric(i)||Math.floor(i)!=i||parseInt(i)<=0)&&(t[t.length]=window.resources.TextReclaimQtyPositive):t[t.length]=window.resources.TextReclaimQuantityRequired),u>0&&parseInt(i)>u&&(t[t.length]=window.resources.TextReclaimExceedsQty),n.showResponseError("reClaimErr","errlist",t)},i=function(){$("#confirmReclaim").hide();$("#divBox").toggleClass("hide",!0);$("#lnkConfirm").toggleClass("hide",!0);$("#ddlTS").toggleClass("hide",!0);$("#ddlCourse").toggleClass("hide",!0)};return{init:function(){var n=this;i();$("#tcId").on("change",function(t){var r,u;i();n.clearErrorMsg();r=$(t.target).val();r>0&&$("#ddlTS").length&&(u=$(t.target).data("url"),n.getReclaimTargets(u,{tcId:r},n.loadTrainingsites,window.resources.TextNoTrainingSitesFound))});$("#tsList").on("change",function(t){var i=$(t.target).val(),r;i>0&&$("#ddlCourse").length&&(r=$(t.target).data("url"),n.getReclaimTargets(r,{tsId:i},n.loadCourses,window.resources.TextNoCourseFoundPleaseReview))});$("#courseId").on("change",function(t){var i=$(t.target).val(),r=$(t.target).data("url");i>0?(n.getAvailableQuantity(r,i),$("#qty").val(0)):$("#divBox").toggleClass("hide",!0)})},loadTrainingsites:function(t){if(t&&t.length>0){var i=[];i.push($("<option/>",{value:"",text:window.resources.TextSelectTrainingSite}));$.each(t,function(n,t){i.push($("<option/>",{value:t.Id,text:t.Name}))});$("#divBox").toggleClass("hide",!0);$("#lnkConfirm").toggleClass("hide",!0);$("#ddlTS").toggleClass("hide",!1);$("#tsList").empty().append(i);$("#tsList").val("")}else n.showResponseError("reClaimErr","errlist",window.resources.TextNoTrainingSitesFound)},loadCourses:function(t){if(t&&t.length>0){var i=[];i.push($("<option/>",{value:"",text:window.resources.SelectCourse}));$.each(t,function(n,t){i.push($("<option/>",{value:t.Id,text:t.Name}))});$("#divBox").toggleClass("hide",!0);$("#lnkConfirm").toggleClass("hide",!0);$("#ddlCourse").toggleClass("hide",!1);$("#courseId").empty().append(i);$("#courseId").val("")}else n.showResponseError("reClaimErr","errlist",window.resources.TextNoCourseFoundPleaseReview)},getReclaimTargets:function(t,i,r,u){jQuery.get(t,i?i:null,r).error(function(t){n.showResponseError("reClaimErr","errlist",u!=""?u:t);$("#ddlSource").toggleClass("hide",!1);$("#fromSource").empty();$("#divBox").toggleClass("hide",!0);$("#lnkConfirm").toggleClass("hide",!0)})},loadTargets:function(t,i,r){var u=[];u.push($("<option/>",{value:"",text:r}));jQuery.get(t,i,function(n){n&&n.length>0&&$.each(n,function(n,t){u.push($("<option/>",{value:t.Id,text:t.Name}))});$("#ddlSource").toggleClass("hide",!1);$("#divBox").toggleClass("hide",!0);$("#lnkConfirm").toggleClass("hide",!0);$("#fromSource").empty().append(u);$("#fromSource").val("")}).error(function(t){n.showResponseError("reClaimErr","errlist",t);$("#ddlSource").toggleClass("hide",!1);$("#fromSource").empty().append(u);$("#divBox").toggleClass("hide",!0);$("#lnkConfirm").toggleClass("hide",!0)})},getAvailableQuantity:function(t){$("#divBox").toggleClass("hide",!0);var r=$("#courseId option:selected").val(),i,u=$("#tsList option:selected").val(),f=$("#tcId option:selected").val();i={courseId:r,sourceId:u,fromSource:f};jQuery.get(t,i,function(n){n&&($("#divBox").toggleClass("hide",!1),$("#divAvailQty").text(n),$("#lnkConfirm").toggleClass("hide",!1))}).error(function(t){n.showResponseError("reClaimErr","errlist",t)})},clearErrorMsg:function(){$("#reClaimErr").html("");$("#reClaimErr").toggleClass("hide",!0)},buildReclaimRequest:function(){$("#hdnSiteName").val($("#tsList option:selected").text());window.tcAssignmentViewModel.ReclaimSourceId=$("#tsList option:selected").val();window.tcAssignmentViewModel.TCId=$("#tcId option:selected").val();window.tcAssignmentViewModel.TCName=$("#tcId option:selected").text();window.tcAssignmentViewModel.CourseName=$("#courseId option:selected").text();window.tcAssignmentViewModel.CourseId=$("#courseId option:selected").val();window.tcAssignmentViewModel.AssignedQty=$("#qty").val();window.tcAssignmentViewModel.AvailableQty=$("#divAvailQty").text()},loadReclaimMain:function(){return $("#confirmReclaim").hide(),$("#reclaimMain").show(),$("#confirmReclaim").html(""),!1},loadConfirmReclaim:function(){var i=!1,r;return(i=t(),i&&this.buildReclaimRequest(),!i)?!1:(r=$("#lnkConfirm").data("url"),jQuery.post(r,window.tcAssignmentViewModel,function(n){n&&($("#confirmReclaim").show(),$("#reclaimMain").hide(),$("#confirmReclaim").html(n),$("#divSourceName").html($("#hdnSiteName").val()))}).error(function(t){n.showResponseError("reClaimErr","errlist",t)}),!1)},loadCompleteReclaim:function(){var i,r,u;return($("#lnkComplete").prop("disabled",!0),i=!1,i=t(),i&&this.buildReclaimRequest(),!i)?($("#lnkComplete").prop("disabled",!1),!1):(r=$("#lnkComplete").data("url"),u=this,$("#hdnAvailQty").val($("#divConfirmAvailQty").text()),jQuery.post(r,window.tcAssignmentViewModel,function(n){n&&($("#confirmReclaim").show(),$("#reclaimMain").hide(),$("#confirmReclaim").html(n),$("#divSourceName").html($("#hdnSiteName").val()),$("#counter").text($("#hdnAvailQty").val()),u.fnCounter())}).error(function(t){n.showResponseError("reClaimConfirmErr","errlist1",t)}).always(function(){$("#lnkComplete").prop("disabled",!1)}),!1)},fnCounter:function(){$({countNum:$("#hdnAvailQty").val()}).delay(1e3).animate({countNum:$("#divCompAvailQty").text()},{duration:1500,easing:"linear",step:function(){$("#counter").text(Math.floor(this.countNum))},complete:function(){$("#counter").text(this.countNum);$("#counter").addClass("animated fadeOut");$("#counter").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$("#counter").delay(100).animate({height:0},500)})}})}}},AppSearchUser=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon;return{init:function(){var n=this;$(document).ready(function(){$("#confirmUpdateModal").on("shown.bs.modal",n.focus);$("#confirmRemoveAlignmentModal").on("shown.bs.modal",n.focus)})},focus:function(){var n=$(this);n.find(".close").focus()},callAPI:function(n,t,i,r,u){n==="get"?$.get(t,i,r).error(function(n){u(n)}):$.post(t,i,r).error(function(n){u(n)})},validateEmail:function(n){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/igm.test(n)},validateSearch:function(){var t=[],r=window.searchUserModel.FirstName=$("#firstname").val(),u=window.searchUserModel.LastName=$("#lastname").val(),i=window.searchUserModel.Email=$("#email").val(),f=window.searchUserModel.InstructorId=$("#instructorId").val(),e=window.searchUserModel.AtgId=$("#atgId").val(),o=window.searchUserModel.SsoId=$("#ssoId").val();return r||u||i||f||o||e||(t[t.length]=window.resources.TextAtleastOneValue),i&&!this.validateEmail(i)&&(t[t.length]=window.resources.TextInvalidEmail),n.showResponseError("divSearchError","errlist",t)},validateTCSearch:function(){$("#assignError").html("");$("#assignError").addClass("hide");var t=[],i=$("#tcName").val(),r=$("#tcId").val(),u=$("#securityCode").val();return i||r||u||(t[t.length]=window.resources.TextAtleastOneValue),n.showResponseError("assignError","errlist",t)},searchTC:function(n){var r,u;n.preventDefault();var t=this,f=$(n.target),i=f.attr("id");if(i!="lnkTCBack"&&i!="lnkTSBack"&&!t.validateTCSearch())return!1;$("#divTCInfo").toggleClass("hide",!0);$("#divSearch").toggleClass("hide",!1);$("#divTSInfo").toggleClass("hide",!0);$("#divAlert, #divSearchError").toggleClass("hide",!0);r={TcName:$("#tcName").val(),TcIdNumber:$("#tcId").val(),securityCode:$("#securityCode").val()};u=$("#hdnTCSearchUrl").val();t.callAPI("get",u,r,t.onLoadTCResult,t.onFailTCSearch)},findTca:function(n){n.preventDefault();var t=this,i=$(n.target),r=i.data("tcid"),u=i.data("url"),f={tcid:r};t.callAPI("get",u,f,t.onFindTcaResult,t.onFailedFindTca)},findTsa:function(n){n.preventDefault();var t=this,i=$(n.target),r=i.data("tsid"),u=i.data("url"),f={tsId:r};t.callAPI("get",u,f,t.onFindTsaResult,t.onFailedFindTsa)},onFindTcaResult:function(n){var i="",t;if(n.length>0){for(t=0;t<n.length;t++)i=i+"<tr><td>"+n[t].FirstName+"<\/td><td>"+n[t].LastName+"<\/td><td>"+n[t].Email+"<\/td><\/tr>";$("#tcabody").html(i)}else $("#tcabody").html("No data found");$("#showTCAModal").modal("show")},onFindTsaResult:function(n){var i="",t;if(n.length>0){for(t=0;t<n.length;t++)i=i+"<tr><td>"+n[t].FirstName+"<\/td><td>"+n[t].LastName+"<\/td><td>"+n[t].Email+"<\/td><\/tr>";$("#tsabody").html(i)}else $("#tsabody").html("No data found");$("#showTSAModal").modal("show")},onLoadTCResult:function(t){$("#divSearchResult").toggleClass("hide",!1).html(t);$("#tblSearchTC").DataTable();$("#divAlert").is(":visible")?n.focusMessage():$("html, body").animate({scrollTop:$("#titleResults").offset().top-55},1e3)},onFailTCSearch:function(t){n.showResponseError("divSearchError","errlist",t);$("#divAlert, #divSearchError").toggleClass("hide",!0);var i={TcIdNumber:$("#tcId").val()},r=$("#hdnTCSearchUrl").val();self.callAPI("get",r,i,self.onLoadTCResult,self.onFailTCSearch)},onFailedFindTca:function(t){n.showResponseError("tcaearchtca","errlist",t)},onFailedFindTsa:function(t){n.showResponseError("tsaearchtca","errlist",t)},loadTCInfo:function(n){n.preventDefault();var t=this,i=$(n.target.parentElement),r=i.data("url"),u=i.data("tcid"),f={TcId:u};t.callAPI("get",r,f,t.onLoadTCInfo,t.onFailTCInfo)},onLoadTCInfo:function(t){t&&t.length>0&&($("#divSearch").toggleClass("hide",!0),$("#divTCInfo").toggleClass("hide",!1).html(t),n.focusMessage())},loadTSInfo:function(n){n.preventDefault();var t=this,i=$(n.target.parentElement),r=i.data("tcname");$("#hdnTCName").val(r);var u=i.data("url"),f=i.data("tcid"),e={tcId:f};t.callAPI("get",u,e,t.onLoadTSInfo,t.onFailTCInfo)},onLoadTSInfo:function(t){t&&t.length>0?($("#divSearch").toggleClass("hide",!0),$("#divTCInfo").toggleClass("hide",!0),$("#divTSInfo").toggleClass("hide",!1).html(t),$("#tblSearchTS").DataTable(),$("#spnTCname").html($("#hdnTCName").val()),n.focusMessage()):$("#tsBody").html("No data found")},clearTCSearch:function(n){n.preventDefault();$("#tcName").val("");$("#tcId").val("");$("#securityCode").val("");$("#divSearchResult").html("")},onFailTCInfo:function(){},searchUsers:function(n){var t,i,r;if(n.preventDefault(),t=this,!t.validateSearch())return!1;$("#divAlert, #divSearchError").toggleClass("hide",!0);i=window.searchUserModel;r=$("#hdnSearchUrl").val();t.callAPI("post",r,i,t.onLoadResult,t.onFailSearch)},onLoadResult:function(t){$("#divSearchResult").toggleClass("hide",!1).html(t);$("#tblSearchUser").DataTable();$("#divAlert").is(":visible")?n.focusMessage():$("html, body").animate({scrollTop:$("#titleResults").offset().top-55},1e3)},onFailSearch:function(t){n.showResponseError("divSearchError","errlist",t)},clearSearch:function(t){t.preventDefault();$("#divSearchError").html("");$("#divSearchError").toggleClass("hide",!0);$("#firstname").val("");$("#lastname").val("");$("#email").val("");$("#instructorId").val("");$("#atgId").val("");$("#ssoId").val("");$("#divSearchResult").html("");$("#divEditUser").html("");$("#divAlert").toggleClass("hide",!0);window.searchUserModel={};n.focusMessage()},editUser:function(n){n.preventDefault();$("#divEditError").toggleClass("hide",!0);$("#divEditAlert").toggleClass("hide",!0);var t=this,i=$(n.target.parentElement),r=i.data("url"),u={id:i.data("uid"),isEdit:i.data("isedit")};t.callAPI("get",r,u,$.proxy(t.onLoadingEditUser,t),t.onFailSearch)},onLoadingEditUser:function(t){t&&t.length>0&&($("#divSearch").toggleClass("hide",!0),$("#divEditUser").toggleClass("hide",!1).html(t),$("#tblDisciplines").DataTable(),$("#tblTC").DataTable(),$("#tblTS").DataTable(),$("#tblLocations").DataTable(),n.focusMessage())},validateEdit:function(){var r=this,t=[],u=window.searchUserModel.FirstName=$("#fname").val().trim(),f=window.searchUserModel.LastName=$("#lname").val().trim(),i=window.searchUserModel.Email=$("#emailaddress").val().trim();window.searchUserModel.InstructorId=$("#instructorNum").val().trim();var o=window.searchUserModel.AtgId=$("#atgUserId").val().trim(),s=window.searchUserModel.SsoId=$("#signOnId").val().trim(),e=window.searchUserModel.IsDataVerified=$("input[id='chkVerification']").prop("checked");return window.searchUserModel.Comments=$("#comments").val().trim(),window.searchUserModel.RoleIds=$("input[id^=chkRole]:checked").map(function(){return this.value}).get().join(","),u||(t[t.length]=window.resources.TextFirstNameRequired),f||(t[t.length]=window.resources.TextLastNameRequired),i?r.validateEmail(i)||(t[t.length]=window.resources.TextInvalidEmail):t[t.length]=window.resources.TextEmailRequired,e||(t[t.length]=window.resources.TextErrorNoATGConfirm),window.searchUserModel.ProfileId=$("#hdnUserId").val(),n.showResponseError("divEditError","errlist1",t)},confirmSave:function(t){var i,u,r,f,e;if(t.preventDefault(),i=this,u=t.target.id,$("#divEditError, #divEditAlert").toggleClass("hide",!0),$("#divUpdateStatus, #divUpdateUser1,#divUpdateUser2").toggleClass("hide",!0),u==="lnkStatus"){if(r=[],f=$("input[id='chkVerification']").prop("checked"),!f)return r[r.length]=window.resources.TextErrorNoATGConfirm,n.showResponseError("divEditError","errlist1",r);$("#confirmUpdateModal").modal("show");$("#btnOk").off("click");$("#divUpdateStatus").toggleClass("hide",!1);e=$("#lnkStatus").data("isactive");$("#divUpdateStatus p").toggleClass("hide",!0);e.toLowerCase()==="true"?$("#divUpdateStatus p:eq(0)").toggleClass("hide",!1):$("#divUpdateStatus p:eq(1)").toggleClass("hide",!1);$("#btnOk").on("click",$.proxy(i.saveStatus,i))}else{if(!i.validateEdit())return!1;$("#confirmUpdateModal").modal("show");$("#btnOk").off("click");$("#divUpdateUser1,#divUpdateUser2").toggleClass("hide",!1);$("#btnOk").on("click",$.proxy(i.saveInfo,i))}},removeAlignment:function(n,t,i,r,u,f){n.preventDefault();var e=this,o={tcId:t,tsId:i,profileId:r,disciplineId:u};e.removePrams=o;$("#divModelBody").html("You are about to remove "+f+" discipline. Do you want to proceed?");$("#confirmRemoveAlignmentModal").modal("show");$("#btnRemoveAlignmentOk").off("click");$("#btnRemoveAlignmentOk").on("click",$.proxy(e.saveAlignment,e))},saveAlignment:function(n){n.preventDefault();$("#confirmRemoveAlignmentModal").modal("hide");var t=this,i=$("#hdnRemoveAlignmentUrl").val(),r=t.removePrams;t.callAPI("post",i,r,t.onSuccessSave,t.onEditCardFailed)},saveInfo:function(n){n.preventDefault();$("#confirmUpdateModal").modal("hide");$("#divEditError, #divEditAlert").toggleClass("hide",!0);var t=this,i=$("#hdnUserInfoUrl").val();if(!t.validateEdit())return!1;t.callAPI("post",i,window.searchUserModel,t.onSuccessSave,t.onEditCardFailed)},saveStatus:function(n){n.preventDefault();$("#confirmUpdateModal").modal("hide");$("#divEditError, #divEditAlert").toggleClass("hide",!0);var t=this,i=$("#hdnUserStatusUrl").val(),r={ProfileId:$("#hdnUserId").val(),IsActive:$("#lnkStatus").data("isactive").toLowerCase()==="true",Comments:$("#comments").val().trim(),IsDataVerified:$("input[id='chkVerification']").prop("checked")};t.callAPI("post",i,r,t.onSuccessSave,t.onEditCardFailed)},onSuccessSave:function(t){t&&t.length>0&&($("#divEditUser").html(t),$("#tblDisciplines").DataTable(),$("#tblTC").DataTable(),$("#tblTS").DataTable(),$("#tblLocations").DataTable(),$("#divEditAlert").toggleClass("hide",!1),n.focusMessage())},onEditCardFailed:function(t){n.showResponseError("divEditError","errlist1",t)},loadSearch:function(n){n.preventDefault();$("#divSearch").toggleClass("hide",!1);$("#divEditUser").html("").toggleClass("hide",!0);$("#btnSearchUser").trigger({type:"click"})}}},AppVendor=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon,t=function(t,i){var r,u,f;return $("#errDiv").html("").addClass("hide"),r=[],u=$("#ddlApi option:selected"),window.vendorModel.Vendor={Name:$("#txtName").val(),email:$("#txtEmail").val(),Phone:$("#txtPhone").val(),Domain:$("#txtDomain").val(),ExternalAPI:u.map(function(n,t){return t.value}).get().join(",")},$("#vStatus").length>0&&(window.vendorModel.Vendor.IsActive=$("#vStatus").is(":checked")),$("#chkSecurity").length>0&&(window.vendorModel.Vendor.HasAPISecurity=$("#chkSecurity").is(":checked")),$("#chkReclaimEcard").length>0&&(window.vendorModel.Vendor.IsAllowToReserve=$("#chkReclaimEcard").is(":checked")),window.vendorModel.SelectedAPIs=u.map(function(n,t){return t.text}).get().join(", "),window.vendorModel.Vendor.Name||(r[r.length]=window.resources.TextNameRequired),window.vendorModel.Vendor.email?(f=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/igm,f.test(window.vendorModel.Vendor.email)||(r[r.length]=window.resources.TextInvalidEmail)):r[r.length]=window.resources.TextEmailRequired,window.vendorModel.Vendor.Domain||(r[r.length]=window.resources.TextDomainRequired),window.vendorModel.Vendor.ExternalAPI&&window.vendorModel.Vendor.ExternalAPI.length!==0||(r[r.length]=window.resources.TextAPIRequired),n.showResponseError(t,i,r)};return{init:function(){var n=this;$("#lnkNext").on("click",$.proxy(n.loadConfirm,n));n.initMultiSelect()},initMultiSelect:function(){$("#ddlApi").multiselect({buttonWidth:"100%",disableIfEmpty:!1,includeSelectAllOption:!0,selectAllText:window.resources.TextSelectAll,allSelectedText:window.resources.TextAllSelected,nonSelectedText:window.resources.SelectExternalApi,nSelectedText:" "+window.resources.TextSelectedAPI});$(".multiselect-bin").find("button").attr("aria-required","true").attr("id","multiAPI")},callAPI:function(n,t,i,r,u){n==="get"?$.get(t,i,r).error(function(n){u(n)}):n==="post"?$.post(t,i,r).error(function(n){u(n)}):$.ajax({url:t,type:"DELETE",success:r,data:i,contentType:"application/json"})},validateEmail:function(n){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/igm.test(n)},loadConfirm:function(i){var r,u;if(i.preventDefault(),r=$(i.target),u=this,!t("registrationErr","errlist"))return!1;var f=function(n){n&&n.length>0&&($("#registerMain").toggleClass("hide",!0),$("#divPartial").html(n).toggleClass("hide",!1))},e=function(t){$("#ConfirmErr").length>0?n.showResponseError("ConfirmErr","errlist1",t):n.showResponseError("registrationErr","errlist",t)},o=r.data("url");return u.callAPI("post",o,window.vendorModel,f,e),!1},goBack:function(n){n.preventDefault();$("#registrationErr").toggleClass("hide",!0);$("#registerMain").toggleClass("hide",!1);$("#divPartial").html("").toggleClass("hide",!0)},editVendor:function(t){t.preventDefault();var r=$(t.target).closest("a"),i=this,u=function(t){t&&t.length>0&&($("#divEdit").html(t).toggleClass("hide",!1),$("#resultsTable").toggleClass("hide",!0),n.focusMessage(),i.initMultiSelect())},f=function(t){n.showResponseError("divVendorsErr","errlist",t)};i.callAPI("get",r.data("url"),null,u,f)},navigateToList:function(n){n.preventDefault();$("#resultsTable").toggleClass("hide",!1);$("#divEdit").html("").toggleClass("hide",!0)},update:function(i){var u,r,f,e;return(i.preventDefault(),u=this,r=$(i.target),$("#divEditAlert").toggleClass("hide",!0),$("#divEditErr").toggleClass("hide",!0),!t("divEditErr","errlist1"))?!1:(f=function(t){t&&($("#divEditAlert").toggleClass("hide",!1),n.focusMessage())},e=function(t){n.showResponseError("divEditErr","errlist1",t)},window.vendorModel.Vendor.VendorId=r.data("vid"),u.callAPI("post",r.data("url"),window.vendorModel,f,e),!1)},changePwd:function(n){n.preventDefault();var t=this,i=$(n.target);$("#divAlert").toggleClass("hide",!0);$("#divVendorsErr").toggleClass("hide",!0);$("#changePwdModal").modal("show");$("#confirmText").html(window.resources.TextChangePwdConfirmation.replace("{0}",i.data("vname")));$("#btnYes").off("click");$("#btnYes").on("click",{vid:i.data("vid")},$.proxy(t.confirmPwdChange,t))},confirmPwdChange:function(t){t.preventDefault();var i=this,r=t.data.vid,u=function(t){t&&($("#changePwdModal").modal("hide"),$("#divAlert").toggleClass("hide",!1),n.focusMessage())},f=function(t){$("#changePwdModal").modal("hide");n.showResponseError("divVendorsErr","errlist",t)};i.callAPI("post",$("#hdnResetUrl").val(),{id:r},u,f)}}},AppSurveyQuestionReport,AppScoreReports;(function(n){n(jQuery.datepicker)})(function(n){return n.regional.de={closeText:"Schlieen",prevText:"&#x3C;Zurck",nextText:"Vor&#x3E;",currentText:"Heute",monthNames:["Januar","Februar","Mrz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],monthNamesShort:["Jan","Feb","Mr","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],dayNames:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],dayNamesShort:["So","Mo","Di","Mi","Do","Fr","Sa"],dayNamesMin:["So","Mo","Di","Mi","Do","Fr","Sa"],weekHeader:"KW",dateFormat:"dd.mm.yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},n.regional.de}),function(n){n(jQuery.datepicker)}(function(n){return n.regional.es={closeText:"Cerrar",prevText:"&#x3C;Ant",nextText:"Sig&#x3E;",currentText:"Hoy",monthNames:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],monthNamesShort:["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],dayNames:["domingo","lunes","martes","mircoles","jueves","viernes","sbado"],dayNamesShort:["dom","lun","mar","mi","jue","vie","sb"],dayNamesMin:["D","L","M","X","J","V","S"],weekHeader:"Sm",dateFormat:"dd/mm/yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},n.regional.es}),function(n){n(jQuery.datepicker)}(function(n){return n.regional.fr={closeText:"Fermer",prevText:"Prcdent",nextText:"Suivant",currentText:"Aujourd'hui",monthNames:["janvier","fvrier","mars","avril","mai","juin","juillet","aot","septembre","octobre","novembre","dcembre"],monthNamesShort:["janv.","fvr.","mars","avr.","mai","juin","juil.","aot","sept.","oct.","nov.","dc."],dayNames:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],dayNamesShort:["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],dayNamesMin:["D","L","M","M","J","V","S"],weekHeader:"Sem.",dateFormat:"dd/mm/yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},n.regional.fr}),function(n){n(jQuery.datepicker)}(function(n){return n.regional.it={closeText:"Chiudi",prevText:"&#x3C;Prec",nextText:"Succ&#x3E;",currentText:"Oggi",monthNames:["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],monthNamesShort:["Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"],dayNames:["Domenica","Luned","Marted","Mercoled","Gioved","Venerd","Sabato"],dayNamesShort:["Dom","Lun","Mar","Mer","Gio","Ven","Sab"],dayNamesMin:["Do","Lu","Ma","Me","Gi","Ve","Sa"],weekHeader:"Sm",dateFormat:"dd/mm/yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},n.regional.it}),function(n){n(jQuery.datepicker)}(function(n){return n.regional.ja={closeText:"",prevText:"&#x3C;",nextText:"&#x3E;",currentText:"",monthNames:["1","2","3","4","5","6","7","8","9","10","11","12"],monthNamesShort:["1","2","3","4","5","6","7","8","9","10","11","12"],dayNames:["","","","","","",""],dayNamesShort:["","","","","","",""],dayNamesMin:["","","","","","",""],weekHeader:"",dateFormat:"yy/mm/dd",firstDay:0,isRTL:!1,showMonthAfterYear:!0,yearSuffix:""},n.regional.ja}),function(n){n(jQuery.datepicker)}(function(n){return n.regional.ko={closeText:"",prevText:"",nextText:"",currentText:"",monthNames:["1","2","3","4","5","6","7","8","9","10","11","12"],monthNamesShort:["1","2","3","4","5","6","7","8","9","10","11","12"],dayNames:["","","","","","",""],dayNamesShort:["","","","","","",""],dayNamesMin:["","","","","","",""],weekHeader:"",dateFormat:"yy. m. d.",firstDay:0,isRTL:!1,showMonthAfterYear:!0,yearSuffix:""},n.regional.ko}),function(n){n(jQuery.datepicker)}(function(n){return n.regional.pt={closeText:"Fechar",prevText:"Anterior",nextText:"Seguinte",currentText:"Hoje",monthNames:["Janeiro","Fevereiro","Maro","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],monthNamesShort:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],dayNames:["Domingo","Segunda-feira","Tera-feira","Quarta-feira","Quinta-feira","Sexta-feira","Sbado"],dayNamesShort:["Dom","Seg","Ter","Qua","Qui","Sex","Sb"],dayNamesMin:["Dom","Seg","Ter","Qua","Qui","Sex","Sb"],weekHeader:"Sem",dateFormat:"dd/mm/yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},n.regional.pt}),function(n){n(jQuery.datepicker)}(function(n){return n.regional["zh-Hans"]={closeText:"",prevText:"&#x3C;",nextText:"&#x3E;",currentText:"",monthNames:["","","","","","","","","","","",""],monthNamesShort:["","","","","","","","","","","",""],dayNames:["","","","","","",""],dayNamesShort:["","","","","","",""],dayNamesMin:["","","","","","",""],weekHeader:"",dateFormat:"yy-mm-dd",firstDay:1,isRTL:!1,showMonthAfterYear:!0,yearSuffix:""},n.regional["zh-Hans"]}),function(n){n(jQuery.datepicker)}(function(n){return n.regional["zh-Hant"]={closeText:"",prevText:"&#x3C;",nextText:"&#x3E;",currentText:"",monthNames:["","","","","","","","","","","",""],monthNamesShort:["","","","","","","","","","","",""],dayNames:["","","","","","",""],dayNamesShort:["","","","","","",""],dayNamesMin:["","","","","","",""],weekHeader:"",dateFormat:"yy/mm/dd",firstDay:1,isRTL:!1,showMonthAfterYear:!0,yearSuffix:""},n.regional["zh-Hant"]});var AppeCardReport=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon,t=function(){$("#reportError").html("");$("#reportError").addClass("hide");var u=$("#reportForm").find('input[id="StartDate"]').val(),f=$("#reportForm").find('input[id="EndDate"]').val(),i=$("#ddlTC option:selected").val(),e=$("#ddlSite option:selected").val(),r=$("#ddlCourse option:selected").val(),t=[];return(i===""&&(t[t.length]=window.resources.TextTrainingCenterRequired),r===""&&(t[t.length]=window.resources.TextCourseRequired),t.length>0)?(n.showResponseError("reportError","errlist",t),!1):!0};return{init:function(){var n=this;$(document).ready(function(){$("#ddlReports option:contains(eCards Report)").attr("selected",!0)});$("#ddlTC").on("change",function(t){var r=$(t.target),i=r.val();i.length>0&&(n.getTrainingSites({TcId:i}),$("#divLocation").toggleClass("hide",!0),$("#divTrainingSite").toggleClass("hide",!1),$("#rdDomestic").is(":checked")?n.getCourses(!1):n.getCourses(!0))});$("input[type=radio][name=grpDomeInter]").on("change",function(t){var i=$(t.target);filterBy=i.val();$("#divLocation").toggleClass("hide",!0);$("#divTrainingSite").toggleClass("hide",!1);$("#ddlSite").empty().append($("<option/>",{value:"",text:window.resources.TextSelectTrainingSite}));filterBy=="Domestic"?(n.getTrainingCenters(t,!1),n.getCourses(!1)):(n.getTrainingCenters(t,!0),n.getCourses(!0))})},getLocation:function(t){var i=$("#ddlTC").data("url");jQuery.get(i,t,function(n){var t;n&&n.length>0?(t=[],t.push($("<option/>",{value:"",text:window.resources.TextSelecteCardLocation})),$.each(n,function(n,i){t.push($("<option/>",{value:i.Id,text:i.Name}))}),$("#ddlLocation").empty().append(t),$("#ddlLocation").val("")):(t=[],t.push($("<option/>",{value:"",text:window.resources.TextSelecteCardLocation})),$("#ddlLocation").empty().append(t))}).error(function(t){$("#ddlLocation").empty();n.showResponseError("reportError","errlist",t)})},getTrainingCenters:function(t,i){var r=$("#hdnTcUrl").val(),u={isInternational:i};r=$("#hdnTcUrl").val();jQuery.get(r,u,function(n){var t;n&&n.length>0?(t=[],t.push($("<option/>",{value:"",text:window.resources.SelectTrainingCenter})),$.each(n,function(n,i){t.push($("<option/>",{value:i.Id,text:i.Name,data:{tcid:i.TCIdNumber}}))}),$("#ddlTC").empty().append(t),$("#ddlTC").val("")):(t=[],t.push($("<option/>",{value:"",text:window.resources.SelectTrainingCenter})),$("#ddlTC").empty().append(t))}).error(function(t){$("#ddlSiteInter").empty();n.showResponseError("reportError","errlist",t)})},getTrainingSites:function(t){var i=$("#hdnTsUrl").val();jQuery.get(i,t,function(n){var t;n&&n.length>0?(t=[],t.push($("<option/>",{value:"",text:window.resources.TextSelectTrainingSite})),$.each(n,function(n,i){t.push($("<option/>",{value:i.Id,text:i.Name}))}),$("#ddlSite").empty().append(t),$("#ddlSite").val("")):(t=[],t.push($("<option/>",{value:"",text:window.resources.TextSelectTrainingSite})),$("#ddlSite").empty().append(t))}).error(function(t){$("#ddlSite").empty();n.showResponseError("reportError","errlist",t)})},getCourses:function(t){var i=$("#hdnCourseUrl").val(),r={isInternational:t};jQuery.get(i,r,function(n){var t;n&&n.length>0?(t=[],t.push($("<option/>",{value:"",text:window.resources.SelectCourse})),$.each(n,function(n,i){t.push($("<option/>",{value:i.CourseId,text:i.Name}))}),$("#ddlCourse").empty().append(t),$("#ddlCourse").val("")):(t=[],t.push($("<option/>",{value:"",text:window.resources.SelectCourse})),$("#ddlCourse").empty().append(t))}).error(function(t){$("#ddlCourse").empty();n.showResponseError("reportError","errlist",t)})},btnDownload_Click:function(){var v=this,l=$("#btnDownload").data("url"),i=$("#reportForm").find('input[id="StartDate"]').val(),r=$("#reportForm").find('input[id="EndDate"]').val(),u=$("#ddlTC option:selected").val(),f=$("#ddlSite option:selected").val(),e=$("#ddlCourse option:selected").val(),o=$("#ddlCourse option:selected").text(),s=$("#ddlStatus option:selected").val(),h=$("#rdInternational").is(":checked"),c=$("#ddlTC").find(":selected").data("tcid"),a={TcId:u,tsId:f,CourseId:e,startdate:i,enddate:r,eCardStatus:s,tcIdNumber:c,courseName:o,isIntrnational:h};t()&&jQuery.get(l,a,function(t){t&&t.length>0?window.location.href="EcardReport/GetEcardReport?TcId="+u+"&tsId="+f+"&CourseId="+e+"&startdate="+i+"&enddate="+r+"&eCardStatus="+s+"&tcIdNumber="+c+"&courseName="+o+"&isIntrnational="+h:n.showResponseError("reportError","errlist",window.resources.TextNoRecords)}).error(function(){n.showResponseError("reportError","errlist","error")})}}},AppEditEcardReports=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon,t=function(){$("#reportError").html("");$("#reportError").addClass("hide");var i=$("#reportForm").find('input[id="StartDate"]').val(),r=$("#reportForm").find('input[id="EndDate"]').val(),u=$("#ddlTC option:selected").val(),t=[];return(i&&r||(t[t.length]=window.resources.TextDateRangeRequired),(i||r)&&!n.isValidDate(i,r)&&(t[t.length]=n.getDateFormatError(window.resources.DateRange)),u==""&&(t[t.length]=window.resources.TextTrainingCenterRequired),t.length>0)?(n.showResponseError("reportError","errlist",t),!1):!0};return{init:function(){var n=this;$(document).ready(function(){$("#ddlReports option:contains(Student Edit eCard Report)").attr("selected",!0)})},loadReport:function(t,i,r,u){jQuery.ajax({url:t,type:"GET",dataType:"html",data:{startDate:i,endDate:r,tcId:u},success:function(t){var i,r;$("#reportData").html(t);i=$("#example").DataTable({pageLength:25,order:[[0,"asc"]]});i.context.length>0&&(r=new $.fn.dataTable.Buttons(i,{buttons:[{extend:"excelHtml5",title:n.getFileName("Student Edit Ecard Report")}]}),$("#expotbutton").prepend(r.container()).find("a.dt-button").addClass("btn btn-primary").text(window.resources.TextDownload),n.focusArea("#reportData"))},error:function(t){n.showResponseError("assignError","errlist",t)}})},btnSearch_Click:function(){var n=this,i=$("#btnSearch").data("url"),r=$("#reportForm").find('input[id="StartDate"]').val(),u=$("#reportForm").find('input[id="EndDate"]').val(),f=$("#ddlTC option:selected").val();t()&&n.loadReport(i,r,u,f)}}},AppIndividualInstructorScoreReports=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon,i=function(){$("#reportError").html("");$("#reportError").addClass("hide");var i=$("#reportForm").find('input[id="StartDate"]').val(),r=$("#reportForm").find('input[id="EndDate"]').val(),f=$("#ddlTC option:selected").val(),e=$("#ddlLocation option:selected").val(),u=$("#ddlInstructors").multiselect("getSelected").val(),o=$("#hdnRole").val(),t=[];return(i&&r||(t[t.length]=window.resources.TextDateRangeRequired),(i||r)&&!n.isValidDate(i,r)&&(t[t.length]=n.getDateFormatError(window.resources.DateRange)),o==RoleType.EcardAdmin.value&&(f===""&&(t[t.length]=window.resources.TextTrainingCenterRequired),e===""&&(t[t.length]=window.resources.TextLocationRequired)),(!u||u.length<=0)&&(t[t.length]=window.resources.TextMultiInstructorsRequired),t.length>0)?(n.showResponseError("reportError","errlist",t),!1):!0},t;return{init:function(){var n=this,i=$("#hdnRole").val();$("#ddlTC").on("change",function(t){var r=$(t.target).data("url"),i=$(t.target).val();i>0&&(n.getLocation({tcId:i}),n.getInstructor({tcId:i}))});$("input[type=radio][name=reportType]").on("change",function(n){var i=$(n.target);t=i.val()});$(document).ready(function(){$("input[id=course]:radio").prop("checked",!0);$("input[id=course]:radio").trigger("change");$("#ddlReports option:contains(Individual Instructor Scores)").attr("selected",!0);(i==RoleType.TCC.value||i==RoleType.TCAdmin.value)&&($("#divTrainingCenter").toggleClass("hide",!0),$("#hdnReport").val()!="instructor"?($("#divLocation").toggleClass("hide",!1),n.getLocation({tcId:$("#hdnTcId").val()})):($("#divTcLocation").toggleClass("hide",!0),n.getInstructor({tcId:$("#hdnTcId").val()})));i==RoleType.EcardAdmin.value&&($("#divTrainingCenter").toggleClass("hide",!1),$("#divLocation").toggleClass("hide",!1));n.initMultiSelect()})},initMultiSelect:function(){$("#ddlInstructors").multiselect({buttonWidth:"100%",disableIfEmpty:!1,includeSelectAllOption:!0,selectAllText:window.resources.TextSelectAll,allSelectedText:window.resources.TextAllSelected,nonSelectedText:window.resources.SelectInstructors,nSelectedText:" "+window.resources.TextSelectedInstructors})},loadReport:function(i,r,u,f,e,o){window.reportViewModel.TcId=r;window.reportViewModel.LocationId=u;window.reportViewModel.StartDate=f;window.reportViewModel.EndDate=e;window.reportViewModel.ReportType=t;window.reportViewModel.Instructors=o;jQuery.ajax({url:i,type:"POST",dataType:"html",data:window.reportViewModel,success:function(t){var i,r;$("#reportData").html(t);i=$("#example").DataTable({pageLength:25,order:[[0,"asc"]]});i.context.length>0&&(r=new $.fn.dataTable.Buttons(i,{buttons:[{extend:"excelHtml5",title:n.getFileName("Instructor Score Report")}]}),$("#expotbutton").prepend(r.container()).find("a.dt-button").addClass("btn btn-primary").text(window.resources.TextDownload),n.focusArea("#reportData"))},error:function(t){n.showResponseError("assignError","errlist",t)}})},getLocation:function(t){var i=$("#ddlTC").data("url");jQuery.get(i,t,function(n){if(n&&n.length>0){var t=[];t.push($("<option/>",{value:"",text:window.resources.TextSelecteCardLocation}));$.each(n,function(n,i){t.push($("<option/>",{value:i.Id,text:i.Name}))});$("#ddlLocation").empty().append(t);$("#ddlLocation").val("")}}).error(function(t){$("#ddlLocation").empty();n.showResponseError("assignError","errlist",t)})},getInstructor:function(t){var i=$("#ddlInstructors").data("url");jQuery.get(i,t,function(n){if(n&&n.length>0){var t=[];$.each(n,function(n,i){t.push($("<option/>",{value:i.Id,text:i.Name}))});$("#ddlInstructors").empty().append(t).multiselect("rebuild")}}).error(function(t){$("#ddlInstructors").empty().multiselect("rebuild");n.showResponseError("assignError","errlist",t)})},btnSearch_Click:function(){var n=this,t=$("#btnSearch").data("url"),r=$("#reportForm").find('input[id="StartDate"]').val(),u=$("#reportForm").find('input[id="EndDate"]').val(),f=$("#ddlTC option:selected").val(),e=$("#ddlLocation option:selected").val(),o=$("#ddlInstructors").multiselect("getSelected").val();i()&&n.loadReport(t,f,e,r,u,o)}}},AppInstructorScoreReports=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon,i=function(){$("#reportError").html("");$("#reportError").addClass("hide");var i=$("#reportForm").find('input[id="StartDate"]').val(),r=$("#reportForm").find('input[id="EndDate"]').val(),u=$("#ddlTC option:selected").val(),t=[];return(i&&r||(t[t.length]=window.resources.TextDateRangeRequired),(i||r)&&!n.isValidDate(i,r)&&(t[t.length]=n.getDateFormatError(window.resources.DateRange)),u===""&&(t[t.length]=window.resources.TextTrainingCenterRequired),t.length>0)?(n.showResponseError("reportError","errlist",t),!1):!0},t;return{init:function(){var n=this,i=$("#hdnRole").val();$("input[type=radio][name=reportType]").on("change",function(n){var i=$(n.target);t=i.val()});$(document).ready(function(){$("input[id=course]:radio").prop("checked",!0);$("input[id=course]:radio").trigger("change");$("#ddlReports option:contains(Quality Score)").attr("selected",!0)})},loadReport:function(i,r,u,f){window.reportViewModel.TcId=r;window.reportViewModel.StartDate=u;window.reportViewModel.EndDate=f;window.reportViewModel.ReportType=t;window.reportViewModel.Instructor=t;jQuery.ajax({url:i,type:"POST",dataType:"html",data:window.reportViewModel,success:function(t){var i,r;$("#reportData").html(t);i=$("#example").DataTable({pageLength:25,order:[[0,"asc"]]});i.context.length>0&&(r=new $.fn.dataTable.Buttons(i,{buttons:[{extend:"excelHtml5",title:n.getFileName("Instructor Score Report")}]}),$("#expotbutton").prepend(r.container()).find("a.dt-button").addClass("btn btn-primary").text(window.resources.TextDownload),n.focusArea("#reportData"))},error:function(t){n.showResponseError("assignError","errlist",t)}})},btnSearch_Click:function(){var n=this,t=$("#btnSearch").data("url"),r=$("#reportForm").find('input[id="StartDate"]').val(),u=$("#reportForm").find('input[id="EndDate"]').val(),f=$("#ddlTC option:selected").val();i()&&n.loadReport(t,f,r,u)}}},AppIntlIndividualInstructorScoreReports=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon,i=function(){$("#reportError").html("");$("#reportError").addClass("hide");var i=$("#reportForm").find('input[id="StartDate"]').val(),r=$("#reportForm").find('input[id="EndDate"]').val(),e=$("#ddlTC option:selected").val(),o=$("#ddlSite option:selected").val(),u=$("#ddlInstructors").multiselect("getSelected").val(),f=$("#hdnSelectedRole").val(),t=[];return(i&&r||(t[t.length]=window.resources.TextDateRangeRequired),(i||r)&&!n.isValidDate(i,r)&&(t[t.length]=n.getDateFormatError(window.resources.DateRange)),e===""&&(t[t.length]=window.resources.TextTrainingCenterRequired),(f=="tss"||f=="tsadmin")&&o===""&&(t[t.length]=window.resources.TextTrainingSiteRequiredPleaseReview),(!u||u.length<=0)&&(t[t.length]=window.resources.TextMultiInstructorsRequired),t.length>0)?(n.showResponseError("reportError","errlist",t),!1):!0},t;return{init:function(){var n=this,i=$("#hdnSelectedRole").val();$("#ddlTC").on("change",function(t){var f=$(t.target).data("url"),i=$(t.target).val(),u,r;i>0&&(u=$("#ddlRole").val(),r=n.getRoleId(u),n.getSite({tcId:i,roleId:r}),n.getInstructor({tcId:i,roleId:r}))});$("#ddlSite").on("change",function(t){var e=$(t.target).data("url"),i=$(t.target).val();if(i>0){var r=$("#ddlRole").val(),u=n.getRoleId(r),f=$("#ddlTC").val();n.getInstructor({tcId:f,roleId:u,tsId:i})}});$("input[type=radio][name=reportType]").on("change",function(n){var i=$(n.target);t=i.val()});$(document).ready(function(){if($("input[id=course]:radio").prop("checked",!0),$("input[id=course]:radio").trigger("change"),setTimeout(function(){$("#ddlRole").val($("#hdnSelectedRole").val()).trigger("change")},500),$("#ddlTC").val(""),setTimeout(function(){$("#ddlReports option:contains(Individual Instructor Scores)").attr("selected",!0)},500),setTimeout(function(){$("#ddlSiteReports option:contains(Individual Instructor Scores)").attr("selected",!0)},500),i=="tcc"||i=="tcadmin"){var r=$("#ddlRole").val(),t=n.getRoleId(r);$("#hdnReport").val()!="instructor"?($("#divSite").toggleClass("hide",!1),n.getSite({tcId:$("#hdnTcId").val(),roleId:t})):($("#divSite").toggleClass("hide",!0),n.getInstructor({tcId:$("#hdnTcId").val(),roleId:t}))}(i=="tsc"||i=="tsadmin")&&$("#divSite").toggleClass("hide",!1);n.initMultiSelect()})},initMultiSelect:function(){$("#ddlInstructors").multiselect({buttonWidth:"100%",disableIfEmpty:!1,includeSelectAllOption:!0,selectAllText:window.resources.TextSelectAll,allSelectedText:window.resources.TextAllSelected,nonSelectedText:window.resources.SelectInstructors,nSelectedText:" "+window.resources.TextSelectedInstructors})},loadReport:function(i,r,u,f,e,o){window.reportViewModel.TcId=r;window.reportViewModel.TsId=u;window.reportViewModel.StartDate=f;window.reportViewModel.EndDate=e;window.reportViewModel.ReportType=t;window.reportViewModel.Instructors=o;jQuery.ajax({url:i,type:"POST",dataType:"html",data:window.reportViewModel,success:function(t){var i,r;$("#reportData").html(t);i=$("#example").DataTable({pageLength:25,order:[[0,"asc"]]});i.context.length>0&&(r=new $.fn.dataTable.Buttons(i,{buttons:[{extend:"excelHtml5",title:n.getFileName("Instructor Score Report")}]}),$("#expotbutton").prepend(r.container()).find("a.dt-button").addClass("btn btn-primary").text(window.resources.TextDownload),n.focusArea("#reportData"))},error:function(t){n.showResponseError("reportError","errlist",t)}})},getSite:function(t){var i=$("#ddlTC").data("url");jQuery.get(i,t,function(n){if(n&&n.length>0){var t=[];t.push($("<option/>",{value:"",text:window.resources.TextSelectTrainingSite}));$.each(n,function(n,i){t.push($("<option/>",{value:i.Id,text:i.Name}))});$("#ddlSite").empty().append(t);$("#ddlSite").val("")}}).error(function(t){$("#ddlSite").empty();n.showResponseError("reportError","errlist",t)})},getRoleId:function(n){return n=="tcc"?RoleType.TCC.value:n=="tcadmin"?RoleType.TCAdmin.value:n=="tsc"?RoleType.TSC.value:n=="tsadmin"?RoleType.TSAdmin.value:0},getInstructor:function(t){var i=$("#ddlInstructors").data("url");jQuery.get(i,t,function(n){if(n&&n.length>0){var t=[];$.each(n,function(n,i){t.push($("<option/>",{value:i.Id,text:i.Name}))});$("#ddlInstructors").empty().append(t).multiselect("rebuild")}}).error(function(t){$("#ddlInstructors").empty().multiselect("rebuild");n.showResponseError("reportError","errlist",t)})},btnSearch_Click:function(){var n=this,t=$("#btnSearch").data("url"),r=$("#reportForm").find('input[id="StartDate"]').val(),u=$("#reportForm").find('input[id="EndDate"]').val(),f=$("#ddlTC option:selected").val(),e=$("#ddlSite option:selected").val(),o=$("#ddlInstructors").multiselect("getSelected").val();i()&&n.loadReport(t,f,e,r,u,o)}}},AppIntlInstructorScoreReports=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon,r=function(){$("#reportError").html("");$("#reportError").addClass("hide");var r=$("#reportForm").find('input[id="StartDate"]').val(),u=$("#reportForm").find('input[id="EndDate"]').val(),f=$("#ddlTC option:selected").val(),e=$("#ddlTS option:selected").val(),i=[];return(r&&u||(i[i.length]=window.resources.TextDateRangeRequired),(r||u)&&!n.isValidDate(r,u)&&(i[i.length]=n.getDateFormatError(window.resources.DateRange)),t=="tc"&&f===""&&(i[i.length]=window.resources.TextTrainingCenterRequired),t=="ts"&&e===""&&(i[i.length]=window.resources.TextTrainingSiteRequiredPleaseReview),i.length>0)?(n.showResponseError("reportError","errlist",i),!1):!0},i,t;return{init:function(){var n=this,r=$("#hdnRole").val();$("input[type=radio][name=reportType]").on("change",function(n){var t=$(n.target);i=t.val()});$("input[type=radio][name=entityType]").on("change",function(n){var i=$(n.target);t=i.val();t==="tc"&&($("#divTrainingCenter").toggleClass("hide",!1),$("#divTrainingSite").toggleClass("hide",!0));t==="ts"&&($("#divTrainingCenter").toggleClass("hide",!0),$("#divTrainingSite").toggleClass("hide",!1))});$(document).ready(function(){$("input[id=course]:radio").prop("checked",!0);$("input[id=course]:radio").trigger("change");$("#ddlReports option:contains(Quality Score)").attr("selected",!0);$("#ddlTC").val("");$("input[id=tc]:radio").prop("checked",!0);$("input[id=tc]:radio").trigger("change")})},loadReport:function(r,u,f,e,o){window.reportViewModel.TcId=u;window.reportViewModel.TsId=f;window.reportViewModel.StartDate=e;window.reportViewModel.EndDate=o;window.reportViewModel.ReportType=i;window.reportViewModel.Instructor=i;window.reportViewModel.EntityType=t;jQuery.ajax({url:r,type:"POST",dataType:"html",data:window.reportViewModel,success:function(t){var i,r;$("#reportData").html(t);i=$("#example").DataTable({pageLength:25,order:[[0,"asc"]]});i.context.length>0&&(r=new $.fn.dataTable.Buttons(i,{buttons:[{extend:"excelHtml5",title:n.getFileName("Instructor Score Report")}]}),$("#expotbutton").prepend(r.container()).find("a.dt-button").addClass("btn btn-primary").text(window.resources.TextDownload),n.focusArea("#reportData"))},error:function(t){n.showResponseError("reportError","errlist",t)}})},btnSearch_Click:function(){var n=this,t=$("#btnSearch").data("url"),i=$("#reportForm").find('input[id="StartDate"]').val(),u=$("#reportForm").find('input[id="EndDate"]').val(),f=$("#ddlTC option:selected").val(),e=$("#ddlTS option:selected").val();r()&&n.loadReport(t,f,e,i,u)}}},AppIntlSurveyQuestionReport=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon,r=function(){$("#reportError").html("");$("#reportError").addClass("hide");var f=$("#reportForm").find('input[id="StartDate"]').val(),e=$("#reportForm").find('input[id="EndDate"]').val(),o=$("#ddlTC option:selected").val(),s=$("#ddlTS option:selected").val(),l=$("#ddlInstructor option:selected").val(),h=$("#ddlCourse option:selected").val(),c=$("#ddlDiscipline option:selected").val(),u=$("#ddlRole").val(),r=[];return(i=="course"&&h===""&&(r[r.length]=window.resources.TextCourseRequired),i=="discipline"&&c===""&&(r[r.length]=window.resources.TextDisciplineRequired),f&&e||(r[r.length]=window.resources.TextDateRangeRequired),(f||e)&&!n.isValidDate(f,e)&&(r[r.length]=n.getDateFormatError(window.resources.DateRange)),(u=="tcc"||u=="tcadmin")&&o===""&&(r[r.length]=window.resources.TextTrainingCenterRequired),(u=="tsc"||u=="tsadmin")&&(o===""&&(r[r.length]=window.resources.TextTrainingCenterRequired),s===""&&(r[r.length]=window.resources.TextTrainingSiteRequiredPleaseReview)),u=="instructor"&&(t=="tc"&&o===""&&(r[r.length]=window.resources.TextTrainingCenterRequired),t=="ts"&&s===""&&(r[r.length]=window.resources.TextTrainingSiteRequiredPleaseReview)),r.length>0)?(n.showResponseError("reportError","errlist",r),!1):!0},i,t;return{init:function(){var n=this,r=$("#hdnSelectedRole").val();$("#ddlTC").on("change",function(t){var f=$(t.target).data("url"),i=$(t.target).val(),u,r;$("#ddlRole").val()!="instructor"&&i>0&&(u=$("#ddlRole").val(),r=n.getRoleId(u),n.getSite({tcId:i,roleId:r},n),n.getInstructor({tcId:i,roleId:r}),$("#divTrainingSite").toggleClass("hide",!1),$("#divInstructor").toggleClass("hide",!1))});$("#ddlTS").on("change",function(t){var e=$(t.target).data("url"),i=$(t.target).val();if($("#ddlRole").val()!="instructor"&&i>0){var f=$("#ddlRole").val(),r=n.getRoleId(f),u=$("#ddlTC").val();i>0?n.getInstructor({tcId:u,roleId:r,tsId:i}):n.getInstructor({tcId:u,roleId:r,tsId:null})}});$("input[type=radio][name=reportType]").on("change",function(t){var r=$(t.target);i=r.val();i=="course"?($("input[id=radActive]:radio").prop("checked",!0),n.getCourse({isActive:!0}),$("#divCourse").toggleClass("hide",!1),$("#divDiscipline").toggleClass("hide",!0)):($("#divCourse").toggleClass("hide",!0),$("#divDiscipline").toggleClass("hide",!1))});$("input[type=radio][name=courseType]").on("change",function(t){$("#reportError").toggleClass("hide",!0);var i=$(t.target),r=i.val();n.getCourse({isActive:r=="act"})});$("input[type=radio][name=entityType]").on("change",function(n){var i=$(n.target);t=i.val();t==="tc"&&($("#divTrainingCenter").toggleClass("hide",!1),$("#divTrainingSite").toggleClass("hide",!0));t==="ts"&&($("#divTrainingCenter").toggleClass("hide",!0),$("#divTrainingSite").toggleClass("hide",!1))});$(document).ready(function(){i="course";$("input[id=course]:radio").prop("checked",!0);$("input[id=radActive]:radio").prop("checked",!0);$("#divCourse").toggleClass("hide",!1);$("#divDiscipline").toggleClass("hide",!0);setTimeout(function(){$("#ddlRole").val($("#hdnSelectedRole").val()).trigger("change")},500);setTimeout(function(){$("#ddlReports option:contains(Survey Responses)").attr("selected",!0)},500);(r=="tcc"||r=="tcadmin")&&$("#divTrainingSite").toggleClass("hide",!0);(r=="tsc"||r=="tsadmin")&&($("#divTrainingSite").toggleClass("hide",!1),setTimeout(function(){$("#ddlSiteReports option:contains(Survey Responses)").attr("selected",!0)},500));r=="instructor"&&($("#divTrainingCenter").toggleClass("hide",!1),$("#divTrainingSite").toggleClass("hide",!0),setTimeout(function(){$("#ddlInstructorReports option:contains(Survey Responses)").prop("selected",!0)},500),$("input[id=radTC]:radio").prop("checked",!0));$("#divInstructor").toggleClass("hide",!0)})},loadReport:function(i,r,u,f,e,o,s,h){$("#ddlRole").val()=="instructor"&&(t=="ts"&&(r=0),t=="tc"&&(u=""));jQuery.ajax({url:i,type:"GET",dataType:"html",data:{tcId:r,tsId:u,instructorId:o,courseId:f,discipline:e,startDate:s,endDate:h,entityType:t},success:function(t){var i,r;$("#reportData").html(t);i=$("#example").DataTable({bInfo:!1,pageLength:25,order:[[0,"asc"]],columnDefs:[{targets:[0],visible:!1},]});i.context.length>0&&(r=new $.fn.dataTable.Buttons(i,{buttons:[{extend:"excelHtml5",title:n.getFileName("Survey Response Report"),exportOptions:{columns:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]}}]}),$("#expotbutton").prepend(r.container()).find("a.dt-button").addClass("btn btn-primary").text(window.resources.TextDownload),n.focusArea("#reportData"))},error:function(t){n.showResponseError("reportError","errlist",t)}})},getSite:function(t){$("#ddlTS").empty();var i=$("#ddlTC").data("url");jQuery.get(i,t,function(n){if(n&&n.length>0){var t=[];t.push($("<option/>",{value:"",text:window.resources.TextSelectTrainingSite}));$.each(n,function(n,i){t.push($("<option/>",{value:i.Id,text:i.Name}))});$("#ddlTS").append(t);$("#ddlTS").val("")}}).error(function(t){$("#ddlTS").empty();n.showResponseError("reportError","errlist",t)})},getRoleId:function(n){return n=="tcc"?RoleType.TCC.value:n=="tcadmin"?RoleType.TCAdmin.value:n=="tsc"?RoleType.TSC.value:n=="tsadmin"?RoleType.TSAdmin.value:0},getInstructor:function(t){var i=$("#ddlInstructor").data("url");jQuery.get(i,t,function(n){if(n&&n.length>0){var t=[];t.push($("<option/>",{value:"",text:window.resources.TextSelectInstructor}));$.each(n,function(n,i){t.push($("<option/>",{value:i.Id,text:i.Name}))});$("#ddlInstructor").empty().append(t)}}).error(function(t){$("#ddlInstructor").empty();n.showResponseError("reportError","errlist",t)})},getCourse:function(t){var i=$("#ddlCourse").data("url");$("#ddlCourse").empty();jQuery.get(i,t,function(n){if(n&&n.length>0){var i=1,t=[];t.push($("<option/>",{value:"",text:window.resources.SelectCourse}));$.each(n,function(n,r){t.push($("<option/>",{value:r.CourseId,text:r.AffiliationId==i?r.Name+" (RCSA)":r.Name}))});$("#ddlCourse").append(t).val("")}}).error(function(t){$("#ddlCourse").empty();n.showResponseError("reportError","errlist",t)})},btnSearch_Click:function(){var u=this,f=$("#btnSearch").data("url"),e=$("#reportForm").find('input[id="StartDate"]').val(),o=$("#reportForm").find('input[id="EndDate"]').val(),s=$("#ddlTC option:selected").val(),h=$("#ddlTS option:selected").val(),n=$("#ddlCourse option:selected").val(),t=$("#ddlDiscipline option:selected").val(),c=$("#ddlInstructor option:selected").val();i=="course"&&(t=null);i=="discipline"&&(n=null);r()&&u.loadReport(f,s,h,n,t,c,e,o)}}},AppIntlTCScoreReports=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon,i=function(){$("#reportError").html("");$("#reportError").addClass("hide");var i=$("#reportForm").find('input[id="StartDate"]').val(),r=$("#reportForm").find('input[id="EndDate"]').val(),u=$("#ddlTC option:selected").val(),t=[];return(i&&r||(t[t.length]=window.resources.TextDateRangeRequired),(i||r)&&!n.isValidDate(i,r)&&(t[t.length]=n.getDateFormatError(window.resources.DateRange)),u===""&&(t[t.length]=window.resources.TextTrainingCenterRequired),t.length>0)?(n.showResponseError("reportError","errlist",t),!1):!0},t;return{init:function(){var n=this;$("input[type=radio][name=reportType]").on("change",function(n){var i=$(n.target);t=i.val()});$(document).ready(function(){$("#ddlReports option:contains(Training Center Scores)").attr("selected",!0);$("input[id=course]:radio").prop("checked",!0);$("input[id=course]:radio").trigger("change")})},loadReport:function(i,r,u,f){jQuery.ajax({url:i,type:"GET",dataType:"html",data:{tcId:r,startDate:u,endDate:f,groupBy:t},success:function(t){var i,r;$("#reportData").html(t);i=$("#example").DataTable({pageLength:25,order:[[0,"asc"]]});i.context.length>0&&(r=new $.fn.dataTable.Buttons(i,{buttons:[{extend:"excelHtml5",title:n.getFileName("Training Center Score Report")}]}),$("#expotbutton").prepend(r.container()).find("a.dt-button").addClass("btn btn-primary").text(window.resources.TextDownload),n.focusArea("#reportData"))},error:function(t){n.showResponseError("reportError","errlist",t)}})},btnSearch_Click:function(){var n=this,t=$("#btnSearch").data("url"),r=$("#reportForm").find('input[id="StartDate"]').val(),u=$("#reportForm").find('input[id="EndDate"]').val(),f=$("#ddlTC option:selected").val();i()&&n.loadReport(t,f,r,u)}}},AppSiteScoreReports=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon,i=function(){$("#reportError").html("");$("#reportError").addClass("hide");var i=$("#reportForm").find('input[id="StartDate"]').val(),r=$("#reportForm").find('input[id="EndDate"]').val(),u=$("#ddlTC option:selected").val(),f=$("#ddlTS option:selected").val(),e=$("#ddlInstructors option:selected").val(),o=$("#hdnRole").val(),t=[];return(i&&r||(t[t.length]=window.resources.TextDateRangeRequired),(i||r)&&!n.isValidDate(i,r)&&(t[t.length]=n.getDateFormatError(window.resources.DateRange)),u===""&&(t[t.length]=window.resources.TextTrainingCenterRequired),f===""&&(t[t.length]=window.resources.TextTrainingSiteRequiredPleaseReview),t.length>0)?(n.showResponseError("reportError","errlist",t),!1):!0},t;return{init:function(){var n=this,i=$("#hdnRole").val();$("#ddlTC").on("change",function(t){var e=$(t.target).data("url"),r=$(t.target).val(),u,f,i;r>0?(u=$("#ddlRole").val(),f=n.getRoleId(u),n.getSite({tcId:r,roleId:f})):(i=[],i.push($("<option/>",{value:"",text:window.resources.TextSelectTrainingSite})),$("#ddlTS").empty().append(i).val(""))});$("input[type=radio][name=reportType]").on("change",function(n){var i=$(n.target);t=i.val()});$(document).ready(function(){if($("input[id=course]:radio").prop("checked",!0),$("input[id=course]:radio").trigger("change"),setTimeout(function(){$("#ddlRole").val($("#hdnSelectedRole").val()).trigger("change")},500),$("#ddlTC").val(""),setTimeout(function(){$("#ddlReports option:contains(Training Site Scores)").attr("selected",!0)},500),setTimeout(function(){$("#divSiteReports option:contains(Training Site Scores)").attr("selected",!0)},500),i==RoleType.TCC.value||i==RoleType.TCAdmin.value){var r=$("#ddlRole").val(),t=n.getRoleId(r);$("#hdnReport").val()!="instructor"?($("#divLocation").toggleClass("hide",!1),n.getSite({tcId:$("#hdnTcId").val(),roleId:t})):($("#divTcLocation").toggleClass("hide",!0),n.getInstructor({tcId:$("#hdnTcId").val(),roleId:t}))}i==RoleType.EcardAdmin.value&&($("#divTrainingCenter").toggleClass("hide",!1),$("#divLocation").toggleClass("hide",!1))})},loadReport:function(i,r,u,f,e){jQuery.ajax({url:i,type:"GET",dataType:"html",data:{tcId:r,tsId:u,startDate:f,endDate:e,groupBy:t},success:function(t){var i,r;$("#reportData").html(t);i=$("#example").DataTable({pageLength:25,order:[[0,"asc"]]});i.context.length>0&&(r=new $.fn.dataTable.Buttons(i,{buttons:[{extend:"excelHtml5",title:n.getFileName("Training Site Score Report")}]}),$("#expotbutton").prepend(r.container()).find("a.dt-button").addClass("btn btn-primary").text(window.resources.TextDownload),n.focusArea("#reportData"))},error:function(t){n.showResponseError("reportError","errlist",t)}})},getSite:function(t){var i=$("#ddlTC").data("url");jQuery.get(i,t,function(n){var t=[];n&&n.length>0?(t.push($("<option/>",{value:"",text:window.resources.TextSelectTrainingSite})),$.each(n,function(n,i){t.push($("<option/>",{value:i.Id,text:i.Name}))}),$("#ddlTS").empty().append(t),$("#ddlTS").val("")):(t.push($("<option/>",{value:"",text:window.resources.TextSelectTrainingSite})),$("#ddlTS").empty().append(t).val(""))}).error(function(t){var i=[];i.push($("<option/>",{value:"",text:window.resources.TextSelectTrainingSite}));$("#ddlTS").empty().append(i).val("");n.showResponseError("reportError","errlist",t)})},getRoleId:function(n){return n=="tcc"?RoleType.TCC.value:n=="tcadmin"?RoleType.TCAdmin.value:n=="tsc"?RoleType.TSC.value:n=="tsadmin"?RoleType.TSAdmin.value:0},btnSearch_Click:function(){var n=this,t=$("#btnSearch").data("url"),r=$("#reportForm").find('input[id="StartDate"]').val(),u=$("#reportForm").find('input[id="EndDate"]').val(),f=$("#ddlTC option:selected").val(),e=$("#ddlTS option:selected").val();i()&&n.loadReport(t,f,e,r,u)}}},AppLocationScoreReports=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon,i=function(){$("#reportError").html("");$("#reportError").addClass("hide");var i=$("#reportForm").find('input[id="StartDate"]').val(),r=$("#reportForm").find('input[id="EndDate"]').val(),u=$("#ddlTC option:selected").val(),f=$("#ddlLocation option:selected").val(),o=$("#ddlInstructors option:selected").val(),e=$("#hdnRole").val(),t=[];return(i&&r||(t[t.length]=window.resources.TextDateRangeRequired),(i||r)&&!n.isValidDate(i,r)&&(t[t.length]=n.getDateFormatError(window.resources.DateRange)),e==RoleType.EcardAdmin.value&&u===""&&(t[t.length]=window.resources.TextTrainingCenterRequired),f===""&&(t[t.length]=window.resources.TextLocationRequired),t.length>0)?(n.showResponseError("reportError","errlist",t),!1):!0},t;return{init:function(){var n=this,i=$("#hdnRole").val();$("#ddlTC").on("change",function(t){var r=$(t.target).data("url"),i=$(t.target).val();i>0&&(n.getLocation({tcId:i}),n.getInstructor({tcId:i}))});$("input[type=radio][name=reportType]").on("change",function(n){var i=$(n.target);t=i.val()});$(document).ready(function(){$("input[id=course]:radio").prop("checked",!0);$("input[id=course]:radio").trigger("change");$("#ddlReports option:contains(eCard Location Scores)").attr("selected",!0);(i==RoleType.TCC.value||i==RoleType.TCAdmin.value)&&($("#divTrainingCenter").toggleClass("hide",!0),$("#hdnReport").val()!="instructor"?($("#divLocation").toggleClass("hide",!1),n.getLocation({tcId:$("#hdnTcId").val()})):($("#divTcLocation").toggleClass("hide",!0),n.getInstructor({tcId:$("#hdnTcId").val()})));i==RoleType.EcardAdmin.value&&($("#divTrainingCenter").toggleClass("hide",!1),$("#divLocation").toggleClass("hide",!1))})},loadReport:function(i,r,u,f,e){jQuery.ajax({url:i,type:"GET",dataType:"html",data:{tcId:r,locationId:u,startDate:f,endDate:e,groupBy:t},success:function(t){var i,r;$("#reportData").html(t);i=$("#example").DataTable({pageLength:25,order:[[0,"asc"]]});i.context.length>0&&(r=new $.fn.dataTable.Buttons(i,{buttons:[{extend:"excelHtml5",title:n.getFileName("Location Score Report")}]}),$("#expotbutton").prepend(r.container()).find("a.dt-button").addClass("btn btn-primary").text(window.resources.TextDownload),n.focusArea("#reportData"))},error:function(t){n.showResponseError("assignError","errlist",t)}})},getLocation:function(t){var i=$("#ddlTC").data("url");jQuery.get(i,t,function(n){if(n&&n.length>0){var t=[];t.push($("<option/>",{value:"",text:window.resources.TextSelecteCardLocation}));$.each(n,function(n,i){t.push($("<option/>",{value:i.Id,text:i.Name}))});$("#ddlLocation").empty().append(t);$("#ddlLocation").val("")}}).error(function(t){$("#ddlLocation").empty();n.showResponseError("assignError","errlist",t)})},btnSearch_Click:function(){var n=this,t=$("#btnSearch").data("url"),r=$("#reportForm").find('input[id="StartDate"]').val(),u=$("#reportForm").find('input[id="EndDate"]').val(),f=$("#ddlTC option:selected").val(),e=$("#ddlLocation option:selected").val();i()&&n.loadReport(t,f,e,r,u)}}},AppReclaimReport=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon,t=function(t){$("#reportError").html("");$("#reportError").addClass("hide");var r=$("#reportForm").find('input[id="StartDate"]').val(),u=$("#reportForm").find('input[id="EndDate"]').val(),f=$("#ddlTC option:selected").val(),e=$("#ddlLocation option:selected").val(),o=$("#hdnRole").val(),i=[];return(t&&(r&&u||(i[i.length]=window.resources.TextDateOfReclaimRequired),(r||u)&&!n.isValidDate(r,u)&&(i[i.length]=n.getDateFormatError(window.resources.DateOfReclaim)),o==RoleType.EcardAdmin.value&&(f===""&&(i[i.length]=window.resources.TextTrainingCenterRequired),e===""&&(i[i.length]=window.resources.TextLocationRequired))),i.length>0)?(n.showResponseError("reportError","errlist",i),!1):!0};return{init:function(){var n=this;$("input[id=course]:radio").prop("checked",!0);$(document).ready(function(){n.getReport(!1)});$("#ddlTC").on("change",function(t){var r=$(t.target),i=r.val();i>0?$("#divLocation").toggleClass("hide",!1):$("#divLocation").toggleClass("hide",!0);n.getLocation({TcId:i})});n.displayControl();$(document).ready(function(){$("#ddlReports option:contains(Reclaims)").attr("selected",!0)})},getLocation:function(t){var i=$("#ddlTC").data("url");jQuery.get(i,t,function(n){if(n&&n.length>0){var t=[];t.push($("<option/>",{value:"",text:window.resources.TextSelecteCardLocation}));$.each(n,function(n,i){t.push($("<option/>",{value:i.Id,text:i.Name}))});$("#ddlLocation").empty().append(t);$("#ddlLocation").val("")}}).error(function(t){$("#ddlLocation").empty();n.showResponseError("assignError","errlist",t)})},displayControl:function(){var t=this,n=$("#hdnRole").val();n==RoleType.TCC.value||n==RoleType.TCAdmin.value?($("#divLocation").toggleClass("hide",!0),$("#divTrainingCenter").toggleClass("hide",!0)):n==RoleType.EcardAdmin.value&&$("#divTrainingCenter").toggleClass("hide",!1)},loadReport:function(t){var e=this,i=$("#reportForm").find('input[id="StartDate"]').val(),r=$("#reportForm").find('input[id="EndDate"]').val(),u=$("#ddlTC option:selected").val(),f=$("#ddlLocation option:selected").val();jQuery.ajax({url:t,type:"GET",dataType:"html",data:{startDate:i,endDate:r,tcId:u,locationId:f},success:function(t){var i,r;$("#reportData").html(t);i=$("#example").DataTable({pageLength:25,order:[[1,"desc"]]});i.context.length>0&&(r=new $.fn.dataTable.Buttons(i,{buttons:["excelHtml5"]}),$("#expotbutton").prepend(r.container()).find("a.dt-button").addClass("btn btn-primary").text(window.resources.TextDownload),n.focusArea("#reportData"))},error:function(t){n.showResponseError("assignError","errlist",t)}})},getReport:function(n){var i=this,r=$("#btnSubmit").data("url");t(n)&&i.loadReport(r)}}},AppReports=function(){return $.ajaxSetup({async:!0,cache:!1}),{init:function(){var n=this}}};$("#ddlReports").on("change",function(){var t=$(this).val(),n,i;t!=null&&t!=""&&(n="",i="",$("#ddlInstructorReports").val()!=""&&(n=$("#ddlInstructorReports option:selected").text()),$("#ddlReports").val()!=""&&(n=$("#ddlReports option:selected").text()),$("#ddlRole").val()!=null&&(i=$("#ddlRole").val()),window.location.href=t+"?role="+i+"&report="+n)});$("#ddlInstructorReports").on("change",function(){var n=$(this).val(),t="",i="";$("#ddlInstructorReports").val()!=""&&(t=$("#ddlInstructorReports option:selected").text());$("#ddlRole").val()!=null&&(i=$("#ddlRole").val());n!=null&&n!=""&&(window.location.href=n+"?role="+i+"&report="+t)});$("#ddlSiteReports").on("change",function(){var n=$(this).val(),t="",i="";$("#ddlSiteReports").val()!=""&&(t=$("#ddlSiteReports option:selected").text());$("#ddlRole").val()!=null&&(i=$("#ddlRole").val());n!=null&&n!=""&&(window.location.href=n+"?role="+i+"&report="+t)});$("#divRole").on("change",function(n){var i=$(n.target),t=i.val();$("#ddlReports").val("");$("#ddlInstructorReports").val("");$("#ddlSiteReports").val("");t=="instructor"?($("#divReports").toggleClass("hide",!0),$("#divInstructorReports").toggleClass("hide",!1),$("#divSiteReports").toggleClass("hide",!0)):t=="tsc"||t=="tsadmin"?($("#divSiteReports").toggleClass("hide",!1),$("#divReports").toggleClass("hide",!0),$("#divInstructorReports").toggleClass("hide",!0)):($("#divReports").toggleClass("hide",!1),$("#divInstructorReports").toggleClass("hide",!0),$("#divSiteReports").toggleClass("hide",!0))});$(document).ready(function(){var n=GetQueryStringParams("role"),t;n!=null&&$("#ddlRole").val(n);n=="instructor"?(t=GetQueryStringParams("report").replace("%20"," "),$("#ddlInstructorReports option:contains("+t+")").attr("selected",!0),$("#divReports").toggleClass("hide",!0),$("#divInstructorReports").toggleClass("hide",!1)):($("#divReports").toggleClass("hide",!1),$("#divInstructorReports").toggleClass("hide",!0))});AppSurveyQuestionReport=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon,i=function(){$("#reportError").html("");$("#reportError").addClass("hide");var r=$("#reportForm").find('input[id="StartDate"]').val(),u=$("#reportForm").find('input[id="EndDate"]').val(),f=$("#ddlTC option:selected").val(),o=$("#ddlLocation option:selected").val(),c=$("#ddlInstructor option:selected").val(),s=$("#ddlCourse option:selected").val(),h=$("#ddlDiscipline option:selected").val(),e=$("#hdnRole").val(),i=[];return(t=="course"&&s===""&&(i[i.length]=window.resources.TextCourseRequired),t=="discipline"&&h===""&&(i[i.length]=window.resources.TextDisciplineRequired),r&&u||(i[i.length]=window.resources.TextDateRangeRequired),(r||u)&&!n.isValidDate(r,u)&&(i[i.length]=n.getDateFormatError(window.resources.DateRange)),e==RoleType.EcardAdmin.value&&(f===""&&(i[i.length]=window.resources.TextTrainingCenterRequired),o===""&&(i[i.length]=window.resources.TextLocationRequired)),e==RoleType.Instructor.value&&f===""&&(i[i.length]=window.resources.TextTrainingCenterRequired),i.length>0)?(n.showResponseError("reportError","errlist",i),!1):!0},t;return{init:function(){var i=this,n=$("#hdnRole").val();$("#ddlTC").on("change",function(t){var u=$(t.target).data("url"),r=$(t.target).val();n==RoleType.EcardAdmin.value&&r>0&&(i.getLocation({tcId:r}),i.getInstructor({tcId:r}))});$("input[type=radio][name=reportType]").on("change",function(n){var r=$(n.target);t=r.val();t=="course"?($("input[id=radActive]:radio").prop("checked",!0),i.getCourse({isActive:!0}),$("#divCourse").toggleClass("hide",!1),$("#divDiscipline").toggleClass("hide",!0)):($("#divCourse").toggleClass("hide",!0),$("#divDiscipline").toggleClass("hide",!1))});$("input[type=radio][name=courseType]").on("change",function(n){$("#reportError").toggleClass("hide",!0);var t=$(n.target),r=t.val();i.getCourse({isActive:r=="act"})});$(document).ready(function(){t="course";$("input[id=course]:radio").prop("checked",!0);$("input[id=radActive]:radio").prop("checked",!0);$("#divCourse").toggleClass("hide",!1);$("#divDiscipline").toggleClass("hide",!0);$("#ddlReports option:contains(Location Survey Responses)").attr("selected",!0);(n==RoleType.TCC.value||n==RoleType.TCAdmin.value)&&$("#divTrainingCenter").toggleClass("hide",!0);n==RoleType.EcardAdmin.value&&($("#spnRequired").toggleClass("hide",!1),$("#ddlLocation").attr("aria-required",!0),$("#divTrainingCenter").toggleClass("hide",!1),$("#divLocation").toggleClass("hide",!1));n==RoleType.Instructor.value&&($("#divTrainingCenter").toggleClass("hide",!1),$("#divLocation").toggleClass("hide",!0),$("#divInstructor").toggleClass("hide",!0))})},loadReport:function(t,i,r,u,f,e,o,s){jQuery.ajax({url:t,type:"GET",dataType:"html",data:{tcId:i,locationId:r,instructorId:e,courseId:u,discipline:f,startDate:o,endDate:s},success:function(t){var i,r;$("#reportData").html(t);i=$("#example").DataTable({bInfo:!1,pageLength:25,order:[[0,"asc"]],columnDefs:[{targets:[0],visible:!1},]});i.context.length>0&&(r=new $.fn.dataTable.Buttons(i,{buttons:[{extend:"excelHtml5",title:n.getFileName("Survey Response Report"),exportOptions:{columns:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]}}]}),$("#expotbutton").prepend(r.container()).find("a.dt-button").addClass("btn btn-primary").text(window.resources.TextDownload),n.focusArea("#reportData"))},error:function(t){n.showResponseError("assignError","errlist",t)}})},getLocation:function(t){var i=$("#ddlTC").data("url");jQuery.get(i,t,function(n){if(n&&n.length>0){var t=[];t.push($("<option/>",{value:"",text:window.resources.TextSelecteCardLocation}));$.each(n,function(n,i){t.push($("<option/>",{value:i.Id,text:i.Name}))});$("#ddlLocation").empty().append(t);$("#ddlLocation").val("")}}).error(function(t){$("#ddlLocation").empty();n.showResponseError("assignError","errlist",t)})},getInstructor:function(t){var i=$("#ddlInstructor").data("url");jQuery.get(i,t,function(n){if(n&&n.length>0){var t=[];t.push($("<option/>",{value:"",text:window.resources.TextSelectInstructor}));$.each(n,function(n,i){t.push($("<option/>",{value:i.Id,text:i.Name}))});$("#ddlInstructor").empty().append(t)}}).error(function(t){$("#ddlInstructor").empty();n.showResponseError("assignError","errlist",t)})},getCourse:function(t){var i=$("#ddlCourse").data("url");jQuery.get(i,t,function(n){if(n&&n.length>0){var t=[];t.push($("<option/>",{value:"",text:window.resources.SelectCourse}));$.each(n,function(n,i){t.push($("<option/>",{value:i.CourseId,text:i.Name}))});$("#ddlCourse").empty().append(t).val("")}}).error(function(t){$("#ddlCourse").empty();n.showResponseError("reportError","errlist",t)})},btnSearch_Click:function(){var u=this,f=$("#btnSearch").data("url"),e=$("#reportForm").find('input[id="StartDate"]').val(),o=$("#reportForm").find('input[id="EndDate"]').val(),s=$("#ddlTC option:selected").val(),h=$("#ddlLocation option:selected").val(),n=$("#ddlCourse option:selected").val(),r=$("#ddlDiscipline option:selected").val(),c=$("#ddlInstructor option:selected").val();t=="course"&&(r=null);t=="discipline"&&(n=null);i()&&u.loadReport(f,s,h,n,r,c,e,o)}}};AppScoreReports=function(){$.ajaxSetup({async:!0,cache:!1});var n=new AppCommon,i=function(){$("#reportError").html("");$("#reportError").addClass("hide");var i=$("#reportForm").find('input[id="StartDate"]').val(),r=$("#reportForm").find('input[id="EndDate"]').val(),t=[];return(i&&r||(t[t.length]=window.resources.TextDateRangeRequired),(i||r)&&!n.isValidDate(i,r)&&(t[t.length]=n.getDateFormatError(window.resources.DateRange)),t.length>0)?(n.showResponseError("reportError","errlist",t),!1):!0},t;return{init:function(){var n=this;$("input[type=radio][name=reportType]").on("change",function(n){var i=$(n.target);t=i.val()});$(document).ready(function(){$("#ddlReports option:contains(Training Center Scores)").attr("selected",!0);$("input[id=course]:radio").prop("checked",!0);$("input[id=course]:radio").trigger("change")})},loadReport:function(i,r,u){jQuery.ajax({url:i,type:"GET",dataType:"html",data:{startDate:r,endDate:u,groupBy:t},success:function(t){var i,r;$("#reportData").html(t);i=$("#example").DataTable({pageLength:25,order:[[0,"asc"]]});i.context.length>0&&(r=new $.fn.dataTable.Buttons(i,{buttons:[{extend:"excelHtml5",title:n.getFileName("Training Center Score Report")}]}),$("#expotbutton").prepend(r.container()).find("a.dt-button").addClass("btn btn-primary").text(window.resources.TextDownload),n.focusArea("#reportData"))},error:function(t){n.showResponseError("assignError","errlist",t)}})},btnSearch_Click:function(){var n=this,t=$("#btnSearch").data("url"),r=$("#reportForm").find('input[id="StartDate"]').val(),u=$("#reportForm").find('input[id="EndDate"]').val();i()&&n.loadReport(t,r,u)}}}